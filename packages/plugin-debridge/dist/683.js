"use strict";exports.ids=["683"],exports.modules={1071:function(e,t,r){r.d(t,{Bj:()=>n.d,DX:()=>n.f,F2:()=>n.m,Mj:()=>n.i,gB:()=>i,id:()=>n.t,vb:()=>n.c}),r(3955);var n=r(8219);async function i(e){try{let t=await e;return Object.assign([null,t,!1,!0],{error:null,data:t,isDefined:!1,isSuccess:!0})}catch(e){if((0,n.i)(e))return Object.assign([e,void 0,!0,!1],{error:e,data:void 0,isDefined:!0,isSuccess:!1});return Object.assign([e,void 0,!1,!1],{error:e,data:void 0,isDefined:!1,isSuccess:!1})}}r(4399)},7750:function(e,t,r){r.r(t),r.d(t,{ORPCError:()=>a.vb,onSuccess:()=>i.L_,resolveContractProcedures:()=>S,createContractedProcedure:()=>j,implementerInternal:()=>U,setHiddenRouterContract:()=>E,eventIterator:()=>n.eventIterator,fallbackConfig:()=>A,validateORPCError:()=>n.validateORPCError,withEventMeta:()=>o.c8,isProcedure:()=>w,EventPublisher:()=>i.zh,ValidationError:()=>n.ValidationError,AsyncIteratorClass:()=>i.Nz,mergeMiddlewares:()=>f,type:()=>n.type,traverseContractProcedures:()=>b,createORPCErrorConstructorMap:()=>x,eventIteratorToUnproxiedDataStream:()=>i.ER,onError:()=>i.S5,addMiddleware:()=>h,enhanceRouter:()=>L,getRouter:()=>C,decorateMiddleware:()=>D,isLazy:()=>l,safe:()=>a.gB,lazy:()=>d,call:()=>z,LAZY_SYMBOL:()=>u,streamToEventIterator:()=>i.YU,unlazyRouter:()=>_,createAssertedLazyProcedure:()=>$,getEventMeta:()=>o.Kg,onStart:()=>i.ao,os:()=>Z,unlazy:()=>c,Procedure:()=>g,createProcedureClient:()=>y,isStartWithMiddlewares:()=>p,getHiddenRouterContract:()=>P,DecoratedProcedure:()=>B,createAccessibleLazyRouter:()=>O,inferRPCMethodFromRouter:()=>Y,getLazyMeta:()=>s,mergeCurrentContext:()=>m,isDefinedError:()=>a.Mj,createActionableClient:()=>N,middlewareOutputFn:()=>I,onFinish:()=>i.vC,Builder:()=>F,implement:()=>function e(t,r={}){let n=new Proxy(U(t,r,[]),{get:(r,i)=>{let a;"$context"===i?a=()=>n:"$config"===i&&(a=r=>e(t,r));let o=Reflect.get(r,i);return a&&o&&("function"==typeof o||"object"==typeof o)?new Proxy(a,{get:(e,t)=>Reflect.get(o,t)}):a||o}});return n},createRouterClient:()=>function e(t,...r){let n=(0,i.$Z)(r);return w(t)?y(t,n):new Proxy(l(t)?y($(t),n):{},{get(n,i){if("string"!=typeof i)return Reflect.get(n,i);let a=C(t,[i]);return a?e(a,{...r[0],path:[...r[0]?.path??[],i]}):Reflect.get(n,i)}})},eventIteratorToStream:()=>i.mm});var n=r(3876),i=r(3955),a=r(1071),o=r(4399);let u=Symbol("ORPC_LAZY_SYMBOL");function d(e,t={}){return{[u]:{loader:e,meta:t}}}function l(e){return("object"==typeof e||"function"==typeof e)&&null!==e&&u in e}function s(e){return e[u].meta}function c(e){return l(e)?e[u].loader():Promise.resolve({default:e})}function p(e,t){if(t.length>e.length)return!1;for(let r=0;r<e.length&&void 0!==t[r];r++)if(e[r]!==t[r])return!1;return!0}function f(e,t,r){return r.dedupeLeading&&p(t,e)?t:[...e,...t]}function h(e,t){return[...e,t]}class g{"~orpc";constructor(e){this["~orpc"]=e}}function w(e){return e instanceof g||(0,n.isContractProcedure)(e)&&"middlewares"in e["~orpc"]&&"inputValidationIndex"in e["~orpc"]&&"outputValidationIndex"in e["~orpc"]&&"handler"in e["~orpc"]}function m(e,t){return{...e,...t}}function x(e){return new Proxy(e,{get:(t,r)=>"string"!=typeof r?Reflect.get(t,r):(...t)=>{let n=(0,i.$Z)(t),o=e[r];return new a.vb(r,{defined:!!o,status:o?.status,message:n.message??o?.message,data:n.data,cause:n.cause})}})}function I(e){return{output:e,context:{}}}function y(e,...t){let r=(0,i.$Z)(t);return async(...[t,u])=>{let d=(0,i.$r)(r.path),{default:l}=await c(e),s=u?.context??{},p=await (0,i.Uq)(r.context??{},s),f=x(l["~orpc"].errorMap),h=async e=>e instanceof a.vb?await (0,n.validateORPCError)(l["~orpc"].errorMap,e):e;try{let e=await (0,i.uj)({name:"call_procedure",signal:u?.signal},e=>(e?.setAttribute("procedure.path",[...d]),(0,i.Zc)((0,i.$r)(r.interceptors),{context:p,input:t,errors:f,path:d,procedure:l,signal:u?.signal,lastEventId:u?.lastEventId},e=>v(e.procedure,e))));if((0,i._p)(e)){if(e instanceof o.mJ)return e;return(0,i.np)(e,(0,a.F2)((0,i.zL)({name:"consume_event_iterator_output",signal:u?.signal},e),{value:e=>e,error:e=>h(e)}))}return e}catch(e){throw await h(e)}}}async function M(e,t){let r=e["~orpc"].inputSchema;return r?(0,i.uj)({name:"validate_input"},async()=>{let e=await r["~standard"].validate(t);if(e.issues)throw new a.vb("BAD_REQUEST",{message:"Input validation failed",data:{issues:e.issues},cause:new n.ValidationError({message:"Input validation failed",issues:e.issues,data:t})});return e.value}):t}async function R(e,t){let r=e["~orpc"].outputSchema;return r?(0,i.uj)({name:"validate_output"},async()=>{let e=await r["~standard"].validate(t);if(e.issues)throw new a.vb("INTERNAL_SERVER_ERROR",{message:"Output validation failed",cause:new n.ValidationError({message:"Output validation failed",issues:e.issues,data:t})});return e.value}):t}async function v(e,t){let r=e["~orpc"].middlewares,n=Math.min(Math.max(0,e["~orpc"].inputValidationIndex),r.length),a=Math.min(Math.max(0,e["~orpc"].outputValidationIndex),r.length),o=async(u,d,l)=>{let s=l;u===n&&(s=await M(e,s));let c=r[u],p=c?await (0,i.uj)({name:`middleware.${c.name}`,signal:t.signal},async e=>(e?.setAttribute("middleware.index",u),e?.setAttribute("middleware.name",c.name),(await c({...t,context:d,next:async(...[e])=>{let t=e?.context??{};return{output:await o(u+1,m(d,t),s),context:t}}},s,I)).output)):await (0,i.uj)({name:"handler",signal:t.signal},()=>e["~orpc"].handler({...t,context:d,input:s}));return u===a?await R(e,p):p};return o(0,t.context,t.input)}let V=Symbol("ORPC_HIDDEN_ROUTER_CONTRACT");function E(e,t){return new Proxy(e,{get:(e,r)=>r===V?t:Reflect.get(e,r)})}function P(e){return e[V]}function C(e,t){let r=e;for(let e=0;e<t.length;e++){let n=t[e];if(!r||w(r))return;if(!l(r)){r=r[n];continue}let i=r,a=t.slice(e);return d(async()=>{let e=C((await c(i)).default,a);return c(e)},s(i))}return r}function O(e){return new Proxy(e,{get:(t,r)=>"string"!=typeof r?Reflect.get(t,r):O(C(e,[r]))})}function L(e,t){if(l(e)){let r=s(e),i=r?.prefix?(0,n.mergePrefix)(t.prefix,r?.prefix):t.prefix;return O(d(async()=>{let{default:r}=await c(e);return c(L(r,t))},{...r,prefix:i}))}if(w(e)){let r=f(t.middlewares,e["~orpc"].middlewares,{dedupeLeading:t.dedupeLeadingMiddlewares}),i=r.length-e["~orpc"].middlewares.length;return new g({...e["~orpc"],route:(0,n.enhanceRoute)(e["~orpc"].route,t),errorMap:(0,n.mergeErrorMap)(t.errorMap,e["~orpc"].errorMap),middlewares:r,inputValidationIndex:e["~orpc"].inputValidationIndex+i,outputValidationIndex:e["~orpc"].outputValidationIndex+i})}let r={};for(let n in e)r[n]=L(e[n],t);return r}function b(e,t,r=[]){let i=e.router,a=e.router[V];if(void 0!==a&&(i=a),l(i))r.push({router:i,path:e.path});else if((0,n.isContractProcedure)(i))t({contract:i,path:e.path});else for(let n in i)b({router:i[n],path:[...e.path,n]},t,r);return r}async function S(e,t){let r=[e];for(let e of r)for(let n of b(e,t)){let{default:e}=await c(n.router);r.push({router:e,path:n.path})}}async function _(e){if(w(e))return e;let t={};for(let r in e){let n=e[r],{default:i}=await c(n);t[r]=await _(i)}return t}function $(e){return d(async()=>{let{default:t}=await c(e);if(!w(t))throw Error(`
            Expected a lazy<procedure> but got lazy<unknown>.
            This should be caught by TypeScript compilation.
            Please report this issue if this makes you feel uncomfortable.
        `);return{default:t}},s(e))}function j(e,t){return new g({...e["~orpc"],errorMap:t["~orpc"].errorMap,route:t["~orpc"].route,meta:t["~orpc"].meta})}function z(e,t,...r){let n=(0,i.$Z)(r);return y(e,n)(t,n)}let T={initialInputValidationIndex:0,initialOutputValidationIndex:0,dedupeLeadingMiddlewares:!0};function A(e,t){return void 0===t?T[e]:t}function D(e){let t=(...t)=>e(...t);return t.mapInput=t=>D((r,n,...i)=>e(r,t(n),...i)),t.concat=(t,r)=>{let n=r?D(t).mapInput(r):t;return D((t,r,i,...a)=>e({...t,next:(...[e])=>n({...t,context:{...t.context,...e?.context},next:(...[r])=>t.next({context:{...e?.context,...r?.context}})},r,i,...a)},r,i,...a))},t}function N(e){return async t=>{try{return[null,await e(t)]}catch(e){if(e instanceof Error&&"digest"in e&&"string"==typeof e.digest&&e.digest.startsWith("NEXT_")||e instanceof Response&&"options"in e&&(0,i.Gv)(e.options)||(0,i.Gv)(e)&&!0===e.isNotFound)throw e;return[(0,a.id)(e).toJSON(),void 0]}}}class B extends g{errors(e){return new B({...this["~orpc"],errorMap:(0,n.mergeErrorMap)(this["~orpc"].errorMap,e)})}meta(e){return new B({...this["~orpc"],meta:(0,n.mergeMeta)(this["~orpc"].meta,e)})}route(e){return new B({...this["~orpc"],route:(0,n.mergeRoute)(this["~orpc"].route,e)})}use(e,t){let r=t?D(e).mapInput(t):e;return new B({...this["~orpc"],middlewares:h(this["~orpc"].middlewares,r)})}callable(...e){return new Proxy(y(this,...e),{get:(e,t)=>Reflect.has(this,t)?Reflect.get(this,t):Reflect.get(e,t),has:(e,t)=>Reflect.has(this,t)||Reflect.has(e,t)})}actionable(...e){return new Proxy(N(y(this,...e)),{get:(e,t)=>Reflect.has(this,t)?Reflect.get(this,t):Reflect.get(e,t),has:(e,t)=>Reflect.has(this,t)||Reflect.has(e,t)})}}class F{"~orpc";constructor(e){this["~orpc"]=e}$config(e){let t=this["~orpc"].inputValidationIndex-A("initialInputValidationIndex",this["~orpc"].config.initialInputValidationIndex),r=this["~orpc"].outputValidationIndex-A("initialOutputValidationIndex",this["~orpc"].config.initialOutputValidationIndex);return new F({...this["~orpc"],config:e,dedupeLeadingMiddlewares:A("dedupeLeadingMiddlewares",e.dedupeLeadingMiddlewares),inputValidationIndex:A("initialInputValidationIndex",e.initialInputValidationIndex)+t,outputValidationIndex:A("initialOutputValidationIndex",e.initialOutputValidationIndex)+r})}$context(){return new F({...this["~orpc"],middlewares:[],inputValidationIndex:A("initialInputValidationIndex",this["~orpc"].config.initialInputValidationIndex),outputValidationIndex:A("initialOutputValidationIndex",this["~orpc"].config.initialOutputValidationIndex)})}$meta(e){return new F({...this["~orpc"],meta:e})}$route(e){return new F({...this["~orpc"],route:e})}$input(e){return new F({...this["~orpc"],inputSchema:e})}middleware(e){return D(e)}errors(e){return new F({...this["~orpc"],errorMap:(0,n.mergeErrorMap)(this["~orpc"].errorMap,e)})}use(e,t){let r=t?D(e).mapInput(t):e;return new F({...this["~orpc"],middlewares:h(this["~orpc"].middlewares,r)})}meta(e){return new F({...this["~orpc"],meta:(0,n.mergeMeta)(this["~orpc"].meta,e)})}route(e){return new F({...this["~orpc"],route:(0,n.mergeRoute)(this["~orpc"].route,e)})}input(e){return new F({...this["~orpc"],inputSchema:e,inputValidationIndex:A("initialInputValidationIndex",this["~orpc"].config.initialInputValidationIndex)+this["~orpc"].middlewares.length})}output(e){return new F({...this["~orpc"],outputSchema:e,outputValidationIndex:A("initialOutputValidationIndex",this["~orpc"].config.initialOutputValidationIndex)+this["~orpc"].middlewares.length})}handler(e){return new B({...this["~orpc"],handler:e})}prefix(e){return new F({...this["~orpc"],prefix:(0,n.mergePrefix)(this["~orpc"].prefix,e)})}tag(...e){return new F({...this["~orpc"],tags:(0,n.mergeTags)(this["~orpc"].tags,e)})}router(e){return L(e,this["~orpc"])}lazy(e){return L(d(e),this["~orpc"])}}let Z=new F({config:{},route:{},meta:{},errorMap:{},inputValidationIndex:A("initialInputValidationIndex"),outputValidationIndex:A("initialOutputValidationIndex"),middlewares:[],dedupeLeadingMiddlewares:!0});function U(e,t,r){return(0,n.isContractProcedure)(e)?new F({...e["~orpc"],config:t,middlewares:r,inputValidationIndex:A("initialInputValidationIndex",t?.initialInputValidationIndex)+r.length,outputValidationIndex:A("initialOutputValidationIndex",t?.initialOutputValidationIndex)+r.length,dedupeLeadingMiddlewares:A("dedupeLeadingMiddlewares",t.dedupeLeadingMiddlewares)}):new Proxy(e,{get:(i,a)=>{let o;if("string"!=typeof a)return Reflect.get(i,a);"middleware"===a?o=e=>D(e):"use"===a?o=n=>U(e,t,h(r,n)):"router"===a?o=n=>E(L(n,{middlewares:r,errorMap:{},prefix:void 0,tags:void 0,dedupeLeadingMiddlewares:A("dedupeLeadingMiddlewares",t.dedupeLeadingMiddlewares)}),e):"lazy"===a&&(o=n=>E(L(d(n),{middlewares:r,errorMap:{},prefix:void 0,tags:void 0,dedupeLeadingMiddlewares:A("dedupeLeadingMiddlewares",t.dedupeLeadingMiddlewares)}),e));let u=(0,n.getContractRouter)(i,[a]);if(!u)return o??u;let l=U(u,t,r);return o?new Proxy(o,{get:(e,t)=>Reflect.get(l,t)}):l}})}function Y(e){return async(t,r)=>{let{default:i}=await c(C(e,r));if(!w(i))throw Error(`[inferRPCMethodFromRouter] No valid procedure found at path "${r.join(".")}". This may happen when the router is not properly configured.`);let a=(0,n.fallbackContractConfig)("defaultMethod",i["~orpc"].route.method);return"HEAD"===a?"GET":a}}}};
//# sourceMappingURL=683.js.map