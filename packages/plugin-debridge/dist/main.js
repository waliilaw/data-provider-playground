(()=>{"use strict";var __webpack_modules__={7616:function(e,t){let n="RUNTIME-001",r="RUNTIME-002",i="RUNTIME-003",o="RUNTIME-004",s="RUNTIME-005",a="RUNTIME-006",l="RUNTIME-007",u="RUNTIME-008",c="RUNTIME-009",h="TYPE-001",d="BUILD-001",f="BUILD-002",p=e=>{let t=e.split("-")[0].toLowerCase();return`View the docs to see how to solve: https://module-federation.io/guide/troubleshooting/${t}/${e}`},m=(e,t,n,r)=>{let i=[`${[t[e]]} #${e}`];return n&&i.push(`args: ${JSON.stringify(n)}`),i.push(p(e)),r&&i.push(`Original Error Message:
 ${r}`),i.join("\n")};function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let y={[n]:"Failed to get remoteEntry exports.",[r]:'The remote entry interface does not contain "init"',[i]:"Failed to get manifest.",[o]:"Failed to locate remote.",[s]:"Invalid loadShareSync function call from bundler runtime",[a]:"Invalid loadShareSync function call from runtime",[l]:"Failed to get remote snapshot.",[u]:"Failed to load script resources.",[c]:"Please call createInstance first."},_={[h]:"Failed to generate type declaration. Execute the below cmd to reproduce and fix the error."},v={[d]:"Failed to find expose module.",[f]:"PublicPath is required in prod mode."},b=g({},y,_,v);t.BUILD_001=d,t.BUILD_002=f,t.RUNTIME_001=n,t.RUNTIME_002=r,t.RUNTIME_003=i,t.RUNTIME_004=o,t.RUNTIME_005=s,t.RUNTIME_006=a,t.RUNTIME_007=l,t.RUNTIME_008=u,t.RUNTIME_009=c,t.TYPE_001=h,t.buildDescMap=v,t.errorDescMap=b,t.getShortErrorMsg=m,t.runtimeDescMap=y,t.typeDescMap=_},736:function(e,t,n){var r,i;i=n(5944),r=n(990),e.exports=(function(){class e{constructor(e={}){this.options=e,i.load(this.options,this.defaults,this),this.Events=new r(this),this._arr=[],this._resetPromise(),this._lastFlush=Date.now()}_resetPromise(){return this._promise=new this.Promise((e,t)=>this._resolve=e)}_flush(){return clearTimeout(this._timeout),this._lastFlush=Date.now(),this._resolve(),this.Events.trigger("batch",this._arr),this._arr=[],this._resetPromise()}add(e){var t;return this._arr.push(e),t=this._promise,this._arr.length===this.maxSize?this._flush():null!=this.maxTime&&1===this._arr.length&&(this._timeout=setTimeout(()=>this._flush(),this.maxTime)),t}}return e.prototype.defaults={maxTime:null,maxSize:null,Promise:Promise},e}).call(void 0)},1452:function(e,t,n){function r(e,t){return l(e)||i(e,t)||s()}function i(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}function o(e){return l(e)||a(e)||s()}function s(){throw TypeError("Invalid attempt to destructure non-iterable instance")}function a(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function l(e){if(Array.isArray(e))return e}function u(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){u(o,r,i,s,a,"next",e)}function a(e){u(o,r,i,s,a,"throw",e)}s(void 0)})}}var h,d,f,p,m,g,y,_,v,b,w=[].splice;m=10,h=5,b=n(5944),g=n(47),f=n(4284),p=n(87),y=n(5735),d=n(990),_=n(6553),v=n(9124),e.exports=(function(){class e{constructor(t={},...n){var r,i;this._addToQueue=this._addToQueue.bind(this),this._validateOptions(t,n),b.load(t,this.instanceDefaults,this),this._queues=new g(m),this._scheduled={},this._states=new _(["RECEIVED","QUEUED","RUNNING","EXECUTING"].concat(this.trackDoneStatus?["DONE"]:[])),this._limiter=null,this.Events=new d(this),this._submitLock=new v("submit",this.Promise),this._registerLock=new v("register",this.Promise),i=b.load(t,this.storeDefaults,{}),this._store=(function(){if("redis"===this.datastore||"ioredis"===this.datastore||null!=this.connection)return new y(this,i,r=b.load(t,this.redisStoreDefaults,{}));if("local"===this.datastore)return new p(this,i,r=b.load(t,this.localStoreDefaults,{}));throw new e.prototype.BottleneckError(`Invalid datastore type: ${this.datastore}`)}).call(this),this._queues.on("leftzero",()=>{var e;return null!=(e=this._store.heartbeat)&&"function"==typeof e.ref?e.ref():void 0}),this._queues.on("zero",()=>{var e;return null!=(e=this._store.heartbeat)&&"function"==typeof e.unref?e.unref():void 0})}_validateOptions(t,n){if(null==t||"object"!=typeof t||0!==n.length)throw new e.prototype.BottleneckError("Bottleneck v2 takes a single object argument. Refer to https://github.com/SGrondin/bottleneck#upgrading-to-v2 if you're upgrading from Bottleneck v1.")}ready(){return this._store.ready}clients(){return this._store.clients}channel(){return`b_${this.id}`}channel_client(){return`b_${this.id}_${this._store.clientId}`}publish(e){return this._store.__publish__(e)}disconnect(e=!0){return this._store.__disconnect__(e)}chain(e){return this._limiter=e,this}queued(e){return this._queues.queued(e)}clusterQueued(){return this._store.__queued__()}empty(){return 0===this.queued()&&this._submitLock.isEmpty()}running(){return this._store.__running__()}done(){return this._store.__done__()}jobStatus(e){return this._states.jobStatus(e)}jobs(e){return this._states.statusJobs(e)}counts(){return this._states.statusCounts()}_randomIndex(){return Math.random().toString(36).slice(2)}check(e=1){return this._store.__check__(e)}_clearGlobalState(e){return null!=this._scheduled[e]&&(clearTimeout(this._scheduled[e].expiration),delete this._scheduled[e],!0)}_free(e,t,n,r){var i=this;return c(function*(){var t,o;try{if(o=(yield i._store.__free__(e,n.weight)).running,i.Events.trigger("debug",`Freed ${n.id}`,r),0===o&&i.empty())return i.Events.trigger("idle")}catch(e){return t=e,i.Events.trigger("error",t)}})()}_run(e,t,n){var r,i,o;return t.doRun(),r=this._clearGlobalState.bind(this,e),o=this._run.bind(this,e,t),i=this._free.bind(this,e,t),this._scheduled[e]={timeout:setTimeout(()=>t.doExecute(this._limiter,r,o,i),n),expiration:null!=t.options.expiration?setTimeout(function(){return t.doExpire(r,o,i)},n+t.options.expiration):void 0,job:t}}_drainOne(e){return this._registerLock.schedule(()=>{if(0===this.queued())return this.Promise.resolve(null);var t,n,r,i,o=this._queues.getFirst(),s=r=o.first();return(i=s.options,t=s.args,null!=e&&i.weight>e)?this.Promise.resolve(null):(this.Events.trigger("debug",`Draining ${i.id}`,{args:t,options:i}),n=this._randomIndex(),this._store.__register__(n,i.weight,i.expiration).then(({success:e,wait:s,reservoir:a})=>{var l;return(this.Events.trigger("debug",`Drained ${i.id}`,{success:e,args:t,options:i}),e)?(o.shift(),(l=this.empty())&&this.Events.trigger("empty"),0===a&&this.Events.trigger("depleted",l),this._run(n,r,s),this.Promise.resolve(i.weight)):this.Promise.resolve(null)}))})}_drainAll(e,t=0){return this._drainOne(e).then(n=>{var r;return null!=n?(r=null!=e?e-n:e,this._drainAll(r,t+n)):this.Promise.resolve(t)}).catch(e=>this.Events.trigger("error",e))}_dropAllQueued(e){return this._queues.shiftAll(function(t){return t.doDrop({message:e})})}stop(t={}){var n,r;return t=b.load(t,this.stopDefaults),r=e=>{var t;return t=()=>{var t;return(t=this._states.counts)[0]+t[1]+t[2]+t[3]===e},new this.Promise((e,n)=>t()?e():this.on("done",()=>{if(t())return this.removeAllListeners("done"),e()}))},n=t.dropWaitingJobs?(this._run=function(e,n){return n.doDrop({message:t.dropErrorMessage})},this._drainOne=()=>this.Promise.resolve(null),this._registerLock.schedule(()=>this._submitLock.schedule(()=>{var e,n,i;for(e in n=this._scheduled)i=n[e],"RUNNING"===this.jobStatus(i.job.options.id)&&(clearTimeout(i.timeout),clearTimeout(i.expiration),i.job.doDrop({message:t.dropErrorMessage}));return this._dropAllQueued(t.dropErrorMessage),r(0)}))):this.schedule({priority:m-1,weight:0},()=>r(1)),this._receive=function(n){return n._reject(new e.prototype.BottleneckError(t.enqueueErrorMessage))},this.stop=()=>this.Promise.reject(new e.prototype.BottleneckError("stop() has already been called")),n}_addToQueue(t){var n=this;return c(function*(){var r,i,o,s,a,l,u;r=t.args,s=t.options;try{var c=yield n._store.__submit__(n.queued(),s.weight);a=c.reachedHWM,i=c.blocked,u=c.strategy}catch(e){return o=e,n.Events.trigger("debug",`Could not queue ${s.id}`,{args:r,options:s,error:o}),t.doDrop({error:o}),!1}return i?(t.doDrop(),!0):a&&(null!=(l=u===e.prototype.strategy.LEAK?n._queues.shiftLastFrom(s.priority):u===e.prototype.strategy.OVERFLOW_PRIORITY?n._queues.shiftLastFrom(s.priority+1):u===e.prototype.strategy.OVERFLOW?t:void 0)&&l.doDrop(),null==l||u===e.prototype.strategy.OVERFLOW)?(null==l&&t.doDrop(),a):(t.doQueue(a,i),n._queues.push(t),yield n._drainAll(),a)})()}_receive(t){return null!=this._states.jobStatus(t.options.id)?(t._reject(new e.prototype.BottleneckError(`A job with the same id already exists (id=${t.options.id})`)),!1):(t.doReceive(),this._submitLock.schedule(this._addToQueue,t))}submit(...e){var t,n,i,s,a,l;return"function"==typeof e[0]?(n=(a=o(e))[0],e=a.slice(1),t=r(w.call(e,-1),1)[0],s=b.load({},this.jobDefaults)):(s=(l=o(e))[0],n=l[1],e=l.slice(2),t=r(w.call(e,-1),1)[0],s=b.load(s,this.jobDefaults)),(i=new f((...e)=>new this.Promise(function(t,r){return n(...e,function(...e){return(null!=e[0]?r:t)(e)})}),e,s,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise)).promise.then(function(e){return"function"==typeof t?t(...e):void 0}).catch(function(e){return Array.isArray(e)?"function"==typeof t?t(...e):void 0:"function"==typeof t?t(e):void 0}),this._receive(i)}schedule(...e){var t,n,r;if("function"==typeof e[0]){var i=o(e);r=i[0],e=i.slice(1),n={}}else{var s=o(e);n=s[0],r=s[1],e=s.slice(2)}return t=new f(r,e,n,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise),this._receive(t),t.promise}wrap(e){var t,n;return t=this.schedule.bind(this),(n=function(...n){return t(e.bind(this),...n)}).withOptions=function(n,...r){return t(n,e,...r)},n}updateSettings(e={}){var t=this;return c(function*(){return yield t._store.__updateSettings__(b.overwrite(e,t.storeDefaults)),b.overwrite(e,t.instanceDefaults,t),t})()}currentReservoir(){return this._store.__currentReservoir__()}incrementReservoir(e=0){return this._store.__incrementReservoir__(e)}}return e.default=e,e.Events=d,e.version=e.prototype.version=n(4006).r,e.strategy=e.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3},e.BottleneckError=e.prototype.BottleneckError=n(4916),e.Group=e.prototype.Group=n(3996),e.RedisConnection=e.prototype.RedisConnection=n(9588),e.IORedisConnection=e.prototype.IORedisConnection=n(3400),e.Batcher=e.prototype.Batcher=n(736),e.prototype.jobDefaults={priority:h,weight:1,expiration:null,id:"<no-id>"},e.prototype.storeDefaults={maxConcurrent:null,minTime:0,highWater:null,strategy:e.prototype.strategy.LEAK,penalty:null,reservoir:null,reservoirRefreshInterval:null,reservoirRefreshAmount:null,reservoirIncreaseInterval:null,reservoirIncreaseAmount:null,reservoirIncreaseMaximum:null},e.prototype.localStoreDefaults={Promise:Promise,timeout:null,heartbeatInterval:250},e.prototype.redisStoreDefaults={Promise:Promise,timeout:null,heartbeatInterval:5e3,clientTimeout:1e4,Redis:null,clientOptions:{},clusterNodes:null,clearDatastore:!1,connection:null},e.prototype.instanceDefaults={datastore:"local",connection:null,id:"<no-id>",rejectOnDrop:!0,trackDoneStatus:!1,Promise:Promise},e.prototype.stopDefaults={enqueueErrorMessage:"This limiter has been stopped and cannot accept new jobs.",dropWaitingJobs:!0,dropErrorMessage:"This limiter has been stopped."},e}).call(void 0)},4916:function(e){e.exports=class extends Error{}},1979:function(e){e.exports=class{constructor(e,t){this.incr=e,this.decr=t,this._first=null,this._last=null,this.length=0}push(e){var t;this.length++,"function"==typeof this.incr&&this.incr(),t={value:e,prev:this._last,next:null},null!=this._last?(this._last.next=t,this._last=t):this._first=this._last=t}shift(){var e;return null==this._first?void 0:(this.length--,"function"==typeof this.decr&&this.decr(),e=this._first.value,null!=(this._first=this._first.next)?this._first.prev=null:this._last=null,e)}first(){if(null!=this._first)return this._first.value}getArray(){var e,t,n;for(e=this._first,n=[];null!=e;)n.push((t=e,e=e.next,t.value));return n}forEachShift(e){var t;for(t=this.shift();null!=t;)e(t),t=this.shift()}debug(){var e,t,n,r,i;for(e=this._first,i=[];null!=e;)i.push((t=e,e=e.next,{value:t.value,prev:null!=(n=t.prev)?n.value:void 0,next:null!=(r=t.next)?r.value:void 0}));return i}}},990:function(e){function t(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function n(e){return function(){var n=this,r=arguments;return new Promise(function(i,o){var s=e.apply(n,r);function a(e){t(s,i,o,a,l,"next",e)}function l(e){t(s,i,o,a,l,"throw",e)}a(void 0)})}}e.exports=class{constructor(e){if(this.instance=e,this._events={},null!=this.instance.on||null!=this.instance.once||null!=this.instance.removeAllListeners)throw Error("An Emitter already exists for this object");this.instance.on=(e,t)=>this._addListener(e,"many",t),this.instance.once=(e,t)=>this._addListener(e,"once",t),this.instance.removeAllListeners=(e=null)=>null!=e?delete this._events[e]:this._events={}}_addListener(e,t,n){var r;return null==(r=this._events)[e]&&(r[e]=[]),this._events[e].push({cb:n,status:t}),this.instance}listenerCount(e){return null!=this._events[e]?this._events[e].length:0}trigger(e,...t){var r=this;return n(function*(){var i,o;try{if("debug"!==e&&r.trigger("debug",`Event triggered: ${e}`,t),null==r._events[e])return;return r._events[e]=r._events[e].filter(function(e){return"none"!==e.status}),o=r._events[e].map(function(){var e=n(function*(e){var n,i;if("none"!==e.status){"once"===e.status&&(e.status="none");try{if(i="function"==typeof e.cb?e.cb(...t):void 0,"function"==typeof(null!=i?i.then:void 0))return yield i;return i}catch(e){return n=e,r.trigger("error",n),null}}});return function(t){return e.apply(this,arguments)}}()),(yield Promise.all(o)).find(function(e){return null!=e})}catch(e){return i=e,r.trigger("error",i),null}})()}}},3996:function(e,t,n){var r,i,o,s,a;function l(e,t){return h(e)||c(e,t)||u()}function u(){throw TypeError("Invalid attempt to destructure non-iterable instance")}function c(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}function h(e){if(Array.isArray(e))return e}function d(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){d(o,r,i,s,a,"next",e)}function a(e){d(o,r,i,s,a,"throw",e)}s(void 0)})}}a=n(5944),r=n(990),o=n(9588),i=n(3400),s=n(4035),e.exports=(function(){class e{constructor(e={}){this.deleteKey=this.deleteKey.bind(this),this.limiterOptions=e,a.load(this.limiterOptions,this.defaults,this),this.Events=new r(this),this.instances={},this.Bottleneck=n(1452),this._startAutoCleanup(),this.sharedConnection=null!=this.connection,null==this.connection&&("redis"===this.limiterOptions.datastore?this.connection=new o(Object.assign({},this.limiterOptions,{Events:this.Events})):"ioredis"===this.limiterOptions.datastore&&(this.connection=new i(Object.assign({},this.limiterOptions,{Events:this.Events}))))}key(e=""){var t;return null!=(t=this.instances[e])?t:(()=>{var t;return t=this.instances[e]=new this.Bottleneck(Object.assign(this.limiterOptions,{id:`${this.id}-${e}`,timeout:this.timeout,connection:this.connection})),this.Events.trigger("created",t,e),t})()}deleteKey(e=""){var t=this;return f(function*(){var n,r;return r=t.instances[e],t.connection&&(n=yield t.connection.__runCommand__(["del",...s.allKeys(`${t.id}-${e}`)])),null!=r&&(delete t.instances[e],yield r.disconnect()),null!=r||n>0})()}limiters(){var e,t,n,r;for(e in t=this.instances,n=[],t)r=t[e],n.push({key:e,limiter:r});return n}keys(){return Object.keys(this.instances)}clusterKeys(){var e=this;return f(function*(){var t,n,r,i,o,s,a,u,c;if(null==e.connection)return e.Promise.resolve(e.keys());for(s=[],t=null,c=`b_${e.id}-`.length,n=9;0!==t;){var h=l((yield e.connection.__runCommand__(["scan",null!=t?t:0,"match",`b_${e.id}-*_settings`,"count",1e4])),2);for(i=0,u=h[0],r=h[1],t=~~u,a=r.length;i<a;i++)o=r[i],s.push(o.slice(c,-n))}return s})()}_startAutoCleanup(){var e,t=this;return clearInterval(this.interval),"function"==typeof(e=this.interval=setInterval(f(function*(){var e,n,r,i,o,s;for(n in o=Date.now(),r=t.instances,i=[],r){s=r[n];try{(yield s._store.__groupCheck__(o))?i.push(t.deleteKey(n)):i.push(void 0)}catch(t){e=t,i.push(s.Events.trigger("error",e))}}return i}),this.timeout/2)).unref?e.unref():void 0}updateSettings(e={}){if(a.overwrite(e,this.defaults,this),a.overwrite(e,e,this.limiterOptions),null!=e.timeout)return this._startAutoCleanup()}disconnect(e=!0){var t;if(!this.sharedConnection)return null!=(t=this.connection)?t.disconnect(e):void 0}}return e.prototype.defaults={timeout:3e5,connection:null,Promise:Promise,id:"group-key"},e}).call(void 0)},3400:function(module,__unused_webpack_exports,__webpack_require__){var Events,IORedisConnection,Scripts,parser;function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){asyncGeneratorStep(o,r,i,s,a,"next",e)}function a(e){asyncGeneratorStep(o,r,i,s,a,"throw",e)}s(void 0)})}}parser=__webpack_require__(5944),Events=__webpack_require__(990),Scripts=__webpack_require__(4035),IORedisConnection=(function(){class IORedisConnection{constructor(options={}){parser.load(options,this.defaults,this),null==this.Redis&&(this.Redis=eval("require")("ioredis")),null==this.Events&&(this.Events=new Events(this)),this.terminated=!1,null!=this.clusterNodes?(this.client=new this.Redis.Cluster(this.clusterNodes,this.clientOptions),this.subscriber=new this.Redis.Cluster(this.clusterNodes,this.clientOptions)):null!=this.client&&null==this.client.duplicate?this.subscriber=new this.Redis.Cluster(this.client.startupNodes,this.client.options):(null==this.client&&(this.client=new this.Redis(this.clientOptions)),this.subscriber=this.client.duplicate()),this.limiters={},this.ready=this.Promise.all([this._setup(this.client,!1),this._setup(this.subscriber,!0)]).then(()=>(this._loadScripts(),{client:this.client,subscriber:this.subscriber}))}_setup(e,t){return e.setMaxListeners(0),new this.Promise((n,r)=>(e.on("error",e=>this.Events.trigger("error",e)),t&&e.on("message",(e,t)=>{var n;return null!=(n=this.limiters[e])?n._store.onMessage(e,t):void 0}),"ready"===e.status)?n():e.once("ready",n))}_loadScripts(){return Scripts.names.forEach(e=>this.client.defineCommand(e,{lua:Scripts.payload(e)}))}__runCommand__(e){var t=this;return _asyncToGenerator(function*(){yield t.ready;var n,r=_slicedToArray((yield t.client.pipeline([e]).exec()),1),i=_slicedToArray(r[0],2);return n=i[0],i[1]})()}__addLimiter__(e){return this.Promise.all([e.channel(),e.channel_client()].map(t=>new this.Promise((n,r)=>this.subscriber.subscribe(t,()=>(this.limiters[t]=e,n())))))}__removeLimiter__(e){var t=this;return[e.channel(),e.channel_client()].forEach(function(){var e=_asyncToGenerator(function*(e){return t.terminated||(yield t.subscriber.unsubscribe(e)),delete t.limiters[e]});return function(t){return e.apply(this,arguments)}}())}__scriptArgs__(e,t,n,r){var i;return[(i=Scripts.keys(e,t)).length].concat(i,n,r)}__scriptFn__(e){return this.client[e].bind(this.client)}disconnect(e=!0){var t,n,r,i;for(t=0,r=(i=Object.keys(this.limiters)).length;t<r;t++)n=i[t],clearInterval(this.limiters[n]._store.heartbeat);return(this.limiters={},this.terminated=!0,e)?this.Promise.all([this.client.quit(),this.subscriber.quit()]):(this.client.disconnect(),this.subscriber.disconnect(),this.Promise.resolve())}}return IORedisConnection.prototype.datastore="ioredis",IORedisConnection.prototype.defaults={Redis:null,clientOptions:{},clusterNodes:null,client:null,Promise:Promise,Events:null},IORedisConnection}).call(void 0),module.exports=IORedisConnection},4284:function(e,t,n){var r,i,o,s;function a(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){a(o,r,i,s,l,"next",e)}function l(e){a(o,r,i,s,l,"throw",e)}s(void 0)})}}o=10,i=5,s=n(5944),r=n(4916),e.exports=class{constructor(e,t,n,r,i,o,a,l){this.task=e,this.args=t,this.rejectOnDrop=i,this.Events=o,this._states=a,this.Promise=l,this.options=s.load(n,r),this.options.priority=this._sanitizePriority(this.options.priority),this.options.id===r.id&&(this.options.id=`${this.options.id}-${this._randomIndex()}`),this.promise=new this.Promise((e,t)=>{this._resolve=e,this._reject=t}),this.retryCount=0}_sanitizePriority(e){var t;return(t=~~e!==e?i:e)<0?0:t>o-1?o-1:t}_randomIndex(){return Math.random().toString(36).slice(2)}doDrop({error:e,message:t="This job has been dropped by Bottleneck"}={}){return!!this._states.remove(this.options.id)&&(this.rejectOnDrop&&this._reject(null!=e?e:new r(t)),this.Events.trigger("dropped",{args:this.args,options:this.options,task:this.task,promise:this.promise}),!0)}_assertStatus(e){var t;if((t=this._states.jobStatus(this.options.id))!==e&&("DONE"!==e||null!==t))throw new r(`Invalid job status ${t}, expected ${e}. Please open an issue at https://github.com/SGrondin/bottleneck/issues`)}doReceive(){return this._states.start(this.options.id),this.Events.trigger("received",{args:this.args,options:this.options})}doQueue(e,t){return this._assertStatus("RECEIVED"),this._states.next(this.options.id),this.Events.trigger("queued",{args:this.args,options:this.options,reachedHWM:e,blocked:t})}doRun(){return 0===this.retryCount?(this._assertStatus("QUEUED"),this._states.next(this.options.id)):this._assertStatus("EXECUTING"),this.Events.trigger("scheduled",{args:this.args,options:this.options})}doExecute(e,t,n,r){var i=this;return l(function*(){var o,s,a;0===i.retryCount?(i._assertStatus("RUNNING"),i._states.next(i.options.id)):i._assertStatus("EXECUTING"),s={args:i.args,options:i.options,retryCount:i.retryCount},i.Events.trigger("executing",s);try{if(a=yield null!=e?e.schedule(i.options,i.task,...i.args):i.task(...i.args),t())return i.doDone(s),yield r(i.options,s),i._assertStatus("DONE"),i._resolve(a)}catch(e){return o=e,i._onFailure(o,s,t,n,r)}})()}doExpire(e,t,n){var i,o;return this._states.jobStatus("RUNNING"===this.options.id)&&this._states.next(this.options.id),this._assertStatus("EXECUTING"),o={args:this.args,options:this.options,retryCount:this.retryCount},i=new r(`This job timed out after ${this.options.expiration} ms.`),this._onFailure(i,o,e,t,n)}_onFailure(e,t,n,r,i){var o=this;return l(function*(){var s,a;if(n())return null!=(s=yield o.Events.trigger("failed",e,t))?(a=~~s,o.Events.trigger("retry",`Retrying ${o.options.id} after ${a} ms`,t),o.retryCount++,r(a)):(o.doDone(t),yield i(o.options,t),o._assertStatus("DONE"),o._reject(e))})()}doDone(e){return this._assertStatus("EXECUTING"),this._states.next(this.options.id),this.Events.trigger("done",e)}}},87:function(e,t,n){var r,i;function o(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){o(s,r,i,a,l,"next",e)}function l(e){o(s,r,i,a,l,"throw",e)}a(void 0)})}}i=n(5944),r=n(4916),e.exports=class{constructor(e,t,n){this.instance=e,this.storeOptions=t,this.clientId=this.instance._randomIndex(),i.load(n,n,this),this._nextRequest=this._lastReservoirRefresh=this._lastReservoirIncrease=Date.now(),this._running=0,this._done=0,this._unblockTime=0,this.ready=this.Promise.resolve(),this.clients={},this._startHeartbeat()}_startHeartbeat(){var e;return null==this.heartbeat&&(null!=this.storeOptions.reservoirRefreshInterval&&null!=this.storeOptions.reservoirRefreshAmount||null!=this.storeOptions.reservoirIncreaseInterval&&null!=this.storeOptions.reservoirIncreaseAmount)?"function"==typeof(e=this.heartbeat=setInterval(()=>{var e,t,n,r,i;if(r=Date.now(),null!=this.storeOptions.reservoirRefreshInterval&&r>=this._lastReservoirRefresh+this.storeOptions.reservoirRefreshInterval&&(this._lastReservoirRefresh=r,this.storeOptions.reservoir=this.storeOptions.reservoirRefreshAmount,this.instance._drainAll(this.computeCapacity())),null!=this.storeOptions.reservoirIncreaseInterval&&r>=this._lastReservoirIncrease+this.storeOptions.reservoirIncreaseInterval){var o=this.storeOptions;if(e=o.reservoirIncreaseAmount,n=o.reservoirIncreaseMaximum,i=o.reservoir,this._lastReservoirIncrease=r,(t=null!=n?Math.min(e,n-i):e)>0)return this.storeOptions.reservoir+=t,this.instance._drainAll(this.computeCapacity())}},this.heartbeatInterval)).unref?e.unref():void 0:clearInterval(this.heartbeat)}__publish__(e){var t=this;return s(function*(){return yield t.yieldLoop(),t.instance.Events.trigger("message",e.toString())})()}__disconnect__(e){var t=this;return s(function*(){return yield t.yieldLoop(),clearInterval(t.heartbeat),t.Promise.resolve()})()}yieldLoop(e=0){return new this.Promise(function(t,n){return setTimeout(t,e)})}computePenalty(){var e;return null!=(e=this.storeOptions.penalty)?e:15*this.storeOptions.minTime||5e3}__updateSettings__(e){var t=this;return s(function*(){return yield t.yieldLoop(),i.overwrite(e,e,t.storeOptions),t._startHeartbeat(),t.instance._drainAll(t.computeCapacity()),!0})()}__running__(){var e=this;return s(function*(){return yield e.yieldLoop(),e._running})()}__queued__(){var e=this;return s(function*(){return yield e.yieldLoop(),e.instance.queued()})()}__done__(){var e=this;return s(function*(){return yield e.yieldLoop(),e._done})()}__groupCheck__(e){var t=this;return s(function*(){return yield t.yieldLoop(),t._nextRequest+t.timeout<e})()}computeCapacity(){var e,t,n=this.storeOptions;return(e=n.maxConcurrent,t=n.reservoir,null!=e&&null!=t)?Math.min(e-this._running,t):null!=e?e-this._running:null!=t?t:null}conditionsCheck(e){var t;return null==(t=this.computeCapacity())||e<=t}__incrementReservoir__(e){var t=this;return s(function*(){var n;return yield t.yieldLoop(),n=t.storeOptions.reservoir+=e,t.instance._drainAll(t.computeCapacity()),n})()}__currentReservoir__(){var e=this;return s(function*(){return yield e.yieldLoop(),e.storeOptions.reservoir})()}isBlocked(e){return this._unblockTime>=e}check(e,t){return this.conditionsCheck(e)&&this._nextRequest-t<=0}__check__(e){var t=this;return s(function*(){var n;return yield t.yieldLoop(),n=Date.now(),t.check(e,n)})()}__register__(e,t,n){var r=this;return s(function*(){var e,n;return(yield r.yieldLoop(),e=Date.now(),r.conditionsCheck(t))?(r._running+=t,null!=r.storeOptions.reservoir&&(r.storeOptions.reservoir-=t),n=Math.max(r._nextRequest-e,0),r._nextRequest=e+n+r.storeOptions.minTime,{success:!0,wait:n,reservoir:r.storeOptions.reservoir}):{success:!1}})()}strategyIsBlock(){return 3===this.storeOptions.strategy}__submit__(e,t){var n=this;return s(function*(){var i,o,s;if(yield n.yieldLoop(),null!=n.storeOptions.maxConcurrent&&t>n.storeOptions.maxConcurrent)throw new r(`Impossible to add a job having a weight of ${t} to a limiter having a maxConcurrent setting of ${n.storeOptions.maxConcurrent}`);return o=Date.now(),s=null!=n.storeOptions.highWater&&e===n.storeOptions.highWater&&!n.check(t,o),(i=n.strategyIsBlock()&&(s||n.isBlocked(o)))&&(n._unblockTime=o+n.computePenalty(),n._nextRequest=n._unblockTime+n.storeOptions.minTime,n.instance._dropAllQueued()),{reachedHWM:s,blocked:i,strategy:n.storeOptions.strategy}})()}__free__(e,t){var n=this;return s(function*(){return yield n.yieldLoop(),n._running-=t,n._done+=t,n.instance._drainAll(n.computeCapacity()),{running:n._running}})()}}},47:function(e,t,n){var r,i;r=n(1979),i=n(990),e.exports=class{constructor(e){var t;this.Events=new i(this),this._length=0,this._lists=(function(){var n,i,o;for(o=[],t=n=1,i=e;1<=i?n<=i:n>=i;t=1<=i?++n:--n)o.push(new r(()=>this.incr(),()=>this.decr()));return o}).call(this)}incr(){if(0==this._length++)return this.Events.trigger("leftzero")}decr(){if(0==--this._length)return this.Events.trigger("zero")}push(e){return this._lists[e.options.priority].push(e)}queued(e){return null!=e?this._lists[e].length:this._length}shiftAll(e){return this._lists.forEach(function(t){return t.forEachShift(e)})}getFirst(e=this._lists){var t,n,r;for(t=0,n=e.length;t<n;t++)if((r=e[t]).length>0)return r;return[]}shiftLastFrom(e){return this.getFirst(this._lists.slice(e).reverse()).shift()}}},9588:function(module,__unused_webpack_exports,__webpack_require__){var Events,RedisConnection,Scripts,parser;function asyncGeneratorStep(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){asyncGeneratorStep(o,r,i,s,a,"next",e)}function a(e){asyncGeneratorStep(o,r,i,s,a,"throw",e)}s(void 0)})}}parser=__webpack_require__(5944),Events=__webpack_require__(990),Scripts=__webpack_require__(4035),RedisConnection=(function(){class RedisConnection{constructor(options={}){parser.load(options,this.defaults,this),null==this.Redis&&(this.Redis=eval("require")("redis")),null==this.Events&&(this.Events=new Events(this)),this.terminated=!1,null==this.client&&(this.client=this.Redis.createClient(this.clientOptions)),this.subscriber=this.client.duplicate(),this.limiters={},this.shas={},this.ready=this.Promise.all([this._setup(this.client,!1),this._setup(this.subscriber,!0)]).then(()=>this._loadScripts()).then(()=>({client:this.client,subscriber:this.subscriber}))}_setup(e,t){return e.setMaxListeners(0),new this.Promise((n,r)=>(e.on("error",e=>this.Events.trigger("error",e)),t&&e.on("message",(e,t)=>{var n;return null!=(n=this.limiters[e])?n._store.onMessage(e,t):void 0}),e.ready)?n():e.once("ready",n))}_loadScript(e){return new this.Promise((t,n)=>{var r;return r=Scripts.payload(e),this.client.multi([["script","load",r]]).exec((r,i)=>null!=r?n(r):(this.shas[e]=i[0],t(i[0])))})}_loadScripts(){return this.Promise.all(Scripts.names.map(e=>this._loadScript(e)))}__runCommand__(e){var t=this;return _asyncToGenerator(function*(){return yield t.ready,new t.Promise((n,r)=>t.client.multi([e]).exec_atomic(function(e,t){return null!=e?r(e):n(t[0])}))})()}__addLimiter__(e){return this.Promise.all([e.channel(),e.channel_client()].map(t=>new this.Promise((n,r)=>{var i;return i=r=>{if(r===t)return this.subscriber.removeListener("subscribe",i),this.limiters[t]=e,n()},this.subscriber.on("subscribe",i),this.subscriber.subscribe(t)})))}__removeLimiter__(e){var t=this;return this.Promise.all([e.channel(),e.channel_client()].map(function(){var e=_asyncToGenerator(function*(e){return t.terminated||(yield new t.Promise((n,r)=>t.subscriber.unsubscribe(e,function(t,i){return null!=t?r(t):i===e?n():void 0}))),delete t.limiters[e]});return function(t){return e.apply(this,arguments)}}()))}__scriptArgs__(e,t,n,r){var i;return i=Scripts.keys(e,t),[this.shas[e],i.length].concat(i,n,r)}__scriptFn__(e){return this.client.evalsha.bind(this.client)}disconnect(e=!0){var t,n,r,i;for(t=0,r=(i=Object.keys(this.limiters)).length;t<r;t++)n=i[t],clearInterval(this.limiters[n]._store.heartbeat);return this.limiters={},this.terminated=!0,this.client.end(e),this.subscriber.end(e),this.Promise.resolve()}}return RedisConnection.prototype.datastore="redis",RedisConnection.prototype.defaults={Redis:null,clientOptions:{},client:null,Promise:Promise,Events:null},RedisConnection}).call(void 0),module.exports=RedisConnection},5735:function(e,t,n){var r,i,o,s;function a(e,t){return c(e)||u(e,t)||l()}function l(){throw TypeError("Invalid attempt to destructure non-iterable instance")}function u(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}function c(e){if(Array.isArray(e))return e}function h(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function d(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){h(o,r,i,s,a,"next",e)}function a(e){h(o,r,i,s,a,"throw",e)}s(void 0)})}}s=n(5944),r=n(4916),o=n(9588),i=n(3400),e.exports=class{constructor(e,t,n){this.instance=e,this.storeOptions=t,this.originalId=this.instance.id,this.clientId=this.instance._randomIndex(),s.load(n,n,this),this.clients={},this.capacityPriorityCounters={},this.sharedConnection=null!=this.connection,null==this.connection&&(this.connection="redis"===this.instance.datastore?new o({Redis:this.Redis,clientOptions:this.clientOptions,Promise:this.Promise,Events:this.instance.Events}):"ioredis"===this.instance.datastore?new i({Redis:this.Redis,clientOptions:this.clientOptions,clusterNodes:this.clusterNodes,Promise:this.Promise,Events:this.instance.Events}):void 0),this.instance.connection=this.connection,this.instance.datastore=this.connection.datastore,this.ready=this.connection.ready.then(e=>(this.clients=e,this.runScript("init",this.prepareInitSettings(this.clearDatastore)))).then(()=>this.connection.__addLimiter__(this.instance)).then(()=>this.runScript("register_client",[this.instance.queued()])).then(()=>{var e;return"function"==typeof(e=this.heartbeat=setInterval(()=>this.runScript("heartbeat",[]).catch(e=>this.instance.Events.trigger("error",e)),this.heartbeatInterval)).unref&&e.unref(),this.clients})}__publish__(e){var t=this;return d(function*(){return(yield t.ready).client.publish(t.instance.channel(),`message:${e.toString()}`)})()}onMessage(e,t){var n=this;return d(function*(){var e,r,i,o,s,l,u,c,h,f;try{u=t.indexOf(":");var p=[t.slice(0,u),t.slice(u+1)];if(f=p[0],i=p[1],"capacity"===f)return yield n.instance._drainAll(i.length>0?~~i:void 0);if("capacity-priority"===f){var m=i.split(":"),g=a(m,3);if(h=g[0],c=g[1],r=g[2],e=h.length>0?~~h:void 0,c===n.clientId)return o=yield n.instance._drainAll(e),l=null!=e?e-(o||0):"",yield n.clients.client.publish(n.instance.channel(),`capacity-priority:${l}::${r}`);if(""===c)return clearTimeout(n.capacityPriorityCounters[r]),delete n.capacityPriorityCounters[r],n.instance._drainAll(e);return n.capacityPriorityCounters[r]=setTimeout(d(function*(){var t;try{return delete n.capacityPriorityCounters[r],yield n.runScript("blacklist_client",[c]),yield n.instance._drainAll(e)}catch(e){return t=e,n.instance.Events.trigger("error",t)}}),1e3)}if("message"===f)return n.instance.Events.trigger("message",i);else if("blocked"===f)return yield n.instance._dropAllQueued()}catch(e){return s=e,n.instance.Events.trigger("error",s)}})()}__disconnect__(e){return(clearInterval(this.heartbeat),this.sharedConnection)?this.connection.__removeLimiter__(this.instance):this.connection.disconnect(e)}runScript(e,t){var n=this;return d(function*(){return"init"!==e&&"register_client"!==e&&(yield n.ready),new n.Promise((r,i)=>{var o,s;return o=[Date.now(),n.clientId].concat(t),n.instance.Events.trigger("debug",`Calling Redis script: ${e}.lua`,o),s=n.connection.__scriptArgs__(e,n.originalId,o,function(e,t){return null!=e?i(e):r(t)}),n.connection.__scriptFn__(e)(...s)}).catch(r=>{if("SETTINGS_KEY_NOT_FOUND"===r.message)if("heartbeat"===e)return n.Promise.resolve();else return n.runScript("init",n.prepareInitSettings(!1)).then(()=>n.runScript(e,t));return"UNKNOWN_CLIENT"===r.message?n.runScript("register_client",[n.instance.queued()]).then(()=>n.runScript(e,t)):n.Promise.reject(r)})})()}prepareArray(e){var t,n,r,i;for(t=0,r=[],n=e.length;t<n;t++)i=e[t],r.push(null!=i?i.toString():"");return r}prepareObject(e){var t,n,r;for(n in t=[],e)r=e[n],t.push(n,null!=r?r.toString():"");return t}prepareInitSettings(e){var t;return(t=this.prepareObject(Object.assign({},this.storeOptions,{id:this.originalId,version:this.instance.version,groupTimeout:this.timeout,clientTimeout:this.clientTimeout}))).unshift(+!!e,this.instance.version),t}convertBool(e){return!!e}__updateSettings__(e){var t=this;return d(function*(){return yield t.runScript("update_settings",t.prepareObject(e)),s.overwrite(e,e,t.storeOptions)})()}__running__(){return this.runScript("running",[])}__queued__(){return this.runScript("queued",[])}__done__(){return this.runScript("done",[])}__groupCheck__(){var e=this;return d(function*(){return e.convertBool((yield e.runScript("group_check",[])))})()}__incrementReservoir__(e){return this.runScript("increment_reservoir",[e])}__currentReservoir__(){return this.runScript("current_reservoir",[])}__check__(e){var t=this;return d(function*(){return t.convertBool((yield t.runScript("check",t.prepareArray([e]))))})()}__register__(e,t,n){var r=this;return d(function*(){var i,o,s,l=a((yield r.runScript("register",r.prepareArray([e,t,n]))),3);return o=l[0],s=l[1],i=l[2],{success:r.convertBool(o),wait:s,reservoir:i}})()}__submit__(e,t){var n=this;return d(function*(){var i,o,s,l,u,c;try{var h=yield n.runScript("submit",n.prepareArray([e,t])),d=a(h,3);return u=d[0],i=d[1],c=d[2],{reachedHWM:n.convertBool(u),blocked:n.convertBool(i),strategy:c}}catch(e){if(0===(o=e).message.indexOf("OVERWEIGHT")){var f=a(o.message.split(":"),3);throw l=f[0],t=f[1],s=f[2],new r(`Impossible to add a job having a weight of ${t} to a limiter having a maxConcurrent setting of ${s}`)}throw o}})()}__free__(e,t){var n=this;return d(function*(){return{running:yield n.runScript("free",n.prepareArray([e]))}})()}}},4035:function(e,t,n){var r,i,o;r={refs:(i=n(2168))["refs.lua"],validate_keys:i["validate_keys.lua"],validate_client:i["validate_client.lua"],refresh_expiration:i["refresh_expiration.lua"],process_tick:i["process_tick.lua"],conditions_check:i["conditions_check.lua"],get_time:i["get_time.lua"]},t.allKeys=function(e){return[`b_${e}_settings`,`b_${e}_job_weights`,`b_${e}_job_expirations`,`b_${e}_job_clients`,`b_${e}_client_running`,`b_${e}_client_num_queued`,`b_${e}_client_last_registered`,`b_${e}_client_last_seen`]},o={init:{keys:t.allKeys,headers:["process_tick"],refresh_expiration:!0,code:i["init.lua"]},group_check:{keys:t.allKeys,headers:[],refresh_expiration:!1,code:i["group_check.lua"]},register_client:{keys:t.allKeys,headers:["validate_keys"],refresh_expiration:!1,code:i["register_client.lua"]},blacklist_client:{keys:t.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:!1,code:i["blacklist_client.lua"]},heartbeat:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:i["heartbeat.lua"]},update_settings:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:i["update_settings.lua"]},running:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:i["running.lua"]},queued:{keys:t.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:!1,code:i["queued.lua"]},done:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:i["done.lua"]},check:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!1,code:i["check.lua"]},submit:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!0,code:i["submit.lua"]},register:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!0,code:i["register.lua"]},free:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:i["free.lua"]},current_reservoir:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:i["current_reservoir.lua"]},increment_reservoir:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:i["increment_reservoir.lua"]}},t.names=Object.keys(o),t.keys=function(e,t){return o[e].keys(t)},t.payload=function(e){var t;return t=o[e],Array.prototype.concat(r.refs,t.headers.map(function(e){return r[e]}),t.refresh_expiration?r.refresh_expiration:"",t.code).join("\n")}},6553:function(e,t,n){var r;r=n(4916),e.exports=class{constructor(e){this.status=e,this._jobs={},this.counts=this.status.map(function(){return 0})}next(e){var t,n;return(n=(t=this._jobs[e])+1,null!=t&&n<this.status.length)?(this.counts[t]--,this.counts[n]++,this._jobs[e]++):null!=t?(this.counts[t]--,delete this._jobs[e]):void 0}start(e){var t;return t=0,this._jobs[e]=t,this.counts[t]++}remove(e){var t;return null!=(t=this._jobs[e])&&(this.counts[t]--,delete this._jobs[e]),null!=t}jobStatus(e){var t;return null!=(t=this.status[this._jobs[e]])?t:null}statusJobs(e){var t,n,i,o;if(null==e)return Object.keys(this._jobs);if((n=this.status.indexOf(e))<0)throw new r(`status must be one of ${this.status.join(", ")}`);for(t in i=this._jobs,o=[],i)i[t]===n&&o.push(t);return o}statusCounts(){return this.counts.reduce((e,t,n)=>(e[this.status[n]]=t,e),{})}}},9124:function(e,t,n){var r;function i(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var s=e.apply(t,n);function a(e){i(s,r,o,a,l,"next",e)}function l(e){i(s,r,o,a,l,"throw",e)}a(void 0)})}}r=n(1979),e.exports=class{constructor(e,t){this.schedule=this.schedule.bind(this),this.name=e,this.Promise=t,this._running=0,this._queue=new r}isEmpty(){return 0===this._queue.length}_tryToRun(){var e=this;return o(function*(){var t,n,r,i,s,a,l;if(e._running<1&&e._queue.length>0){e._running++;var u=e._queue.shift();return l=u.task,t=u.args,s=u.resolve,i=u.reject,n=yield o(function*(){try{return a=yield l(...t),function(){return s(a)}}catch(e){return r=e,function(){return i(r)}}})(),e._running--,e._tryToRun(),n()}})()}schedule(e,...t){var n,r,i;return i=r=null,n=new this.Promise(function(e,t){return i=e,r=t}),this._queue.push({task:e,args:t,resolve:i,reject:r}),this._tryToRun(),n}}},1383:function(e,t,n){e.exports=n(1452)},5944:function(e,t){t.load=function(e,t,n={}){var r,i,o;for(r in t)o=t[r],n[r]=null!=(i=e[r])?i:o;return n},t.overwrite=function(e,t,n={}){var r,i;for(r in e)i=e[r],void 0!==t[r]&&(n[r]=i);return n}},1250:function(e,t,n){var r=n(2059);n.o(r,"Effect")&&n.d(t,{Effect:function(){return r.Effect}})},9963:function(e,t,n){var r=n(3876);n.o(r,"oc")&&n.d(t,{oc:function(){return r.oc}});var i=n(9873);n.o(i,"oc")&&n.d(t,{oc:function(){return i.oc}}),n(8607),n(9297),n(7101),n(9644)},8974:function(e,t,n){var r=n(1522);n.o(r,"z")&&n.d(t,{z:function(){return r.z}})},5663:function(e,t,n){n.r(t),n.d(t,{default:()=>ez});var r=n(4464),i=n(1250),o=n(8974),s=n(9963),a=o.z.object({chainId:o.z.string(),assetId:o.z.string(),symbol:o.z.string(),decimals:o.z.number().int().min(0)}),l=o.z.object({source:a,destination:a,amountIn:o.z.string(),amountOut:o.z.string(),effectiveRate:o.z.number().describe("amountOut/amountIn normalized for decimals"),totalFeesUsd:o.z.number().nullable(),quotedAt:o.z.iso.datetime()}),u=o.z.object({maxAmountIn:o.z.string(),slippageBps:o.z.number()}),c=o.z.object({route:o.z.object({source:a,destination:a}),thresholds:o.z.array(u),measuredAt:o.z.iso.datetime()}),h=o.z.object({window:o.z.enum(["24h","7d","30d"]),volumeUsd:o.z.number(),measuredAt:o.z.iso.datetime()}),d=o.z.object({assets:o.z.array(a),measuredAt:o.z.iso.datetime()}),f=o.z.object({route:o.z.object({source:a,destination:a}),maxCapacityUsd:o.z.number().nullable(),optimalRangeUsd:o.z.object({min:o.z.number(),max:o.z.number()}).nullable(),feeEfficiencyScore:o.z.number().min(0).max(100).nullable(),priceImpactBps:o.z.object({at1k:o.z.number().nullable(),at10k:o.z.number().nullable(),at100k:o.z.number().nullable()}),measuredAt:o.z.iso.datetime()}),p=o.z.object({volumes:o.z.array(h),rates:o.z.array(l),liquidity:o.z.array(c),listedAssets:d,routeIntelligence:o.z.array(f).optional()}),m=s.oc.router({getSnapshot:s.oc.route({method:"GET",path:"/snapshot"}).input(o.z.object({routes:o.z.array(o.z.object({source:a,destination:a})).min(1),notionals:o.z.array(o.z.string()).min(1),includeWindows:o.z.array(o.z.enum(["24h","7d","30d"])).default(["24h"]).optional(),includeIntelligence:o.z.boolean().default(!1).optional().describe("Enable advanced route intelligence analysis (capacity, price impact, fee efficiency)")})).output(p).errors(r.CommonPluginErrors),ping:s.oc.route({method:"GET",path:"/ping"}).output(o.z.object({status:o.z.literal("ok"),timestamp:o.z.string().datetime()})).errors(r.CommonPluginErrors)}),g=n(8946);function y(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t&&_(e.prototype,t),n&&_(e,n),e}function b(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}var w=function(){function e(){y(this,e)}return v(e,null,[{key:"calculateEffectiveRate",value:function(e,t,n,r){if(!e||!t||"number"!=typeof n||"number"!=typeof r||n<0||r<0)throw Error("Invalid input parameters for rate calculation");try{var i=new g.A(e).div(new g.A(10).pow(n)),o=new g.A(t).div(new g.A(10).pow(r));if(i.isZero())throw Error("From amount cannot be zero");return o.div(i).toNumber()}catch(e){throw Error("Decimal calculation failed: ".concat(b(e,Error)?e.message:String(e)))}}},{key:"sumFees",value:function(e){if(!Array.isArray(e))throw Error("Fees must be an array");try{return e.reduce(function(e,t){if(!(null==t?void 0:t.amountUSD))return e;var n="string"==typeof t.amountUSD?t.amountUSD:t.amountUSD.toString();return e.plus(new g.A(n))},new g.A(0)).toNumber()}catch(e){throw Error("Fee calculation failed: ".concat(b(e,Error)?e.message:String(e)))}}},{key:"calculateSlippageBps",value:function(e,t){var n=new g.A(e),r=new g.A(t);return n.isZero()?0:n.minus(r).div(n).times(1e4).abs().toNumber()}},{key:"normalizeAmount",value:function(e,t){return new g.A(e).div(new g.A(10).pow(t))}},{key:"denormalizeAmount",value:function(e,t){var n="number"==typeof e?e.toString():e;return new g.A(n).times(new g.A(10).pow(t)).toFixed(0,g.A.ROUND_DOWN)}}]),e}(),E=n(1383),S=n.n(E);function k(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function I(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){k(o,r,i,s,a,"next",e)}function a(e){k(o,r,i,s,a,"throw",e)}s(void 0)})}}function R(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),e}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){N(e,t,n[t])})}return e}function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function C(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function D(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return l([e,t])}}function l(a){if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function $(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var j=function(){function e(){R(this,e)}return O(e,null,[{key:"configure",value:function(e){var t,n,r={maxConcurrent:null!=(t=e.maxConcurrent)?t:5,minTime:null!=(n=e.minTime)?n:200};this.limiter=new(S())(r),this.lastConfig=r}},{key:"getLimiterConfig",value:function(){return this.lastConfig}},{key:"fetchWithRetry",value:function(e){return I(function(e){var t,n,r,i,o=arguments;return D(this,function(s){if(t=this,n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:3,i=o.length>3&&void 0!==o[3]?o[3]:1e3,!e||"string"!=typeof e)throw Error("Valid URL is required");if(r<0||i<0)throw Error("maxRetries and baseDelay must be non-negative");try{new URL(e)}catch(t){throw Error("Invalid URL format: ".concat(e))}return[2,this.limiter.schedule(function(){return I(function(){var t,o,s,a,l;return D(this,function(u){switch(u.label){case 0:o=function(o){var a,l,u,c,h,d,f,p,m;return D(this,function(g){switch(g.label){case 0:return g.trys.push([0,6,,9]),a=new AbortController,l=setTimeout(function(){return a.abort()},3e4),[4,fetch(e,M(T({},n),{signal:a.signal,headers:T({"Content-Type":"application/json"},n.headers)}))];case 1:if(u=g.sent(),clearTimeout(l),u.ok)return[3,4];if(429!==u.status||(h=(c=u.headers.get("retry-after"))?1e3*parseInt(c):t.calculateBackoffDelay(o,i),!(o<r)))return[3,3];return[4,t.sleep(h)];case 2:return g.sent(),[2,"continue"];case 3:throw Error("HTTP ".concat(u.status,": ").concat(u.statusText));case 4:try{if(!(null==(d=u.headers.get("content-type"))?void 0:d.includes("application/json")))throw Error("Response is not JSON")}catch(e){throw Error("Invalid response headers")}return f={},[4,u.json()];case 5:return[2,(f.v=g.sent(),f)];case 6:if(s=A(p=g.sent(),Error)?p:Error(String(p)),!(o<r))return[3,8];return m=t.calculateBackoffDelay(o,i),[4,t.sleep(m)];case 7:g.sent(),g.label=8;case 8:return[3,9];case 9:return[2]}})},a=0,u.label=1;case 1:if(!(a<=r))return[3,4];return t=this,[5,$(o(a))];case 2:if("object"===C(l=u.sent()))return[2,l.v];u.label=3;case 3:return a++,[3,1];case 4:throw Error("Request failed after ".concat(r+1," attempts: ").concat(s.message))}})}).call(t)})]})}).apply(this,arguments)}},{key:"calculateBackoffDelay",value:function(e,t){if("number"!=typeof e||"number"!=typeof t||e<0||t<0)return 1e3;var n=t*Math.pow(2,Math.min(e,10)),r=.1*Math.random()*n;return Math.min(n+r,3e4)}},{key:"sleep",value:function(e){return new Promise(function(t){return setTimeout(t,e)})}}]),e}();function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function F(e){if(Array.isArray(e))return e}function q(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function U(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){q(o,r,i,s,a,"next",e)}function a(e){q(o,r,i,s,a,"throw",e)}s(void 0)})}}function z(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t,n){return t&&H(e.prototype,t),n&&H(e,n),e}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var o=[],s=!0,a=!1;try{for(i=i.call(e);!(s=(n=i.next()).done)&&(o.push(n.value),!t||o.length!==t);s=!0);}catch(e){a=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(a)throw r}}return o}}function K(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function W(e,t){return F(e)||V(e,t)||Y(e,t)||K()}function Y(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,t)}}function Z(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return l([e,t])}}function l(a){if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}N(j,"limiter",new(S())({maxConcurrent:5,minTime:200})),N(j,"lastConfig",{maxConcurrent:5,minTime:200});var Q=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;z(this,e),G(this,"cache",new Map),G(this,"ttlMs",void 0),G(this,"maxSize",void 0),this.ttlMs=t,this.maxSize=n}return B(e,[{key:"get",value:function(e){var t=this.cache.get(e);if(t){var n=Date.now();return n>t.expiresAt?void this.cache.delete(e):t.value}}},{key:"set",value:function(e,t){if(this.cache.size>=this.maxSize){var n=this.cache.keys().next().value;void 0!==n&&this.cache.delete(n)}this.cache.set(e,{value:t,expiresAt:Date.now()+this.ttlMs})}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"clear",value:function(){this.cache.clear()}},{key:"stats",value:function(){var e=Date.now(),t=!0,n=!1,r=void 0;try{for(var i,o=this.cache.entries()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=W(i.value,2),a=s[0],l=s[1];e>l.expiresAt&&this.cache.delete(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return{size:this.cache.size,maxSize:this.maxSize,ttlMs:this.ttlMs}}}]),e}(),J=function(){function e(){z(this,e),G(this,"pending",new Map)}return B(e,[{key:"deduplicate",value:function(e,t){return U(function(){var n,r,i;return Z(this,function(o){return(n=this,r=this.pending.get(e))?[2,r]:(i=t().finally(function(){n.pending.delete(e)}),this.pending.set(e,i),[2,i])})}).call(this)}},{key:"clear",value:function(){this.pending.clear()}},{key:"pendingCount",value:function(){return this.pending.size}}]),e}(),X=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;z(this,e),G(this,"failureThreshold",void 0),G(this,"cooldownMs",void 0),G(this,"successThreshold",void 0),G(this,"state",void 0),G(this,"failureCount",void 0),G(this,"successCount",void 0),G(this,"nextAttemptTime",void 0),this.failureThreshold=t,this.cooldownMs=n,this.successThreshold=r,this.state="CLOSED",this.failureCount=0,this.successCount=0,this.nextAttemptTime=0}return B(e,[{key:"execute",value:function(e){return U(function(){var t,n,r;return Z(this,function(i){switch(i.label){case 0:if(t=Date.now(),"OPEN"===this.state){if(t<this.nextAttemptTime)throw Error("Circuit breaker is OPEN - service is unavailable");this.state="HALF_OPEN",this.successCount=0}i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e()];case 2:return n=i.sent(),this.onSuccess(),[2,n];case 3:throw r=i.sent(),this.onFailure(),r;case 4:return[2]}})}).call(this)}},{key:"onSuccess",value:function(){this.failureCount=0,"HALF_OPEN"===this.state&&(this.successCount++,this.successCount>=this.successThreshold&&(this.state="CLOSED",this.successCount=0))}},{key:"onFailure",value:function(){this.failureCount++,this.successCount=0,("HALF_OPEN"===this.state||this.failureCount>=this.failureThreshold)&&(this.state="OPEN",this.nextAttemptTime=Date.now()+this.cooldownMs)}},{key:"getState",value:function(){return{state:this.state,failureCount:this.failureCount,successCount:this.successCount}}},{key:"reset",value:function(){this.state="CLOSED",this.failureCount=0,this.successCount=0,this.nextAttemptTime=0}}]),e}();function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function et(e){if(Array.isArray(e))return e}function en(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function er(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ei(e,t,n){return t&&er(e.prototype,t),n&&er(e,n),e}function eo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function es(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var o=[],s=!0,a=!1;try{for(i=i.call(e);!(s=(n=i.next()).done)&&(o.push(n.value),!t||o.length!==t);s=!0);}catch(e){a=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(a)throw r}}return o}}function ea(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function el(e,t){return et(e)||es(e,t)||eu(e,t)||ea()}function eu(e,t){if(e){if("string"==typeof e)return ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ee(e,t)}}var ec=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";en(this,e),eo(this,"context",void 0),eo(this,"minLevel",void 0),this.context=t,this.minLevel=n}return ei(e,[{key:"shouldLog",value:function(e){var t=["debug","info","warn","error"];return t.indexOf(e)>=t.indexOf(this.minLevel)}},{key:"formatLog",value:function(e){var t=e.metadata?" ".concat(JSON.stringify(e.metadata)):"";return"[".concat(e.timestamp,"] [").concat(e.level.toUpperCase(),"] [").concat(e.context,"] ").concat(e.message).concat(t)}},{key:"log",value:function(e,t,n){if(this.shouldLog(e)){var r={timestamp:new Date().toISOString(),level:e,message:t,context:this.context,metadata:n},i=this.formatLog(r);switch(e){case"debug":case"info":console.log(i);break;case"warn":console.warn(i);break;case"error":console.error(i)}}}},{key:"debug",value:function(e,t){this.log("debug",e,t)}},{key:"info",value:function(e,t){this.log("info",e,t)}},{key:"warn",value:function(e,t){this.log("warn",e,t)}},{key:"error",value:function(e,t){this.log("error",e,t)}},{key:"child",value:function(t){return new e("".concat(this.context,":").concat(t),this.minLevel)}},{key:"setLevel",value:function(e){this.minLevel=e}}]),e}(),eh=function(){function e(){en(this,e),eo(this,"startTime",void 0),eo(this,"marks",new Map),this.startTime=Date.now()}return ei(e,[{key:"mark",value:function(e){this.marks.set(e,Date.now())}},{key:"elapsed",value:function(){return Date.now()-this.startTime}},{key:"measure",value:function(e,t){var n=this.marks.get(e),r=this.marks.get(t);if(n&&r)return r-n}},{key:"getMetadata",value:function(){var e={totalMs:this.elapsed()},t=!0,n=!1,r=void 0;try{for(var i,o=this.marks.entries()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=el(i.value,2),a=s[0],l=s[1];e["".concat(a,"Ms")]=l-this.startTime}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return e}}]),e}();function ed(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ef(e){if(Array.isArray(e))return e}function ep(e){if(Array.isArray(e))return ed(e)}function em(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function eg(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){em(o,r,i,s,a,"next",e)}function a(e){em(o,r,i,s,a,"throw",e)}s(void 0)})}}function ey(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function e_(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ev(e,t,n){return t&&e_(e.prototype,t),n&&e_(e,n),e}function eb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ew(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function eE(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function eS(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var o=[],s=!0,a=!1;try{for(i=i.call(e);!(s=(n=i.next()).done)&&(o.push(n.value),!t||o.length!==t);s=!0);}catch(e){a=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(a)throw r}}return o}}function ek(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function eI(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function eR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){eb(e,t,n[t])})}return e}function ex(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ex(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function eN(e,t){return ef(e)||eS(e,t)||eP(e,t)||ek()}function eA(e){return ep(e)||eE(e)||eP(e)||eI()}function eT(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function eP(e,t){if(e){if("string"==typeof e)return ed(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ed(e,t)}}function eM(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return l([e,t])}}function l(a){if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function eC(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var eD=function(){function e(t,n){ey(this,e),eb(this,"maxTokens",void 0),eb(this,"refillRate",void 0),eb(this,"tokens",void 0),eb(this,"lastRefill",void 0),this.maxTokens=t,this.refillRate=n,this.tokens=t,this.lastRefill=Date.now()}return ev(e,[{key:"acquire",value:function(){return eg(function(){var e;return eM(this,function(t){switch(t.label){case 0:if(this.refill(),this.tokens>=1)return this.tokens-=1,[2];return e=1/this.refillRate*1e3,[4,new Promise(function(t){return setTimeout(t,e)})];case 1:return t.sent(),this.tokens=0,[2]}})}).call(this)}},{key:"refill",value:function(){var e=Date.now(),t=(e-this.lastRefill)/1e3*this.refillRate;this.tokens=Math.min(this.maxTokens,this.tokens+t),this.lastRefill=e}}]),e}(),e$=function(){function e(t,n,r,i){var o,s,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;ey(this,e),eb(this,"dlnApiBase",void 0),eb(this,"defillamaBaseUrl",void 0),eb(this,"apiKey",void 0),eb(this,"timeout",void 0),eb(this,"logger",void 0),eb(this,"rateLimiter",void 0),eb(this,"MAX_RETRIES",3),eb(this,"RETRY_DELAYS",[1e3,2e3,4e3]),eb(this,"DEBRIDGE_LLAMA_ID","20"),eb(this,"quoteCache",new Q(3e5)),eb(this,"volumeCache",null),eb(this,"VOLUME_CACHE_TTL",6e5),eb(this,"tokenListCache",new Map),eb(this,"deduplicator",new J),eb(this,"dlnCircuit",new X(5,6e4)),this.dlnApiBase=this.sanitizeHttpUrl(t,e.DEFAULT_BASE_URL),this.defillamaBaseUrl=this.sanitizeHttpUrl(n,e.DEFAULT_DEFILLAMA_BASE_URL),this.apiKey=null!=(s=null==r||null==(o=r.trim)?void 0:o.call(r))?s:"not-required",this.timeout=i,this.rateLimiter=new eD(a,a),this.logger=new ec("deBridge:Service",("undefined"!=typeof process?process.env.LOG_LEVEL:"info")||"info"),console.log("[deBridge] Service configuration",{dlnApiBase:this.dlnApiBase,defillamaBaseUrl:this.defillamaBaseUrl,timeout:this.timeout,maxRequestsPerSecond:a})}return ev(e,[{key:"getSnapshot",value:function(e){var t,n,r=this;return(null==e||null==(t=e.routes)?void 0:t.length)&&(null==e||null==(n=e.notionals)?void 0:n.length)?i.Effect.tryPromise({try:function(){return eg(function(){var t,n,r,i,o,s,a,l;return eM(this,function(u){switch(u.label){case 0:t=new eh,this.logger.info("Snapshot fetch started",{routeCount:e.routes.length,notionalCount:e.notionals.length,windows:e.includeWindows,includeIntelligence:e.includeIntelligence||!1}),u.label=1;case 1:return u.trys.push([1,5,,6]),t.mark("fetchStart"),[4,Promise.all([this.getVolumes(e.includeWindows||["24h"]),this.getRates(e.routes,e.notionals),this.getLiquidityDepth(e.routes),this.getListedAssets(e.routes)])];case 2:if(r=(n=eN.apply(void 0,[u.sent(),4]))[0],i=n[1],o=n[2],s=n[3],!e.includeIntelligence)return[3,4];return this.logger.info("Fetching route intelligence",{routeCount:e.routes.length}),[4,this.getRouteIntelligence(e.routes)];case 3:a=u.sent(),u.label=4;case 4:return t.mark("fetchEnd"),this.logger.info("Snapshot fetch completed",eO(eR({},t.getMetadata()),{volumeCount:r.length,rateCount:i.length,liquidityCount:o.length,assetCount:s.assets.length,intelligenceCount:(null==a?void 0:a.length)||0})),[2,eR({volumes:r,rates:i,liquidity:o,listedAssets:s},a&&{routeIntelligence:a})];case 5:throw l=u.sent(),this.logger.error("Snapshot fetch failed",{error:ew(l,Error)?l.message:String(l),elapsed:t.elapsed()}),Error("Snapshot fetch failed: ".concat(ew(l,Error)?l.message:String(l)));case 6:return[2]}})}).call(r)},catch:function(e){return Error("Failed to fetch snapshot: ".concat(ew(e,Error)?e.message:String(e)))}}):i.Effect.fail(Error("Routes and notionals are required"))}},{key:"getVolumes",value:function(e){return eg(function(){var t,n,r,i,o,s,a,l,u,c,h,d;return eM(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),[4,this.fetchDefiLlamaVolumes()];case 1:if(!(t=f.sent()))return this.logger.warn("No volume data available from DefiLlama"),[2,[]];n=[],r=new Date().toISOString(),i=!0,o=!1,s=void 0;try{for(a=e[Symbol.iterator]();!(i=(l=a.next()).done);i=!0){switch(u=l.value,c=void 0,u){case"24h":c=t.lastDailyVolume;break;case"7d":c=t.weeklyVolume;break;case"30d":c=t.monthlyVolume}void 0!==c&&(n.push({window:u,volumeUsd:c,measuredAt:r}),this.logger.info("Volume fetched",{window:u,volumeUsd:c}))}}catch(e){o=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}return[2,n];case 2:return d=ew(h=f.sent(),Error)?h.message:String(h),this.logger.error("Failed to fetch volumes from DefiLlama",{error:d}),[2,[]];case 3:return[2]}})}).call(this)}},{key:"getRates",value:function(e,t){return eg(function(){var n,r,i,o,s,a,l,u,c,h,d,f,p,m,g,y;return eM(this,function(_){switch(_.label){case 0:if(n=this,!(null==e?void 0:e.length)||!(null==t?void 0:t.length))throw Error("Routes and notionals are required for rate fetching");this.logger.info("Fetching rates",{routeCount:e.length,notionalCount:t.length}),r=[],i=!0,o=!1,s=void 0,_.label=1;case 1:_.trys.push([1,12,13,14]),a=e[Symbol.iterator](),_.label=2;case 2:if(i=(l=a.next()).done)return[3,11];if(!(null==(u=l.value)?void 0:u.source)||!(null==u?void 0:u.destination))return this.logger.warn("Invalid route structure, skipping",{route:u}),[3,10];c=!0,h=!1,d=void 0,_.label=3;case 3:_.trys.push([3,8,9,10]),p=function(){var e,t,i,o,s,a,l,c,h,d,p,m,y,_,v,b,E,S;return eM(this,function(k){switch(k.label){case 0:if(!(e=g.value)||isNaN(Number(e)))return f.logger.warn("Invalid notional, skipping",{notional:e}),[2,"continue"];k.label=1;case 1:if(k.trys.push([1,5,,6]),t="".concat(u.source.chainId,"-").concat(u.source.assetId,"-").concat(u.destination.chainId,"-").concat(u.destination.assetId,"-").concat(e),i=f.quoteCache.get(t),o=void 0,!i)return[3,2];return f.logger.debug("Quote cache hit",{cacheKey:t}),o=i,[3,4];case 2:return(s=new URL("".concat(f.dlnApiBase,"/dln/order/create-tx"))).searchParams.set("srcChainId",u.source.chainId),s.searchParams.set("srcChainTokenIn",u.source.assetId),s.searchParams.set("srcChainTokenInAmount",e),s.searchParams.set("dstChainId",u.destination.chainId),s.searchParams.set("dstChainTokenOut",u.destination.assetId),s.searchParams.set("dstChainTokenOutAmount","auto"),s.searchParams.set("prependOperatingExpenses","true"),[4,f.dlnCircuit.execute(function(){return n.deduplicator.deduplicate(t,function(){return j.fetchWithRetry(s.toString(),{headers:n.apiKey?{Authorization:"Bearer ".concat(n.apiKey)}:{}})})})];case 3:o=k.sent(),f.quoteCache.set(t,o),f.logger.debug("Quote fetched and cached",{cacheKey:t}),k.label=4;case 4:if(!(null==o?void 0:o.estimation))throw Error("Invalid quote response structure");if(a=o.estimation.srcChainTokenIn,l=o.estimation.dstChainTokenOut,c=a.amount,d=null!=(h=l.recommendedAmount)?h:l.amount,!c||!d)throw Error("Missing amount data in quote estimation");return m=null!=(p=a.approximateUsdValue)?p:a.originApproximateUsdValue,v=null!=(_=null!=(y=l.recommendedApproximateUsdValue)?y:l.approximateUsdValue)?_:l.maxTheoreticalApproximateUsdValue,b=null,null!=m&&null!=v&&(b=Math.max(m-v,0)),E=w.calculateEffectiveRate(c,d,u.source.decimals,u.destination.decimals),r.push({source:u.source,destination:u.destination,amountIn:c,amountOut:d,effectiveRate:E,totalFeesUsd:b,quotedAt:new Date().toISOString()}),f.logger.debug("Rate calculated",{route:"".concat(u.source.symbol,"->").concat(u.destination.symbol),notional:e,effectiveRate:E,totalFeesUsd:b,inUsd:m,outUsd:v}),[3,6];case 5:return S=k.sent(),f.logger.error("Failed to get rate for route",{route:"".concat(u.source.symbol,"->").concat(u.destination.symbol),notional:e,error:ew(S,Error)?S.message:"Unknown error"}),[3,6];case 6:return[2]}})},m=t[Symbol.iterator](),_.label=4;case 4:if(c=(g=m.next()).done)return[3,7];return f=this,[5,eC(p())];case 5:_.sent(),_.label=6;case 6:return c=!0,[3,4];case 7:return[3,10];case 8:return y=_.sent(),h=!0,d=y,[3,10];case 9:try{c||null==m.return||m.return()}finally{if(h)throw d}return[7];case 10:return i=!0,[3,2];case 11:return[3,14];case 12:return y=_.sent(),o=!0,s=y,[3,14];case 13:try{i||null==a.return||a.return()}finally{if(o)throw s}return[7];case 14:return this.logger.info("Rates fetched",{rateCount:r.length}),[2,r]}})}).call(this)}},{key:"getLiquidityDepth",value:function(e){return eg(function(){var t,n,r,i,o,s,a,l,u,c,h,d,f,p,m,g,y,_,v,b,w,E,S,k,I,R,x;return eM(this,function(O){switch(O.label){case 0:if(!(null==e?void 0:e.length))return this.logger.warn("No routes provided for liquidity depth"),[2,[]];t=[],n=!0,r=!1,i=void 0,O.label=1;case 1:O.trys.push([1,8,9,10]),o=e[Symbol.iterator](),O.label=2;case 2:if(n=(s=o.next()).done)return[3,7];if(!(null==(a=s.value)?void 0:a.source)||!(null==a?void 0:a.destination))return this.logger.warn("Invalid route structure for liquidity, skipping",{route:a}),[3,6];O.label=3;case 3:O.trys.push([3,5,,6]),l=void 0;try{u=BigInt(a.source.decimals),l=(1000n*Math.pow(10n,u)).toString()}catch(e){return this.logger.error("Invalid decimals, skipping route",{decimals:a.source.decimals,route:"".concat(a.source.symbol,"->").concat(a.destination.symbol),error:ew(e,Error)?e.message:String(e)}),[3,6]}return[4,this.fetchQuoteWithRetry(a.source,a.destination,l)];case 4:if(!(h=null==(c=O.sent())?void 0:c.estimation))return this.logger.warn("No estimation in quote response",{route:"".concat(a.source.symbol,"->").concat(a.destination.symbol)}),[3,6];if(d=h.srcChainTokenIn,f=h.dstChainTokenOut,m=null!=(p=null==d?void 0:d.amount)?p:l,y=null!=(g=null==f?void 0:f.recommendedAmount)?g:null==f?void 0:f.amount,v=null!=(_=null==f?void 0:f.maxTheoreticalAmount)?_:y,!m||!y)return this.logger.warn("Missing amount data in quote",{route:"".concat(a.source.symbol,"->").concat(a.destination.symbol)}),[3,6];if(b=m,v&&"0"!==y)try{w=BigInt(m),E=BigInt(y),S=BigInt(v),E>0n&&(b=(w*S/E).toString())}catch(e){k=ew(e,Error)?e.message:String(e),this.logger.warn("Failed to compute max source for liquidity",{error:k})}return t.push({route:a,thresholds:[{maxAmountIn:m,slippageBps:50},{maxAmountIn:b,slippageBps:100}],measuredAt:new Date().toISOString()}),this.logger.debug("Liquidity depth calculated",{route:"".concat(a.source.symbol,"->").concat(a.destination.symbol),srcAmount:m,maxSource:b,ratio:v&&"0"!==y?(Number(v)/Number(y)).toFixed(2):"N/A"}),[3,6];case 5:return R=ew(I=O.sent(),Error)?I.message:String(I),this.logger.error("Failed to fetch liquidity for route",{route:"".concat(a.source.symbol,"->").concat(a.destination.symbol),error:R}),[3,6];case 6:return n=!0,[3,2];case 7:return[3,10];case 8:return x=O.sent(),r=!0,i=x,[3,10];case 9:try{n||null==o.return||o.return()}finally{if(r)throw i}return[7];case 10:return[2,t]}})}).call(this)}},{key:"fetchQuoteWithRetry",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;return eg(function(){var i,o,s,a,l,u,c;return eM(this,function(h){switch(h.label){case 0:o=function(n){var o,s,u,c,h,d,f,p,m,g;return eM(this,function(y){switch(y.label){case 0:return y.trys.push([0,7,,10]),[4,i.rateLimiter.acquire()];case 1:return y.sent(),o=Date.now(),[4,fetch(a.toString(),{headers:eR({Accept:"application/json"},i.apiKey&&"not-required"!==i.apiKey?{"x-api-key":i.apiKey}:{}),signal:AbortSignal.timeout(i.timeout)})];case 2:if(s=y.sent(),u=Date.now()-o,s.ok)return[3,5];if(!(n<r&&(s.status>=500||429===s.status)))return[3,4];return c=l[n]||4e3,i.logger.warn("Quote API error, retrying",{status:s.status,attempt:n+1,maxRetries:r,delayMs:c,source:e.symbol,destination:t.symbol}),[4,new Promise(function(e){return setTimeout(e,c)})];case 3:case 8:return y.sent(),[2,"continue"];case 4:return i.logger.warn("Quote API error, no retry",{status:s.status,attempt:n+1,source:e.symbol,destination:t.symbol}),[2,{v:null}];case 5:return[4,s.json()];case 6:if(!(null==(h=y.sent())?void 0:h.estimation))return i.logger.warn("Quote response missing estimation",{source:e.symbol,destination:t.symbol,attempt:n+1}),[2,{v:null}];return i.logger.debug("Quote fetched successfully",{source:e.symbol,destination:t.symbol,latencyMs:u,attempt:n+1}),[2,{v:h}];case 7:if(p=(f=ew(d=y.sent(),Error)?d.message:String(d)).includes("timeout")||f.includes("aborted"),m=f.includes("fetch")||f.includes("network"),!(n<r&&(p||m)))return[3,9];return g=l[n]||4e3,i.logger.warn("Quote request failed, retrying",{error:f,attempt:n+1,maxRetries:r,delayMs:g,source:e.symbol,destination:t.symbol}),[4,new Promise(function(e){return setTimeout(e,g)})];case 9:return i.logger.error("Quote request failed permanently",{url:a.toString(),error:f,attempt:n+1,source:e.symbol,destination:t.symbol}),[2,{v:null}];case 10:return[2]}})},s="0x1111111111111111111111111111111111111111",(a=new URL("".concat(this.dlnApiBase,"/dln/order/create-tx"))).searchParams.set("srcChainId",e.chainId),a.searchParams.set("srcChainTokenIn",e.assetId),a.searchParams.set("srcChainTokenInAmount",n),a.searchParams.set("dstChainId",t.chainId),a.searchParams.set("dstChainTokenOut",t.assetId),a.searchParams.set("dstChainTokenOutRecipient",s),a.searchParams.set("dstChainTokenOutAmount","auto"),a.searchParams.set("dstChainOrderAuthorityAddress",s),a.searchParams.set("srcChainOrderAuthorityAddress",s),a.searchParams.set("prependOperatingExpenses","true"),l=[1e3,2e3,4e3],u=0,h.label=1;case 1:if(!(u<=r))return[3,4];return i=this,[5,eC(o(u))];case 2:if("object"===eT(c=h.sent()))return[2,c.v];h.label=3;case 3:return u++,[3,1];case 4:return[2,null]}})}).call(this)}},{key:"getListedAssets",value:function(t){return eg(function(){var n,r,i,o,s,a,l,u,c,h,d,f,p,m,g,y,_,v,b,w,E,S,k,I,R,x,O,N,A,T,P,M,C,D,$,j,L,F;return eM(this,function(q){switch(q.label){case 0:n=new Date().toISOString(),r=new Set(t.flatMap(function(e){return[e.source.chainId,e.destination.chainId]})),i=[],o=new Set,s=!0,a=!1,l=void 0,q.label=1;case 1:q.trys.push([1,10,11,12]),u=r[Symbol.iterator](),q.label=2;case 2:if(s=(c=u.next()).done)return[3,9];if(!(h=String(c.value)))return[3,8];if((d=this.tokenListCache.get(h))&&Date.now()-d.fetchedAt<e.TOKEN_LIST_TTL){f=!0,p=!1,m=void 0;try{for(g=d.assets[Symbol.iterator]();!(f=(y=g.next()).done);f=!0)_=y.value,v="".concat(h,":").concat(_.assetId.toLowerCase()),o.has(v)||(o.add(v),i.push(_))}catch(e){p=!0,m=e}finally{try{f||null==g.return||g.return()}finally{if(p)throw m}}return[3,8]}q.label=3;case 3:return q.trys.push([3,7,,8]),[4,this.rateLimiter.acquire()];case 4:return q.sent(),[4,fetch("".concat(this.dlnApiBase,"/token-list?chainId=").concat(encodeURIComponent(h)),{headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout)})];case 5:if(!(b=q.sent()).ok)return this.logger.warn("Token list fetch failed",{chainId:h,status:b.status}),[3,8];return[4,b.json()];case 6:if(!(E=null==(w=q.sent())?void 0:w.tokens))return[3,8];S=[],k=!0,I=!1,R=void 0;try{for(x=Object.values(E)[Symbol.iterator]();!(k=(O=x.next()).done);k=!0)(null==(N=O.value)?void 0:N.address)&&(A=N.address.toLowerCase(),T="".concat(h,":").concat(A),o.has(T)||(o.add(T),M="number"==typeof N.decimals?N.decimals:Number.parseInt(String(null!=(P=N.decimals)?P:"18"),10),C=Number.isFinite(M)?M:18,$={chainId:h,assetId:A,symbol:null!=(D=N.symbol)?D:N.address,decimals:C},S.push($),i.push($)))}catch(e){I=!0,R=e}finally{try{k||null==x.return||x.return()}finally{if(I)throw R}}return this.tokenListCache.set(h,{assets:S,fetchedAt:Date.now()}),this.logger.info("Token list fetched",{chainId:h,tokenCount:S.length}),[3,8];case 7:return L=ew(j=q.sent(),Error)?j.message:String(j),this.logger.warn("Token list fetch failed",{chainId:h,error:L}),[3,8];case 8:return s=!0,[3,2];case 9:return[3,12];case 10:return F=q.sent(),a=!0,l=F,[3,12];case 11:try{s||null==u.return||u.return()}finally{if(a)throw l}return[7];case 12:return[2,{assets:i,measuredAt:n}]}})}).call(this)}},{key:"ping",value:function(){var e=this;return i.Effect.tryPromise({try:function(){return eg(function(){return eM(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,j.fetchWithRetry("".concat(this.dlnApiBase,"/supported-chains-info"),{headers:this.apiKey?{Authorization:"Bearer ".concat(this.apiKey)}:{}},1,500)];case 1:return e.sent(),[3,3];case 2:return console.warn("[deBridge] Health check warning:",e.sent()),[3,3];case 3:return[2,{status:"ok",timestamp:new Date().toISOString()}]}})}).call(e)},catch:function(e){return Error("Health check failed: ".concat(ew(e,Error)?e.message:String(e)))}})}},{key:"fetchDefiLlamaVolumes",value:function(){return eg(function(){var e,t,n,r,i,o,s;return eM(this,function(a){switch(a.label){case 0:if(this.volumeCache&&Date.now()-this.volumeCache.fetchedAt<this.VOLUME_CACHE_TTL)return[2,this.volumeCache.data];e=this.defillamaBaseUrl.replace(/\/$/,""),t="".concat(e,"/bridge/").concat(this.DEBRIDGE_LLAMA_ID),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,this.rateLimiter.acquire()];case 2:return a.sent(),[4,fetch(t,{headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout)})];case 3:if(!(n=a.sent()).ok)return this.logger.error("DefiLlama API error",{status:n.status,url:t}),this.volumeCache={data:null,fetchedAt:Date.now()},[2,null];return[4,n.json()];case 4:if(r=a.sent(),!(i=this.parseDefiLlamaResponse(r)))return this.logger.warn("DefiLlama response missing required fields"),this.volumeCache={data:null,fetchedAt:Date.now()},[2,null];return this.volumeCache={data:i,fetchedAt:Date.now()},[2,i];case 5:return s=ew(o=a.sent(),Error)?o.message:String(o),this.logger.error("DefiLlama request failed",{url:t,error:s}),[2,null];case 6:return[2]}})}).call(this)}},{key:"parseDefiLlamaResponse",value:function(e){if(!e||(void 0===e?"undefined":eT(e))!=="object")return null;var t,n,r,i=e,o=function(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){var t=Number.parseFloat(e);return Number.isFinite(t)?t:null}return null},s=o(i.lastDailyVolume),a=o(null!=(t=i.weeklyVolume)?t:i.lastWeeklyVolume),l=o(null!=(n=i.monthlyVolume)?n:i.lastMonthlyVolume);if(null===s||null===a||null===l)return null;var u="string"==typeof i.id?i.id:String(null!=(r=i.id)?r:""),c="string"==typeof i.displayName?i.displayName:u;return{id:u,displayName:c,lastDailyVolume:s,weeklyVolume:a,monthlyVolume:l}}},{key:"sanitizeHttpUrl",value:function(e,t){try{var n=e.replace(/\/$/,""),r=new URL(n);if("http:"!==r.protocol&&"https:"!==r.protocol)return console.warn("[deBridge] Invalid protocol ".concat(r.protocol,", using fallback")),t;return n}catch(n){return console.warn("[deBridge] Invalid URL ".concat(e,", using fallback:"),n),t}}},{key:"getRouteIntelligence",value:function(e){return eg(function(){var t,n,r,i,o,s,a,l,u,c;return eM(this,function(h){switch(h.label){case 0:t=[],n=new Date().toISOString(),r=!0,i=!1,o=void 0,h.label=1;case 1:h.trys.push([1,6,7,8]),a=function(){var e,r,i,o,a,l,c,h,d,f,p,m,g,y,_,v,b,w,E,S,k,I,R,x,O,N,A,T,P;return eM(this,function(M){switch(M.label){case 0:e=u.value,M.label=1;case 1:M.trys.push([1,14,,15]),r=[1e3,5e3,1e4,5e4,1e5,5e5,1e6,5e6],i=e.source.decimals,o=[],a=!0,l=!1,c=void 0,M.label=2;case 2:M.trys.push([2,11,12,13]),h=r[Symbol.iterator](),M.label=3;case 3:if(a=(d=h.next()).done)return[3,10];p=String(Math.floor((f=d.value)*Math.pow(10,i))),M.label=4;case 4:return M.trys.push([4,6,,7]),[4,s.fetchQuoteWithRetry(e.source,e.destination,p)];case 5:if(!(m=M.sent())||!m.estimation)return o.push({amountUsd:f,effectiveRate:0,failed:!0}),[3,10];return g=Number(m.estimation.dstChainTokenOut.amount)/Number(m.estimation.srcChainTokenIn.amount),o.push({amountUsd:f,effectiveRate:g,failed:!1}),[3,7];case 6:return y=M.sent(),o.push({amountUsd:f,effectiveRate:0,failed:!0}),[3,10];case 7:return[4,new Promise(function(e){return setTimeout(e,200)})];case 8:M.sent(),M.label=9;case 9:return a=!0,[3,3];case 10:return[3,13];case 11:return _=M.sent(),l=!0,c=_,[3,13];case 12:try{a||null==h.return||h.return()}finally{if(l)throw c}return[7];case 13:return b=(v=o.filter(function(e){return!e.failed})).length>0?v[v.length-1].amountUsd:null,w=null,v.length>=2&&(S=(E=v.map(function(e){return e.effectiveRate})).reduce(function(e,t){return e+t},0)/E.length,w=Math.max(0,Math.min(100,100-Math.sqrt(E.reduce(function(e,t){return e+Math.pow(t-S,2)},0)/E.length)/S*100))),k=null,v.length>=2&&(R=(I=Math).max.apply(I,eA(v.map(function(e){return e.effectiveRate}))),(x=v.filter(function(e){return e.effectiveRate>=.99*R})).length>0&&(k={min:x[0].amountUsd,max:x[x.length-1].amountUsd})),O=v.find(function(e){return 1e3===e.amountUsd}),N=v.find(function(e){return 1e4===e.amountUsd}),A=v.find(function(e){return 1e5===e.amountUsd}),T={at1k:O?0:null,at10k:O&&N?Math.round((1-N.effectiveRate/O.effectiveRate)*1e4):null,at100k:O&&A?Math.round((1-A.effectiveRate/O.effectiveRate)*1e4):null},t.push({route:e,maxCapacityUsd:b,optimalRangeUsd:k,feeEfficiencyScore:w,priceImpactBps:T,measuredAt:n}),s.logger.info("Route intelligence analyzed",{route:"".concat(e.source.symbol,"->").concat(e.destination.symbol),maxCapacityUsd:b,feeEfficiencyScore:w}),[3,15];case 14:return P=M.sent(),s.logger.warn("Route intelligence analysis failed",{route:"".concat(e.source.symbol,"->").concat(e.destination.symbol),error:ew(P,Error)?P.message:String(P)}),t.push({route:e,maxCapacityUsd:null,optimalRangeUsd:null,feeEfficiencyScore:null,priceImpactBps:{at1k:null,at10k:null,at100k:null},measuredAt:n}),[3,15];case 15:return[2]}})},l=e[Symbol.iterator](),h.label=2;case 2:if(r=(u=l.next()).done)return[3,5];return s=this,[5,eC(a())];case 3:h.sent(),h.label=4;case 4:return r=!0,[3,2];case 5:return[3,8];case 6:return c=h.sent(),i=!0,o=c,[3,8];case 7:try{r||null==l.return||l.return()}finally{if(i)throw o}return[7];case 8:return[2,t]}})}).call(this)}}]),e}();function ej(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,i)}function eL(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){ej(o,r,i,s,a,"next",e)}function a(e){ej(o,r,i,s,a,"throw",e)}s(void 0)})}}function eF(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function eq(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return l([e,t])}}function l(a){if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function eU(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}eb(e$,"DEFAULT_BASE_URL","https://dln.debridge.finance/v1.0"),eb(e$,"DEFAULT_DEFILLAMA_BASE_URL","https://bridges.llama.fi"),eb(e$,"DEFAULT_ACCOUNT","0x1111111111111111111111111111111111111111"),eb(e$,"TOKEN_LIST_TTL",3e5);let ez=(0,r.createPlugin)({id:"@near-intents/debridge-data-provider",variables:o.z.object({baseUrl:o.z.string().url().default("https://dln.debridge.finance/v1.0"),defillamaBaseUrl:o.z.string().url().default("https://bridges.llama.fi"),timeout:o.z.number().min(1e3).max(6e4).default(3e4),maxRequestsPerSecond:o.z.number().min(1).max(100).default(10)}),secrets:o.z.object({apiKey:o.z.string().default("not-required")}),contract:m,initialize:function(e){return i.Effect.gen(function(){var t,n,r;return eq(this,function(o){switch(o.label){case 0:return r=new e$(e.variables.baseUrl,e.variables.defillamaBaseUrl,null!=(n=null==(t=e.secrets)?void 0:t.apiKey)?n:"not-required",e.variables.timeout,e.variables.maxRequestsPerSecond),[5,eU(i.Effect.catchAll(r.ping(),function(e){return i.Effect.sync(function(){console.warn("[deBridge] Ping failed during initialization:",eF(e,Error)?e.message:String(e))})}))];case 1:return o.sent(),[2,{service:r}]}})})},shutdown:function(){return i.Effect.void},createRouter:function(e,t){var n=e.service;return{getSnapshot:t.getSnapshot.handler(function(e){var t=e.input;return eL(function(){return eq(this,function(e){switch(e.label){case 0:return[4,i.Effect.runPromise(n.getSnapshot(t))];case 1:return[2,e.sent()]}})})()}),ping:t.ping.handler(function(){return eL(function(){return eq(this,function(e){switch(e.label){case 0:return[4,i.Effect.runPromise(n.ping())];case 1:return[2,e.sent()]}})})()})}}})},6544:function(e,t,n){var r,i,o,s,a,l,u,c,h,d,f,p,m=n(2446),g=n.n(m);let y=[(0,n(6630).default)()],_={},v="near-intents_debridge-data-provider",b="version-first";if((n.initializeSharingData||n.initializeExposesData)&&n.federation){let e=(e,t,n)=>{e&&e[t]&&(e[t]=n)},t=(e,t,n)=>{var r,i,o,s,a,l;let u=n();Array.isArray(u)?(null!=(o=(r=e)[i=t])||(r[i]=[]),e[t].push(...u)):"object"==typeof u&&null!==u&&(null!=(l=(s=e)[a=t])||(s[a]={}),Object.assign(e[t],u))},m=(e,t,n)=>{var r,i,o;null!=(o=(r=e)[i=t])||(r[i]=n())},w=null!=(c=null==(r=n.remotesLoadingData)?void 0:r.chunkMapping)?c:{},E=null!=(h=null==(i=n.remotesLoadingData)?void 0:i.moduleIdToRemoteDataMapping)?h:{},S=null!=(d=null==(o=n.initializeSharingData)?void 0:o.scopeToSharingDataMapping)?d:{},k=null!=(f=null==(s=n.consumesLoadingData)?void 0:s.chunkMapping)?f:{},I=null!=(p=null==(a=n.consumesLoadingData)?void 0:a.moduleIdToConsumeDataMapping)?p:{},R={},x=[],O={},N=null==(l=n.initializeExposesData)?void 0:l.shareScope;for(let e in g())n.federation[e]=g()[e];m(n.federation,"consumesLoadingModuleToHandlerMapping",()=>{let e={};for(let[t,n]of Object.entries(I))e[t]={getter:n.fallback,shareInfo:{shareConfig:{fixedDependencies:!1,requiredVersion:n.requiredVersion,strictVersion:n.strictVersion,singleton:n.singleton,eager:n.eager},scope:[n.shareScope]},shareKey:n.shareKey};return e}),m(n.federation,"initOptions",()=>({})),m(n.federation.initOptions,"name",()=>v),m(n.federation.initOptions,"shareStrategy",()=>b),m(n.federation.initOptions,"shared",()=>{let e={};for(let[t,n]of Object.entries(S))for(let r of n)if("object"==typeof r&&null!==r){let{name:n,version:i,factory:o,eager:s,singleton:a,requiredVersion:l,strictVersion:u}=r,c={},h=function(e){return void 0!==e};h(a)&&(c.singleton=a),h(l)&&(c.requiredVersion=l),h(s)&&(c.eager=s),h(u)&&(c.strictVersion=u);let d={version:i,scope:[t],shareConfig:c,get:o};e[n]?e[n].push(d):e[n]=[d]}return e}),t(n.federation.initOptions,"remotes",()=>Object.values(_).flat().filter(e=>"script"===e.externalType)),t(n.federation.initOptions,"plugins",()=>y),m(n.federation,"bundlerRuntimeOptions",()=>({})),m(n.federation.bundlerRuntimeOptions,"remotes",()=>({})),m(n.federation.bundlerRuntimeOptions.remotes,"chunkMapping",()=>w),m(n.federation.bundlerRuntimeOptions.remotes,"idToExternalAndNameMapping",()=>{let e={};for(let[t,n]of Object.entries(E))e[t]=[n.shareScope,n.name,n.externalModuleId,n.remoteName];return e}),m(n.federation.bundlerRuntimeOptions.remotes,"webpackRequire",()=>n),t(n.federation.bundlerRuntimeOptions.remotes,"idToRemoteMap",()=>{let e={};for(let[t,n]of Object.entries(E)){let r=_[n.remoteName];r&&(e[t]=r)}return e}),e(n,"S",n.federation.bundlerRuntime.S),n.federation.attachShareScopeMap&&n.federation.attachShareScopeMap(n),e(n.f,"remotes",(e,t)=>n.federation.bundlerRuntime.remotes({chunkId:e,promises:t,chunkMapping:w,idToExternalAndNameMapping:n.federation.bundlerRuntimeOptions.remotes.idToExternalAndNameMapping,idToRemoteMap:n.federation.bundlerRuntimeOptions.remotes.idToRemoteMap,webpackRequire:n})),e(n.f,"consumes",(e,t)=>n.federation.bundlerRuntime.consumes({chunkId:e,promises:t,chunkMapping:k,moduleToHandlerMapping:n.federation.consumesLoadingModuleToHandlerMapping,installedModules:R,webpackRequire:n})),e(n,"I",(e,t)=>n.federation.bundlerRuntime.I({shareScopeName:e,initScope:t,initPromises:x,initTokens:O,webpackRequire:n})),e(n,"initContainer",(e,t,r)=>n.federation.bundlerRuntime.initContainerEntry({shareScope:e,initScope:t,remoteEntryInitOptions:r,shareScopeKey:N,webpackRequire:n})),e(n,"getContainer",(e,t)=>{var r=n.initializeExposesData.moduleMap;return n.R=t,t=Object.prototype.hasOwnProperty.call(r,e)?r[e]():Promise.resolve().then(()=>{throw Error('Module "'+e+'" does not exist in container.')}),n.R=void 0,t}),n.federation.instance=n.federation.runtime.init(n.federation.initOptions),(null==(u=n.consumesLoadingData)?void 0:u.initialConsumes)&&n.federation.bundlerRuntime.installInitialConsumes({webpackRequire:n,installedModules:R,initialConsumes:n.consumesLoadingData.initialConsumes,moduleToHandlerMapping:n.federation.consumesLoadingModuleToHandlerMapping})}},6630:function(__unused_webpack_module,exports,__webpack_require__){function importNodeModule(e){if(!e)throw Error("import specifier is required");if(exports.nodeRuntimeImportCache.has(e))return exports.nodeRuntimeImportCache.get(e);let t=Function("name","return import(name)")(e).then(e=>e.default).catch(t=>{throw console.error(`Error importing module ${e}:`,t),exports.nodeRuntimeImportCache.delete(e),t});return exports.nodeRuntimeImportCache.set(e,t),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.setupWebpackRequirePatching=exports.setupChunkHandler=exports.setupScriptLoader=exports.deleteChunk=exports.installChunk=exports.loadChunk=exports.resolveUrl=exports.fetchAndRun=exports.loadFromFs=exports.returnFromGlobalInstances=exports.returnFromCache=exports.resolveFile=exports.nodeRuntimeImportCache=void 0,exports.importNodeModule=importNodeModule,exports.default=default_1,exports.nodeRuntimeImportCache=new Map;let resolveFile=(e,t)=>require("path").join(__dirname,e+__webpack_require__.u(t));exports.resolveFile=resolveFile;let returnFromCache=e=>{for(let t of Function("return globalThis")().__FEDERATION__.__INSTANCES__){let n=t.moduleCache.get(e);if(n?.remoteInfo)return n.remoteInfo.entry}return null};exports.returnFromCache=returnFromCache;let returnFromGlobalInstances=e=>{for(let t of Function("return globalThis")().__FEDERATION__.__INSTANCES__)for(let n of t.options.remotes)if(n.name===e||n.alias===e)return console.log("Backup remote entry found:",n.entry),n.entry;return null};exports.returnFromGlobalInstances=returnFromGlobalInstances;let loadFromFs=(e,t)=>{let n=require("fs"),r=require("path"),i=require("vm");n.existsSync(e)?n.readFile(e,"utf-8",(n,o)=>{if(n)return t(n,null);let s={};try{new i.Script(`(function(exports, require, __dirname, __filename) {${o}
})`,{filename:e,importModuleDynamically:i.constants?.USE_MAIN_CONTEXT_DEFAULT_LOADER??importNodeModule}).runInThisContext()(s,require,r.dirname(e),e),t(null,s)}catch(e){console.log("'runInThisContext threw'",e),t(e,null)}}):t(Error(`File ${e} does not exist`),null)};exports.loadFromFs=loadFromFs;let fetchAndRun=(url,chunkName,callback,args)=>{("undefined"==typeof fetch?importNodeModule("node-fetch").then(e=>e.default):Promise.resolve(fetch)).then(e=>args.origin.loaderHook.lifecycle.fetch.emit(url.href,{}).then(t=>t&&t instanceof Response?t.text():e(url.href).then(e=>e.text()))).then(data=>{let chunk={};try{eval(`(function(exports, require, __dirname, __filename) {${data}
})`)(chunk,require,url.pathname.split("/").slice(0,-1).join("/"),chunkName),callback(null,chunk)}catch(e){callback(e,null)}}).catch(e=>callback(e,null))};exports.fetchAndRun=fetchAndRun;let resolveUrl=(e,t)=>{try{return new URL(t,__webpack_require__.p)}catch{let n=(0,exports.returnFromCache)(e)||(0,exports.returnFromGlobalInstances)(e);if(!n)return null;let r=new URL(n),i=require("path"),o=r.pathname,s=o.lastIndexOf("/"),a=s>=0?o.substring(0,s+1):"/",l=__webpack_require__.federation.rootOutputDir||"";return new URL(i.join(a,l,t).replace(/\\/g,"/"),r.origin)}};exports.resolveUrl=resolveUrl;let loadChunk=(e,t,n,r,i)=>{if("filesystem"===e)return(0,exports.loadFromFs)((0,exports.resolveFile)(n,t),r);let o=(0,exports.resolveUrl)(n,t);if(!o)return r(null,{modules:{},ids:[],runtime:null});(0,exports.fetchAndRun)(o,t,r,i)};exports.loadChunk=loadChunk;let installChunk=(e,t)=>{for(let t in e.modules)__webpack_require__.m[t]=e.modules[t];for(let n of(e.runtime&&e.runtime(__webpack_require__),e.ids))t[n]&&t[n][0](),t[n]=0};exports.installChunk=installChunk;let deleteChunk=(e,t)=>(delete t[e],!0);exports.deleteChunk=deleteChunk;let setupScriptLoader=()=>{__webpack_require__.l=(e,t,n,r)=>{if(!n||r)throw Error(`__webpack_require__.l name is required for ${e}`);__webpack_require__.federation.runtime.loadScriptNode(e,{attrs:{globalName:n}}).then(r=>{let i=__webpack_require__.federation.instance.initRawContainer(n,e,r);Function("return globalThis")()[n]=i,t(i)}).catch(t)}};exports.setupScriptLoader=setupScriptLoader;let setupChunkHandler=(e,t)=>(n,r)=>{let i=e[n];if(0!==i)if(i)r.push(i[2]);else if(!__webpack_require__.federation.chunkMatcher||__webpack_require__.federation.chunkMatcher(n)){let o=new Promise((r,o)=>{i=e[n]=[r,o];let s="undefined"!=typeof process&&require("fs"),a="undefined"!=typeof process&&(0,exports.resolveFile)(__webpack_require__.federation.rootOutputDir||"",n);if(s&&s.existsSync(a))(0,exports.loadChunk)("filesystem",n,__webpack_require__.federation.rootOutputDir||"",(t,i)=>{if(t)return(0,exports.deleteChunk)(n,e)&&o(t);i&&(0,exports.installChunk)(i,e),r(i)},t);else{let i=__webpack_require__.u(n),s="undefined"==typeof process?"http-eval":"http-vm";(0,exports.loadChunk)(s,i,__webpack_require__.federation.initOptions.name,(t,i)=>{if(t)return(0,exports.deleteChunk)(n,e)&&o(t);i&&(0,exports.installChunk)(i,e),r(i)},t)}});r.push(i[2]=o)}else e[n]=0};exports.setupChunkHandler=setupChunkHandler;let setupWebpackRequirePatching=e=>{__webpack_require__.f&&(__webpack_require__.f.require&&(console.warn("\x1b[33m%s\x1b[0m",'CAUTION: build target is not set to "async-node", attempting to patch additional chunk handlers. This may not work'),__webpack_require__.f.require=e),__webpack_require__.f.readFileVm&&(__webpack_require__.f.readFileVm=e))};function default_1(){return{name:"node-federation-plugin",beforeInit:e=>((()=>{let t={};(0,exports.setupScriptLoader)();let n=(0,exports.setupChunkHandler)(t,e);(0,exports.setupWebpackRequirePatching)(n)})(),e)}}exports.setupWebpackRequirePatching=setupWebpackRequirePatching},6956:function(e,t,n){var r=n(8536),i=n(36),o=n(7616);let s="[ Federation Runtime ]",a=i.createLogger(s);function l(e,t){e||u(t)}function u(e){if(e instanceof Error)throw e.message.startsWith(s)||(e.message=`${s}: ${e.message}`),e;throw Error(`${s}: ${e}`)}function c(e){e instanceof Error&&(e.message.startsWith(s)||(e.message=`${s}: ${e.message}`)),a.warn(e)}function h(e,t){return -1===e.findIndex(e=>e===t)&&e.push(t),e}function d(e){return"version"in e&&e.version?`${e.name}:${e.version}`:"entry"in e&&e.entry?`${e.name}:${e.entry}`:`${e.name}`}function f(e){return void 0!==e.entry}function p(e){return!e.entry.includes(".json")}async function m(e,t){try{return await e()}catch(e){t||c(e);return}}function g(e){return e&&"object"==typeof e}let y=Object.prototype.toString;function _(e){return"[object Object]"===y.call(e)}function v(e,t){let n=/^(https?:)?\/\//i;return e.replace(n,"").replace(/\/$/,"")===t.replace(n,"").replace(/\/$/,"")}function b(e){return Array.isArray(e)?e:[e]}function w(e){let t={url:"",type:"global",globalName:""};return i.isBrowserEnv()||i.isReactNativeEnv()?"remoteEntry"in e?{url:e.remoteEntry,type:e.remoteEntryType,globalName:e.globalName}:t:"ssrRemoteEntry"in e?{url:e.ssrRemoteEntry||t.url,type:e.ssrRemoteEntryType||t.type,globalName:e.globalName}:t}let E=(e,t)=>{let n;return n=e.endsWith("/")?e.slice(0,-1):e,t.startsWith(".")&&(t=t.slice(1)),n+=t},S="object"==typeof globalThis?globalThis:window,k=(()=>{try{return document.defaultView}catch(e){return S}})(),I=k;function R(e,t,n){Object.defineProperty(e,t,{value:n,configurable:!1,writable:!0})}function x(e,t){return Object.hasOwnProperty.call(e,t)}x(S,"__GLOBAL_LOADING_REMOTE_ENTRY__")||R(S,"__GLOBAL_LOADING_REMOTE_ENTRY__",{});let O=S.__GLOBAL_LOADING_REMOTE_ENTRY__;function N(e){var t,n,r,i,o,s,a,l,u,c,h,d;x(e,"__VMOK__")&&!x(e,"__FEDERATION__")&&R(e,"__FEDERATION__",e.__VMOK__),x(e,"__FEDERATION__")||(R(e,"__FEDERATION__",{__GLOBAL_PLUGIN__:[],__INSTANCES__:[],moduleInfo:{},__SHARE__:{},__MANIFEST_LOADING__:{},__PRELOADED_MAP__:new Map}),R(e,"__VMOK__",e.__FEDERATION__)),null!=(a=(t=e.__FEDERATION__).__GLOBAL_PLUGIN__)||(t.__GLOBAL_PLUGIN__=[]),null!=(l=(n=e.__FEDERATION__).__INSTANCES__)||(n.__INSTANCES__=[]),null!=(u=(r=e.__FEDERATION__).moduleInfo)||(r.moduleInfo={}),null!=(c=(i=e.__FEDERATION__).__SHARE__)||(i.__SHARE__={}),null!=(h=(o=e.__FEDERATION__).__MANIFEST_LOADING__)||(o.__MANIFEST_LOADING__={}),null!=(d=(s=e.__FEDERATION__).__PRELOADED_MAP__)||(s.__PRELOADED_MAP__=new Map)}function A(){S.__FEDERATION__.__GLOBAL_PLUGIN__=[],S.__FEDERATION__.__INSTANCES__=[],S.__FEDERATION__.moduleInfo={},S.__FEDERATION__.__SHARE__={},S.__FEDERATION__.__MANIFEST_LOADING__={},Object.keys(O).forEach(e=>{delete O[e]})}function T(e){S.__FEDERATION__.__INSTANCES__.push(e)}function P(){return S.__FEDERATION__.__DEBUG_CONSTRUCTOR__}function M(e,t=i.isDebugMode()){t&&(S.__FEDERATION__.__DEBUG_CONSTRUCTOR__=e,S.__FEDERATION__.__DEBUG_CONSTRUCTOR_VERSION__="0.18.0")}function C(e,t){if("string"==typeof t){if(e[t])return{value:e[t],key:t};for(let n of Object.keys(e)){let[r,i]=n.split(":"),o=`${r}:${t}`,s=e[o];if(s)return{value:s,key:o}}return{value:void 0,key:t}}throw Error("key must be string")}N(S),N(k);let D=()=>k.__FEDERATION__.moduleInfo,$=(e,t)=>{let n=C(t,d(e)).value;if(n&&!n.version&&"version"in e&&e.version&&(n.version=e.version),n)return n;if("version"in e&&e.version){let{version:t}=e,n=d(r._object_without_properties_loose(e,["version"])),i=C(k.__FEDERATION__.moduleInfo,n).value;if((null==i?void 0:i.version)===t)return i}},j=e=>$(e,k.__FEDERATION__.moduleInfo),L=(e,t)=>{let n=d(e);return k.__FEDERATION__.moduleInfo[n]=t,k.__FEDERATION__.moduleInfo},F=e=>(k.__FEDERATION__.moduleInfo=r._extends({},k.__FEDERATION__.moduleInfo,e),()=>{for(let t of Object.keys(e))delete k.__FEDERATION__.moduleInfo[t]}),q=(e,t)=>{let n=t||`__FEDERATION_${e}:custom__`,r=S[n];return{remoteEntryKey:n,entryExports:r}},U=e=>{let{__GLOBAL_PLUGIN__:t}=k.__FEDERATION__;e.forEach(e=>{-1===t.findIndex(t=>t.name===e.name)?t.push(e):c(`The plugin ${e.name} has been registered.`)})},z=()=>k.__FEDERATION__.__GLOBAL_PLUGIN__,H=e=>S.__FEDERATION__.__PRELOADED_MAP__.get(e),B=e=>S.__FEDERATION__.__PRELOADED_MAP__.set(e,!0),G="default",V="global",K="[0-9A-Za-z-]+",W=`(?:\\+(${K}(?:\\.${K})*))`,Y="0|[1-9]\\d*",Z="[0-9]+",Q="\\d*[a-zA-Z-][a-zA-Z0-9-]*",J=`(?:${Z}|${Q})`,X=`(?:-?(${J}(?:\\.${J})*))`,ee=`(?:${Y}|${Q})`,et=`(?:-(${ee}(?:\\.${ee})*))`,en=`${Y}|x|X|\\*`,er=`[v=\\s]*(${en})(?:\\.(${en})(?:\\.(${en})(?:${et})?${W}?)?)?`,ei=`^\\s*(${er})\\s+-\\s+(${er})\\s*$`,eo=`(${Z})\\.(${Z})\\.(${Z})`,es=`[v=\\s]*${eo}${X}?${W}?`,ea="((?:<|>)?=?)",el=`(\\s*)${ea}\\s*(${es}|${er})`,eu="(?:~>?)",ec=`(\\s*)${eu}\\s+`,eh="(?:\\^)",ed=`(\\s*)${eh}\\s+`,ef="(<|>)?=?\\s*\\*",ep=`^${eh}${er}$`,em=`(${Y})\\.(${Y})\\.(${Y})`,eg=`v?${em}${et}?${W}?`,ey=`^${eu}${er}$`,e_=`^${ea}\\s*${er}$`,ev=`^${ea}\\s*(${eg})$|^$`,eb="^\\s*>=\\s*0.0.0\\s*$";function ew(e){return new RegExp(e)}function eE(e){return!e||"x"===e.toLowerCase()||"*"===e}function eS(...e){return t=>e.reduce((e,t)=>t(e),t)}function ek(e){return e.match(ew(ev))}function eI(e,t,n,r){let i=`${e}.${t}.${n}`;return r?`${i}-${r}`:i}function eR(e){return e.replace(ew(ei),(e,t,n,r,i,o,s,a,l,u,c,h)=>(t=eE(n)?"":eE(r)?`>=${n}.0.0`:eE(i)?`>=${n}.${r}.0`:`>=${t}`,a=eE(l)?"":eE(u)?`<${Number(l)+1}.0.0-0`:eE(c)?`<${l}.${Number(u)+1}.0-0`:h?`<=${l}.${u}.${c}-${h}`:`<=${a}`,`${t} ${a}`.trim()))}function ex(e){return e.replace(ew(el),"$1$2$3")}function eO(e){return e.replace(ew(ec),"$1~")}function eN(e){return e.replace(ew(ed),"$1^")}function eA(e){return e.trim().split(/\s+/).map(e=>e.replace(ew(ep),(e,t,n,r,i)=>{if(eE(t))return"";if(eE(n))return`>=${t}.0.0 <${Number(t)+1}.0.0-0`;if(eE(r))if("0"===t)return`>=${t}.${n}.0 <${t}.${Number(n)+1}.0-0`;else return`>=${t}.${n}.0 <${Number(t)+1}.0.0-0`;if(i)if("0"!==t)return`>=${t}.${n}.${r}-${i} <${Number(t)+1}.0.0-0`;else if("0"===n)return`>=${t}.${n}.${r}-${i} <${t}.${n}.${Number(r)+1}-0`;else return`>=${t}.${n}.${r}-${i} <${t}.${Number(n)+1}.0-0`;if("0"===t)if("0"===n)return`>=${t}.${n}.${r} <${t}.${n}.${Number(r)+1}-0`;else return`>=${t}.${n}.${r} <${t}.${Number(n)+1}.0-0`;return`>=${t}.${n}.${r} <${Number(t)+1}.0.0-0`})).join(" ")}function eT(e){return e.trim().split(/\s+/).map(e=>e.replace(ew(ey),(e,t,n,r,i)=>eE(t)?"":eE(n)?`>=${t}.0.0 <${Number(t)+1}.0.0-0`:eE(r)?`>=${t}.${n}.0 <${t}.${Number(n)+1}.0-0`:i?`>=${t}.${n}.${r}-${i} <${t}.${Number(n)+1}.0-0`:`>=${t}.${n}.${r} <${t}.${Number(n)+1}.0-0`)).join(" ")}function eP(e){return e.split(/\s+/).map(e=>e.trim().replace(ew(e_),(e,t,n,r,i,o)=>{let s=eE(n),a=s||eE(r),l=a||eE(i);if("="===t&&l&&(t=""),o="",s)if(">"===t||"<"===t)return"<0.0.0-0";else return"*";return t&&l?(a&&(r=0),i=0,">"===t?(t=">=",a?(n=Number(n)+1,r=0):r=Number(r)+1,i=0):"<="===t&&(t="<",a?n=Number(n)+1:r=Number(r)+1),"<"===t&&(o="-0"),`${t+n}.${r}.${i}${o}`):a?`>=${n}.0.0${o} <${Number(n)+1}.0.0-0`:l?`>=${n}.${r}.0${o} <${n}.${Number(r)+1}.0-0`:e})).join(" ")}function eM(e){return e.trim().replace(ew(ef),"")}function eC(e){return e.trim().replace(ew(eb),"")}function eD(e,t){return(e=Number(e)||e)>(t=Number(t)||t)?1:e===t?0:-1}function e$(e,t){let{preRelease:n}=e,{preRelease:r}=t;if(void 0===n&&r)return 1;if(n&&void 0===r)return -1;if(void 0===n&&void 0===r)return 0;for(let e=0,t=n.length;e<=t;e++){let t=n[e],i=r[e];if(t!==i){if(void 0===t&&void 0===i)return 0;if(!t)return 1;if(!i)return -1;return eD(t,i)}}return 0}function ej(e,t){return eD(e.major,t.major)||eD(e.minor,t.minor)||eD(e.patch,t.patch)||e$(e,t)}function eL(e,t){return e.version===t.version}function eF(e,t){switch(e.operator){case"":case"=":return eL(e,t);case">":return 0>ej(e,t);case">=":return eL(e,t)||0>ej(e,t);case"<":return ej(e,t)>0;case"<=":return eL(e,t)||ej(e,t)>0;case void 0:return!0;default:return!1}}function eq(e){return eS(eA,eT,eP,eM)(e)}function eU(e){return eS(eR,ex,eO,eN)(e.trim()).split(/\s+/).join(" ")}function ez(e,t){if(!e)return!1;let n=ek(e);if(!n)return!1;let[,r,,i,o,s,a]=n,l={operator:r,version:eI(i,o,s,a),major:i,minor:o,patch:s,preRelease:null==a?void 0:a.split(".")};for(let e of t.split("||")){let t=e.trim();if(!t||"*"===t||"x"===t)return!0;try{let e=eU(t);if(!e.trim())return!0;let n=e.split(" ").map(e=>eq(e)).join(" ");if(!n.trim())return!0;let r=n.split(/\s+/).map(e=>eC(e)).filter(Boolean);if(0===r.length)continue;let i=!0;for(let e of r){let t=ek(e);if(!t){i=!1;break}let[,n,,r,o,s,a]=t,u={operator:n,version:eI(r,o,s,a),major:r,minor:o,patch:s,preRelease:null==a?void 0:a.split(".")};if(!eF(u,l)){i=!1;break}}if(i)return!0}catch(e){console.error(`[semver] Error processing range part "${t}":`,e);continue}}return!1}function eH(e,t,n,i){var o,s,a;let l;return l="get"in e?e.get:"lib"in e?()=>Promise.resolve(e.lib):()=>Promise.resolve(()=>{throw Error(`Can not get shared '${n}'!`)}),r._extends({deps:[],useIn:[],from:t,loading:null},e,{shareConfig:r._extends({requiredVersion:`^${e.version}`,singleton:!1,eager:!1,strictVersion:!1},e.shareConfig),get:l,loaded:null!=e&&!!e.loaded||"lib"in e||void 0,version:null!=(o=e.version)?o:"0",scope:Array.isArray(e.scope)?e.scope:[null!=(s=e.scope)?s:"default"],strategy:(null!=(a=e.strategy)?a:i)||"version-first"})}function eB(e,t){let n=t.shared||{},i=t.name,o=Object.keys(n).reduce((e,r)=>{let o=b(n[r]);return e[r]=e[r]||[],o.forEach(n=>{e[r].push(eH(n,i,r,t.shareStrategy))}),e},{}),s=r._extends({},e.shared);return Object.keys(o).forEach(e=>{s[e]?o[e].forEach(t=>{s[e].find(e=>e.version===t.version)||s[e].push(t)}):s[e]=o[e]}),{shared:s,shareInfos:o}}function eG(e,t){let n=e=>{if(!Number.isNaN(Number(e))){let t=e.split("."),n=e;for(let e=0;e<3-t.length;e++)n+=".0";return n}return e};return!!ez(n(e),`<=${n(t)}`)}let eV=(e,t)=>{let n=t||function(e,t){return eG(e,t)};return Object.keys(e).reduce((e,t)=>!e||n(e,t)||"0"===e?t:e,0)},eK=e=>!!e.loaded||"function"==typeof e.lib,eW=e=>!!e.loading;function eY(e,t,n){let r=e[t][n],i=function(e,t){return!eK(r[e])&&eG(e,t)};return eV(e[t][n],i)}function eZ(e,t,n){let r=e[t][n],i=function(e,t){let n=e=>eK(e)||eW(e);if(n(r[t]))if(n(r[e]))return!!eG(e,t);else return!0;return!n(r[e])&&eG(e,t)};return eV(e[t][n],i)}function eQ(e){return"loaded-first"===e?eZ:eY}function eJ(e,t,n,r){if(!e)return;let{shareConfig:i,scope:o=G,strategy:s}=n;for(let a of Array.isArray(o)?o:[o])if(i&&e[a]&&e[a][t]){let{requiredVersion:o}=i,l=eQ(s)(e,a,t),h=()=>{if(i.singleton){if("string"==typeof o&&!ez(l,o)){let r=`Version ${l} from ${l&&e[a][t][l].from} of shared singleton module ${t} does not satisfy the requirement of ${n.from} which needs ${o})`;i.strictVersion?u(r):c(r)}return e[a][t][l]}if(!1===o||"*"===o||ez(l,o))return e[a][t][l];for(let[n,r]of Object.entries(e[a][t]))if(ez(n,o))return r},d={shareScopeMap:e,scope:a,pkgName:t,version:l,GlobalFederation:I.__FEDERATION__,resolver:h};return(r.emit(d)||d).resolver()}}function eX(){return I.__FEDERATION__.__SHARE__}function e0(e){var t;let{pkgName:n,extraOptions:r,shareInfos:i}=e,o=e=>{if(!e)return;let t={};e.forEach(e=>{t[e.version]=e});let n=function(e,n){return!eK(t[e])&&eG(e,n)},r=eV(t,n);return t[r]};return Object.assign({},(null!=(t=null==r?void 0:r.resolver)?t:o)(i[n]),null==r?void 0:r.customShareInfo)}function e1(){return"undefined"!=typeof FEDERATION_BUILD_IDENTIFIER?FEDERATION_BUILD_IDENTIFIER:""}function e2(e,t){for(let n of e){let e=t.startsWith(n.name),r=t.replace(n.name,"");if(e){if(r.startsWith("/"))return{pkgNameOrAlias:n.name,expose:r=`.${r}`,remote:n};else if(""===r)return{pkgNameOrAlias:n.name,expose:".",remote:n}}let i=n.alias&&t.startsWith(n.alias),o=n.alias&&t.replace(n.alias,"");if(n.alias&&i){if(o&&o.startsWith("/"))return{pkgNameOrAlias:n.alias,expose:o=`.${o}`,remote:n};else if(""===o)return{pkgNameOrAlias:n.alias,expose:".",remote:n}}}}function e3(e,t){for(let n of e)if(t===n.name||n.alias&&t===n.alias)return n}function e4(e,t){let n=z(),r=[t.hooks,t.remoteHandler.hooks,t.sharedHandler.hooks,t.snapshotHandler.hooks,t.loaderHook,t.bridgeHook];return n.length>0&&n.forEach(t=>{(null==e?void 0:e.find(e=>e.name!==t.name))&&e.push(t)}),e&&e.length>0&&e.forEach(e=>{r.forEach(n=>{n.applyPlugin(e,t)})}),e}let e5=".then(callbacks[0]).catch(callbacks[1])";async function e9({entry:e,remoteEntryExports:t}){return new Promise((n,r)=>{try{t?n(t):"undefined"!=typeof FEDERATION_ALLOW_NEW_FUNCTION?Function("callbacks",`import("${e}")${e5}`)([n,r]):import(e).then(n).catch(r)}catch(e){r(e)}})}async function e6({entry:e,remoteEntryExports:t}){return new Promise((n,r)=>{try{t?n(t):Function("callbacks",`System.import("${e}")${e5}`)([n,r])}catch(e){r(e)}})}function e8(e,t,n){let{remoteEntryKey:r,entryExports:i}=q(e,t);return l(i,o.getShortErrorMsg(o.RUNTIME_001,o.runtimeDescMap,{remoteName:e,remoteEntryUrl:n,remoteEntryKey:r})),i}async function e7({name:e,globalName:t,entry:n,loaderHook:r}){let{entryExports:s}=q(e,t);return s||i.loadScript(n,{attrs:{},createScriptHook:(e,t)=>{let n=r.lifecycle.createScript.emit({url:e,attrs:t});if(n&&(n instanceof HTMLScriptElement||"script"in n||"timeout"in n))return n}}).then(()=>e8(e,t,n)).catch(t=>{throw l(void 0,o.getShortErrorMsg(o.RUNTIME_008,o.runtimeDescMap,{remoteName:e,resourceUrl:n})),t})}async function te({remoteInfo:e,remoteEntryExports:t,loaderHook:n}){let{entry:r,entryGlobalName:i,name:o,type:s}=e;switch(s){case"esm":case"module":return e9({entry:r,remoteEntryExports:t});case"system":return e6({entry:r,remoteEntryExports:t});default:return e7({entry:r,globalName:i,name:o,loaderHook:n})}}async function tt({remoteInfo:e,loaderHook:t}){let{entry:n,entryGlobalName:r,name:o,type:s}=e,{entryExports:a}=q(o,r);return a||i.loadScriptNode(n,{attrs:{name:o,globalName:r,type:s},loaderHook:{createScriptHook:(e,n={})=>{let r=t.lifecycle.createScript.emit({url:e,attrs:n});if(r&&"url"in r)return r}}}).then(()=>e8(o,r,n)).catch(e=>{throw e})}function tn(e){let{entry:t,name:n}=e;return i.composeKeyWithSeparator(n,t)}async function tr({origin:e,remoteEntryExports:t,remoteInfo:n}){let r=tn(n);if(t)return t;if(!O[r]){let o=e.remoteHandler.hooks.lifecycle.loadEntry,s=e.loaderHook;O[r]=o.emit({loaderHook:s,remoteInfo:n,remoteEntryExports:t}).then(e=>e||(("undefined"!=typeof ENV_TARGET?"web"===ENV_TARGET:i.isBrowserEnv())?te({remoteInfo:n,remoteEntryExports:t,loaderHook:s}):tt({remoteInfo:n,loaderHook:s})))}return O[r]}function ti(e){return r._extends({},e,{entry:"entry"in e?e.entry:"",type:e.type||V,entryGlobalName:e.entryGlobalName||e.name,shareScope:e.shareScope||G})}function to(e){return r._extends({resourceCategory:"sync",share:!0,depsRemote:!0,prefetchInterface:!1},e)}function ts(e,t){return t.map(t=>{let n=e3(e,t.nameOrAlias);return l(n,`Unable to preload ${t.nameOrAlias} as it is not included in ${!n&&i.safeToString({remoteInfo:n,remotes:e})}`),{remote:n,preloadConfig:to(t)}})}function ta(e){return e?e.map(e=>"."===e?e:e.startsWith("./")?e.replace("./",""):e):[]}function tl(e,t,n,r=!0){let{cssAssets:o,jsAssetsWithoutEntry:s,entryAssets:a}=n;if(t.options.inBrowser){if(a.forEach(n=>{let{moduleInfo:r}=n,i=t.moduleCache.get(e.name);i?tr({origin:t,remoteInfo:r,remoteEntryExports:i.remoteEntryExports}):tr({origin:t,remoteInfo:r,remoteEntryExports:void 0})}),r){let e={rel:"preload",as:"style"};o.forEach(n=>{let{link:r,needAttach:o}=i.createLink({url:n,cb:()=>{},attrs:e,createLinkHook:(e,n)=>{let r=t.loaderHook.lifecycle.createLink.emit({url:e,attrs:n});if(r instanceof HTMLLinkElement)return r}});o&&document.head.appendChild(r)})}else{let e={rel:"stylesheet",type:"text/css"};o.forEach(n=>{let{link:r,needAttach:o}=i.createLink({url:n,cb:()=>{},attrs:e,createLinkHook:(e,n)=>{let r=t.loaderHook.lifecycle.createLink.emit({url:e,attrs:n});if(r instanceof HTMLLinkElement)return r},needDeleteLink:!1});o&&document.head.appendChild(r)})}if(r){let e={rel:"preload",as:"script"};s.forEach(n=>{let{link:r,needAttach:o}=i.createLink({url:n,cb:()=>{},attrs:e,createLinkHook:(e,n)=>{let r=t.loaderHook.lifecycle.createLink.emit({url:e,attrs:n});if(r instanceof HTMLLinkElement)return r}});o&&document.head.appendChild(r)})}else{let n={fetchpriority:"high",type:(null==e?void 0:e.type)==="module"?"module":"text/javascript"};s.forEach(e=>{let{script:r,needAttach:o}=i.createScript({url:e,cb:()=>{},attrs:n,createScriptHook:(e,n)=>{let r=t.loaderHook.lifecycle.createScript.emit({url:e,attrs:n});if(r instanceof HTMLScriptElement)return r},needDeleteScript:!0});o&&document.head.appendChild(r)})}}}var tu={global:{Global:I,nativeGlobal:k,resetFederationGlobalInfo:A,setGlobalFederationInstance:T,getGlobalFederationConstructor:P,setGlobalFederationConstructor:M,getInfoWithoutType:C,getGlobalSnapshot:D,getTargetSnapshotInfoByModuleInfo:$,getGlobalSnapshotInfoByModuleInfo:j,setGlobalSnapshotInfoByModuleInfo:L,addGlobalSnapshot:F,getRemoteEntryExports:q,registerGlobalPlugins:U,getGlobalHostPlugins:z,getPreloaded:H,setPreloaded:B},share:{getRegisteredShare:eJ,getGlobalShareScope:eX},utils:{matchRemoteWithNameAndExpose:e2,preloadAssets:tl,getRemoteInfo:ti}};let tc=class{async getEntry(){let e;if(this.remoteEntryExports)return this.remoteEntryExports;try{e=await tr({origin:this.host,remoteInfo:this.remoteInfo,remoteEntryExports:this.remoteEntryExports})}catch(n){let t=tn(this.remoteInfo);e=await this.host.loaderHook.lifecycle.loadEntryError.emit({getRemoteEntry:tr,origin:this.host,remoteInfo:this.remoteInfo,remoteEntryExports:this.remoteEntryExports,globalLoading:O,uniqueKey:t})}return l(e,`remoteEntryExports is undefined 
 ${i.safeToString(this.remoteInfo)}`),this.remoteEntryExports=e,this.remoteEntryExports}async get(e,t,n,i){let s,{loadFactory:a=!0}=n||{loadFactory:!0},c=await this.getEntry();if(!this.inited){let t=this.host.shareScopeMap,n=Array.isArray(this.remoteInfo.shareScope)?this.remoteInfo.shareScope:[this.remoteInfo.shareScope];n.length||n.push("default"),n.forEach(e=>{t[e]||(t[e]={})});let s=t[n[0]],a=[],l={version:this.remoteInfo.version||"",shareScopeKeys:Array.isArray(this.remoteInfo.shareScope)?n:this.remoteInfo.shareScope||"default"};Object.defineProperty(l,"shareScopeMap",{value:t,enumerable:!1});let h=await this.host.hooks.lifecycle.beforeInitContainer.emit({shareScope:s,remoteEntryInitOptions:l,initScope:a,remoteInfo:this.remoteInfo,origin:this.host});void 0===(null==c?void 0:c.init)&&u(o.getShortErrorMsg(o.RUNTIME_002,o.runtimeDescMap,{hostName:this.host.name,remoteName:this.remoteInfo.name,remoteEntryUrl:this.remoteInfo.entry,remoteEntryKey:this.remoteInfo.entryGlobalName})),await c.init(h.shareScope,h.initScope,h.remoteEntryInitOptions),await this.host.hooks.lifecycle.initContainer.emit(r._extends({},h,{id:e,remoteSnapshot:i,remoteEntryExports:c}))}this.lib=c,this.inited=!0,(s=await this.host.loaderHook.lifecycle.getModuleFactory.emit({remoteEntryExports:c,expose:t,moduleInfo:this.remoteInfo}))||(s=await c.get(t)),l(s,`${d(this.remoteInfo)} remote don't export ${t}.`);let h=E(this.remoteInfo.name,t),f=this.wraperFactory(s,h);return a?await f():f}wraperFactory(e,t){function n(e,t){e&&"object"==typeof e&&Object.isExtensible(e)&&!Object.getOwnPropertyDescriptor(e,Symbol.for("mf_module_id"))&&Object.defineProperty(e,Symbol.for("mf_module_id"),{value:t,enumerable:!1})}return e instanceof Promise?async()=>{let r=await e();return n(r,t),r}:()=>{let r=e();return n(r,t),r}}constructor({remoteInfo:e,host:t}){this.inited=!1,this.lib=void 0,this.remoteInfo=e,this.host=t}};class th{on(e){"function"==typeof e&&this.listeners.add(e)}once(e){let t=this;this.on(function n(...r){return t.remove(n),e.apply(null,r)})}emit(...e){let t;return this.listeners.size>0&&this.listeners.forEach(n=>{t=n(...e)}),t}remove(e){this.listeners.delete(e)}removeAll(){this.listeners.clear()}constructor(e){this.type="",this.listeners=new Set,e&&(this.type=e)}}class td extends th{emit(...e){let t,n=Array.from(this.listeners);if(n.length>0){let r=0,i=t=>!1!==t&&(r<n.length?Promise.resolve(n[r++].apply(null,e)).then(i):t);t=i()}return Promise.resolve(t)}}function tf(e,t){if(!g(t))return!1;if(e!==t){for(let n in e)if(!(n in t))return!1}return!0}class tp extends th{emit(e){for(let t of(g(e)||u(`The data for the "${this.type}" hook should be an object.`),this.listeners))try{let n=t(e);if(tf(e,n))e=n;else{this.onerror(`A plugin returned an unacceptable value for the "${this.type}" type.`);break}}catch(e){c(e),this.onerror(e)}return e}constructor(e){super(),this.onerror=u,this.type=e}}class tm extends th{emit(e){g(e)||u(`The response data for the "${this.type}" hook must be an object.`);let t=Array.from(this.listeners);if(t.length>0){let n=0,r=t=>(c(t),this.onerror(t),e),i=o=>{if(tf(e,o)){if(e=o,n<t.length)try{return Promise.resolve(t[n++](e)).then(i,r)}catch(e){return r(e)}}else this.onerror(`A plugin returned an incorrect value for the "${this.type}" type.`);return e};return Promise.resolve(i(e))}return Promise.resolve(e)}constructor(e){super(),this.onerror=u,this.type=e}}class tg{applyPlugin(e,t){l(_(e),"Plugin configuration is invalid.");let n=e.name;l(n,"A name must be provided by the plugin."),this.registerPlugins[n]||(this.registerPlugins[n]=e,null==e.apply||e.apply.call(e,t),Object.keys(this.lifecycle).forEach(t=>{let n=e[t];n&&this.lifecycle[t].on(n)}))}removePlugin(e){l(e,"A name is required.");let t=this.registerPlugins[e];l(t,`The plugin "${e}" is not registered.`),Object.keys(t).forEach(e=>{"name"!==e&&this.lifecycle[e].remove(t[e])})}constructor(e){this.registerPlugins={},this.lifecycle=e,this.lifecycleKeys=Object.keys(e)}}function ty(e,t){let n=w(t);n.url||u(`The attribute remoteEntry of ${e.name} must not be undefined.`);let r=i.getResourceUrl(t,n.url);i.isBrowserEnv()||r.startsWith("http")||(r=`https:${r}`),e.type=n.type,e.entryGlobalName=n.globalName,e.entry=r,e.version=t.version,e.buildVersion=t.buildVersion}function t_(){return{name:"snapshot-plugin",async afterResolve(e){let{remote:t,pkgNameOrAlias:n,expose:i,origin:o,remoteInfo:s,id:a}=e;if(!f(t)||!p(t)){let{remoteSnapshot:l,globalSnapshot:u}=await o.snapshotHandler.loadRemoteSnapshotInfo({moduleInfo:t,id:a});ty(s,l);let c={remote:t,preloadConfig:{nameOrAlias:n,exposes:[i],resourceCategory:"sync",share:!1,depsRemote:!1}},h=await o.remoteHandler.hooks.lifecycle.generatePreloadAssets.emit({origin:o,preloadOptions:c,remoteInfo:s,remote:t,remoteSnapshot:l,globalSnapshot:u});return h&&tl(s,o,h,!1),r._extends({},e,{remoteSnapshot:l})}return e}}}function tv(e){let t=e.split(":");return 1===t.length?{name:t[0],version:void 0}:2===t.length?{name:t[0],version:t[1]}:{name:t[1],version:t[2]}}function tb(e,t,n,r,o={},s){let{value:a}=C(e,d(t)),l=s||a;if(l&&!i.isManifestProvider(l)&&(n(l,t,r),l.remotesInfo))for(let t of Object.keys(l.remotesInfo)){if(o[t])continue;o[t]=!0;let r=tv(t),i=l.remotesInfo[t];tb(e,{name:r.name,version:i.matchedVersion},n,!1,o,void 0)}}let tw=(e,t)=>document.querySelector(`${e}[${"link"===e?"href":"src"}="${t}"]`);function tE(e,t,n,r,o){let s=[],a=[],l=[],u=new Set,c=new Set,{options:h}=e,{preloadConfig:d}=t,{depsRemote:f}=d;if(tb(r,n,(t,n,r)=>{let o;if(r)o=d;else if(Array.isArray(f)){let e=f.find(e=>e.nameOrAlias===n.name||e.nameOrAlias===n.alias);if(!e)return;o=to(e)}else{if(!0!==f)return;o=d}let u=i.getResourceUrl(t,w(t).url);u&&l.push({name:n.name,moduleInfo:{name:n.name,entry:u,type:"remoteEntryType"in t?t.remoteEntryType:"global",entryGlobalName:"globalName"in t?t.globalName:n.name,shareScope:"",version:"version"in t?t.version:void 0},url:u});let c="modules"in t?t.modules:[],h=ta(o.exposes);if(h.length&&"modules"in t){var p;c=null==t||null==(p=t.modules)?void 0:p.reduce((e,t)=>((null==h?void 0:h.indexOf(t.moduleName))!==-1&&e.push(t),e),[])}function m(e){let n=e.map(e=>i.getResourceUrl(t,e));return o.filter?n.filter(o.filter):n}if(c){let r=c.length;for(let i=0;i<r;i++){let r=c[i],l=`${n.name}/${r.moduleName}`;e.remoteHandler.hooks.lifecycle.handlePreloadModule.emit({id:"."===r.moduleName?n.name:l,name:n.name,remoteSnapshot:t,preloadConfig:o,remote:n,origin:e}),H(l)||("all"===o.resourceCategory?(s.push(...m(r.assets.css.async)),s.push(...m(r.assets.css.sync)),a.push(...m(r.assets.js.async))):(o.resourceCategory="sync",s.push(...m(r.assets.css.sync))),a.push(...m(r.assets.js.sync)),B(l))}}},!0,{},o),o.shared&&o.shared.length>0){let t=(t,n)=>{let r=eJ(e.shareScopeMap,n.sharedName,t,e.sharedHandler.hooks.lifecycle.resolveShare);r&&"function"==typeof r.lib&&(n.assets.js.sync.forEach(e=>{u.add(e)}),n.assets.css.sync.forEach(e=>{c.add(e)}))};o.shared.forEach(e=>{var n;let r=null==(n=h.shared)?void 0:n[e.sharedName];if(!r)return;let i=e.version?r.find(t=>t.version===e.version):r;i&&b(i).forEach(n=>{t(n,e)})})}let p=a.filter(e=>!u.has(e)&&!tw("script",e));return{cssAssets:s.filter(e=>!c.has(e)&&!tw("link",e)),jsAssetsWithoutEntry:p,entryAssets:l.filter(e=>!tw("script",e.url))}}let tS=function(){return{name:"generate-preload-assets-plugin",async generatePreloadAssets(e){let{origin:t,preloadOptions:n,remoteInfo:r,remote:o,globalSnapshot:s,remoteSnapshot:a}=e;return i.isBrowserEnv()?f(o)&&p(o)?{cssAssets:[],jsAssetsWithoutEntry:[],entryAssets:[{name:o.name,url:o.entry,moduleInfo:{name:r.name,entry:o.entry,type:r.type||"global",entryGlobalName:"",shareScope:""}}]}:(ty(r,a),tE(t,n,r,s,a)):{cssAssets:[],jsAssetsWithoutEntry:[],entryAssets:[]}}}};function tk(e,t){let n=j({name:t.name,version:t.options.version}),r=n&&"remotesInfo"in n&&n.remotesInfo&&C(n.remotesInfo,e.name).value;return r&&r.matchedVersion?{hostGlobalSnapshot:n,globalSnapshot:D(),remoteSnapshot:j({name:e.name,version:r.matchedVersion})}:{hostGlobalSnapshot:void 0,globalSnapshot:D(),remoteSnapshot:j({name:e.name,version:"version"in e?e.version:void 0})}}class tI{async loadRemoteSnapshotInfo({moduleInfo:e,id:t,expose:n}){let s,a,{options:l}=this.HostInstance;await this.hooks.lifecycle.beforeLoadRemoteSnapshot.emit({options:l,moduleInfo:e});let c=j({name:this.HostInstance.options.name,version:this.HostInstance.options.version});c||(c={version:this.HostInstance.options.version||"",remoteEntry:"",remotesInfo:{}},F({[this.HostInstance.options.name]:c})),c&&"remotesInfo"in c&&!C(c.remotesInfo,e.name).value&&("version"in e||"entry"in e)&&(c.remotesInfo=r._extends({},null==c?void 0:c.remotesInfo,{[e.name]:{matchedVersion:"version"in e?e.version:e.entry}}));let{hostGlobalSnapshot:h,remoteSnapshot:d,globalSnapshot:p}=this.getGlobalRemoteInfo(e),{remoteSnapshot:m,globalSnapshot:g}=await this.hooks.lifecycle.loadSnapshot.emit({options:l,moduleInfo:e,hostGlobalSnapshot:h,remoteSnapshot:d,globalSnapshot:p});if(m)if(i.isManifestProvider(m)){let t=i.isBrowserEnv()?m.remoteEntry:m.ssrRemoteEntry||m.remoteEntry||"",n=await this.getManifestJson(t,e,{}),o=L(r._extends({},e,{entry:t}),n);s=n,a=o}else{let{remoteSnapshot:t}=await this.hooks.lifecycle.loadRemoteSnapshot.emit({options:this.HostInstance.options,moduleInfo:e,remoteSnapshot:m,from:"global"});s=t,a=g}else if(f(e)){let t=await this.getManifestJson(e.entry,e,{}),n=L(e,t),{remoteSnapshot:r}=await this.hooks.lifecycle.loadRemoteSnapshot.emit({options:this.HostInstance.options,moduleInfo:e,remoteSnapshot:t,from:"global"});s=r,a=n}else u(o.getShortErrorMsg(o.RUNTIME_007,o.runtimeDescMap,{hostName:e.name,hostVersion:e.version,globalSnapshot:JSON.stringify(g)}));return await this.hooks.lifecycle.afterLoadSnapshot.emit({id:t,host:this.HostInstance,options:l,moduleInfo:e,remoteSnapshot:s}),{remoteSnapshot:s,globalSnapshot:a}}getGlobalRemoteInfo(e){return tk(e,this.HostInstance)}async getManifestJson(e,t,n){let r=async()=>{let n=this.manifestCache.get(e);if(n)return n;try{let t=await this.loaderHook.lifecycle.fetch.emit(e,{});t&&t instanceof Response||(t=await fetch(e,{})),n=await t.json()}catch(r){(n=await this.HostInstance.remoteHandler.hooks.lifecycle.errorLoadRemote.emit({id:e,error:r,from:"runtime",lifecycle:"afterResolve",origin:this.HostInstance}))||(delete this.manifestLoading[e],u(o.getShortErrorMsg(o.RUNTIME_003,o.runtimeDescMap,{manifestUrl:e,moduleName:t.name,hostName:this.HostInstance.options.name},`${r}`)))}return l(n.metaData&&n.exposes&&n.shared,`${e} is not a federation manifest`),this.manifestCache.set(e,n),n},s=async()=>{let n=await r(),o=i.generateSnapshotFromManifest(n,{version:e}),{remoteSnapshot:s}=await this.hooks.lifecycle.loadRemoteSnapshot.emit({options:this.HostInstance.options,moduleInfo:t,manifestJson:n,remoteSnapshot:o,manifestUrl:e,from:"manifest"});return s};return this.manifestLoading[e]||(this.manifestLoading[e]=s().then(e=>e)),this.manifestLoading[e]}constructor(e){this.loadingHostSnapshot=null,this.manifestCache=new Map,this.hooks=new tg({beforeLoadRemoteSnapshot:new td("beforeLoadRemoteSnapshot"),loadSnapshot:new tm("loadGlobalSnapshot"),loadRemoteSnapshot:new tm("loadRemoteSnapshot"),afterLoadSnapshot:new tm("afterLoadSnapshot")}),this.manifestLoading=I.__FEDERATION__.__MANIFEST_LOADING__,this.HostInstance=e,this.loaderHook=e.loaderHook}}class tR{registerShared(e,t){let{shareInfos:n,shared:r}=eB(e,t);return Object.keys(n).forEach(e=>{n[e].forEach(n=>{!eJ(this.shareScopeMap,e,n,this.hooks.lifecycle.resolveShare)&&n&&n.lib&&this.setShared({pkgName:e,lib:n.lib,get:n.get,loaded:!0,shared:n,from:t.name})})}),{shareInfos:n,shared:r}}async loadShare(e,t){let{host:n}=this,r=e0({pkgName:e,extraOptions:t,shareInfos:n.options.shared});(null==r?void 0:r.scope)&&await Promise.all(r.scope.map(async e=>{await Promise.all(this.initializeSharing(e,{strategy:r.strategy}))}));let{shareInfo:i}=await this.hooks.lifecycle.beforeLoadShare.emit({pkgName:e,shareInfo:r,shared:n.options.shared,origin:n});l(i,`Cannot find ${e} Share in the ${n.options.name}. Please ensure that the ${e} Share parameters have been injected`);let o=eJ(this.shareScopeMap,e,i,this.hooks.lifecycle.resolveShare),s=e=>{e.useIn||(e.useIn=[]),h(e.useIn,n.options.name)};if(o&&o.lib)return s(o),o.lib;if(o&&o.loading&&!o.loaded){let e=await o.loading;return o.loaded=!0,o.lib||(o.lib=e),s(o),e}if(o){let t=(async()=>{let t=await o.get();i.lib=t,i.loaded=!0,s(i);let n=eJ(this.shareScopeMap,e,i,this.hooks.lifecycle.resolveShare);return n&&(n.lib=t,n.loaded=!0,s(n)),t})();return this.setShared({pkgName:e,loaded:!1,shared:o,from:n.options.name,lib:null,loading:t}),t}{if(null==t?void 0:t.customShareInfo)return!1;let r=(async()=>{let t=await i.get();i.lib=t,i.loaded=!0,s(i);let n=eJ(this.shareScopeMap,e,i,this.hooks.lifecycle.resolveShare);return n&&(n.lib=t,n.loaded=!0),t})();return this.setShared({pkgName:e,loaded:!1,shared:i,from:n.options.name,lib:null,loading:r}),r}}initializeSharing(e=G,t){let{host:n}=this,r=null==t?void 0:t.from,i=null==t?void 0:t.strategy,o=null==t?void 0:t.initScope,s=[];if("build"!==r){let{initTokens:t}=this;o||(o=[]);let n=t[e];if(n||(n=t[e]={from:this.host.name}),o.indexOf(n)>=0)return s;o.push(n)}let a=this.shareScopeMap,l=n.options.name;a[e]||(a[e]={});let u=a[e],c=(e,t)=>{var n;let{version:r,eager:i}=t;u[e]=u[e]||{};let o=u[e],s=o[r],a=!!(s&&(s.eager||(null==(n=s.shareConfig)?void 0:n.eager)));(!s||"loaded-first"!==s.strategy&&!s.loaded&&(!i!=!a?i:l>s.from))&&(o[r]=t)},h=t=>t&&t.init&&t.init(a[e],o),d=async e=>{let{module:t}=await n.remoteHandler.getRemoteModuleAndOptions({id:e});if(t.getEntry){let r;try{r=await t.getEntry()}catch(t){r=await n.remoteHandler.hooks.lifecycle.errorLoadRemote.emit({id:e,error:t,from:"runtime",lifecycle:"beforeLoadShare",origin:n})}t.inited||(await h(r),t.inited=!0)}};return Object.keys(n.options.shared).forEach(t=>{n.options.shared[t].forEach(n=>{n.scope.includes(e)&&c(t,n)})}),("version-first"===n.options.shareStrategy||"version-first"===i)&&n.options.remotes.forEach(t=>{t.shareScope===e&&s.push(d(t.name))}),s}loadShareSync(e,t){let{host:n}=this,r=e0({pkgName:e,extraOptions:t,shareInfos:n.options.shared});(null==r?void 0:r.scope)&&r.scope.forEach(e=>{this.initializeSharing(e,{strategy:r.strategy})});let i=eJ(this.shareScopeMap,e,r,this.hooks.lifecycle.resolveShare),s=e=>{e.useIn||(e.useIn=[]),h(e.useIn,n.options.name)};if(i){if("function"==typeof i.lib)return s(i),i.loaded||(i.loaded=!0,i.from===n.options.name&&(r.loaded=!0)),i.lib;if("function"==typeof i.get){let t=i.get();if(!(t instanceof Promise))return s(i),this.setShared({pkgName:e,loaded:!0,from:n.options.name,lib:t,shared:i}),t}}if(r.lib)return r.loaded||(r.loaded=!0),r.lib;if(r.get){let i=r.get();if(i instanceof Promise){let r=(null==t?void 0:t.from)==="build"?o.RUNTIME_005:o.RUNTIME_006;throw Error(o.getShortErrorMsg(r,o.runtimeDescMap,{hostName:n.options.name,sharedPkgName:e}))}return r.lib=i,this.setShared({pkgName:e,loaded:!0,from:n.options.name,lib:r.lib,shared:r}),r.lib}throw Error(o.getShortErrorMsg(o.RUNTIME_006,o.runtimeDescMap,{hostName:n.options.name,sharedPkgName:e}))}initShareScopeMap(e,t,n={}){let{host:r}=this;this.shareScopeMap[e]=t,this.hooks.lifecycle.initContainerShareScopeMap.emit({shareScope:t,options:r.options,origin:r,scopeName:e,hostShareScopeMap:n.hostShareScopeMap})}setShared({pkgName:e,shared:t,from:n,lib:i,loading:o,loaded:s,get:a}){let{version:l,scope:u="default"}=t,c=r._object_without_properties_loose(t,["version","scope"]);(Array.isArray(u)?u:[u]).forEach(t=>{if(this.shareScopeMap[t]||(this.shareScopeMap[t]={}),this.shareScopeMap[t][e]||(this.shareScopeMap[t][e]={}),!this.shareScopeMap[t][e][l]){this.shareScopeMap[t][e][l]=r._extends({version:l,scope:["default"]},c,{lib:i,loaded:s,loading:o}),a&&(this.shareScopeMap[t][e][l].get=a);return}let n=this.shareScopeMap[t][e][l];o&&!n.loading&&(n.loading=o)})}_setGlobalShareScopeMap(e){let t=eX(),n=e.id||e.name;n&&!t[n]&&(t[n]=this.shareScopeMap)}constructor(e){this.hooks=new tg({afterResolve:new tm("afterResolve"),beforeLoadShare:new tm("beforeLoadShare"),loadShare:new td,resolveShare:new tp("resolveShare"),initContainerShareScopeMap:new tp("initContainerShareScopeMap")}),this.host=e,this.shareScopeMap={},this.initTokens={},this._setGlobalShareScopeMap(e.options)}}class tx{formatAndRegisterRemote(e,t){return(t.remotes||[]).reduce((e,t)=>(this.registerRemote(t,e,{force:!1}),e),e.remotes)}setIdToRemoteMap(e,t){let{remote:n,expose:r}=t,{name:i,alias:o}=n;if(this.idToRemoteMap[e]={name:n.name,expose:r},o&&e.startsWith(i)){let t=e.replace(i,o);this.idToRemoteMap[t]={name:n.name,expose:r};return}if(o&&e.startsWith(o)){let t=e.replace(o,i);this.idToRemoteMap[t]={name:n.name,expose:r}}}async loadRemote(e,t){let{host:n}=this;try{let{loadFactory:r=!0}=t||{loadFactory:!0},{module:i,moduleOptions:o,remoteMatchInfo:s}=await this.getRemoteModuleAndOptions({id:e}),{pkgNameOrAlias:a,remote:l,expose:u,id:c,remoteSnapshot:h}=s,d=await i.get(c,u,t,h),f=await this.hooks.lifecycle.onLoad.emit({id:c,pkgNameOrAlias:a,expose:u,exposeModule:r?d:void 0,exposeModuleFactory:r?void 0:d,remote:l,options:o,moduleInstance:i,origin:n});if(this.setIdToRemoteMap(e,s),"function"==typeof f)return f;return d}catch(o){let{from:r="runtime"}=t||{from:"runtime"},i=await this.hooks.lifecycle.errorLoadRemote.emit({id:e,error:o,from:r,lifecycle:"onLoad",origin:n});if(!i)throw o;return i}}async preloadRemote(e){let{host:t}=this;await this.hooks.lifecycle.beforePreloadRemote.emit({preloadOps:e,options:t.options,origin:t});let n=ts(t.options.remotes,e);await Promise.all(n.map(async e=>{let{remote:n}=e,r=ti(n),{globalSnapshot:i,remoteSnapshot:o}=await t.snapshotHandler.loadRemoteSnapshotInfo({moduleInfo:n}),s=await this.hooks.lifecycle.generatePreloadAssets.emit({origin:t,preloadOptions:e,remote:n,remoteInfo:r,globalSnapshot:i,remoteSnapshot:o});s&&tl(r,t,s)}))}registerRemotes(e,t){let{host:n}=this;e.forEach(e=>{this.registerRemote(e,n.options.remotes,{force:null==t?void 0:t.force})})}async getRemoteModuleAndOptions(e){let t,{host:n}=this,{id:i}=e;try{t=await this.hooks.lifecycle.beforeRequest.emit({id:i,options:n.options,origin:n})}catch(e){if(!(t=await this.hooks.lifecycle.errorLoadRemote.emit({id:i,options:n.options,origin:n,from:"runtime",error:e,lifecycle:"beforeRequest"})))throw e}let{id:s}=t,a=e2(n.options.remotes,s);l(a,o.getShortErrorMsg(o.RUNTIME_004,o.runtimeDescMap,{hostName:n.options.name,requestId:s}));let{remote:u}=a,c=ti(u),h=await n.sharedHandler.hooks.lifecycle.afterResolve.emit(r._extends({id:s},a,{options:n.options,origin:n,remoteInfo:c})),{remote:d,expose:f}=h;l(d&&f,`The 'beforeRequest' hook was executed, but it failed to return the correct 'remote' and 'expose' values while loading ${s}.`);let p=n.moduleCache.get(d.name),m={host:n,remoteInfo:c};return p||(p=new tc(m),n.moduleCache.set(d.name,p)),{module:p,moduleOptions:m,remoteMatchInfo:h}}registerRemote(e,t,n){let{host:r}=this,o=()=>{if(e.alias){let n=t.find(t=>{var n;return e.alias&&(t.name.startsWith(e.alias)||(null==(n=t.alias)?void 0:n.startsWith(e.alias)))});l(!n,`The alias ${e.alias} of remote ${e.name} is not allowed to be the prefix of ${n&&n.name} name or alias`)}"entry"in e&&i.isBrowserEnv()&&!e.entry.startsWith("http")&&(e.entry=new URL(e.entry,window.location.origin).href),e.shareScope||(e.shareScope=G),e.type||(e.type=V)};this.hooks.lifecycle.beforeRegisterRemote.emit({remote:e,origin:r});let s=t.find(t=>t.name===e.name);if(s){let a=[`The remote "${e.name}" is already registered.`,"Please note that overriding it may cause unexpected errors."];(null==n?void 0:n.force)&&(this.removeRemote(s),o(),t.push(e),this.hooks.lifecycle.registerRemote.emit({remote:e,origin:r}),i.warn(a.join(" ")))}else o(),t.push(e),this.hooks.lifecycle.registerRemote.emit({remote:e,origin:r})}removeRemote(e){try{let{host:n}=this,{name:r}=e,o=n.options.remotes.findIndex(e=>e.name===r);-1!==o&&n.options.remotes.splice(o,1);let s=n.moduleCache.get(e.name);if(s){let r=s.remoteInfo,o=r.entryGlobalName;if(S[o]){var t;(null==(t=Object.getOwnPropertyDescriptor(S,o))?void 0:t.configurable)?delete S[o]:S[o]=void 0}let a=tn(s.remoteInfo);O[a]&&delete O[a],n.snapshotHandler.manifestCache.delete(r.entry);let l=r.buildVersion?i.composeKeyWithSeparator(r.name,r.buildVersion):r.name,u=S.__FEDERATION__.__INSTANCES__.findIndex(e=>r.buildVersion?e.options.id===l:e.name===l);if(-1!==u){let e=S.__FEDERATION__.__INSTANCES__[u];l=e.options.id||l;let t=eX(),n=!0,i=[];Object.keys(t).forEach(e=>{let o=t[e];o&&Object.keys(o).forEach(t=>{let s=o[t];s&&Object.keys(s).forEach(o=>{let a=s[o];a&&Object.keys(a).forEach(s=>{let l=a[s];l&&"object"==typeof l&&l.from===r.name&&(l.loaded||l.loading?(l.useIn=l.useIn.filter(e=>e!==r.name),l.useIn.length?n=!1:i.push([e,t,o,s])):i.push([e,t,o,s]))})})})}),n&&(e.shareScopeMap={},delete t[l]),i.forEach(([e,n,r,i])=>{var o,s,a;null==(a=t[e])||null==(s=a[n])||null==(o=s[r])||delete o[i]}),S.__FEDERATION__.__INSTANCES__.splice(u,1)}let{hostGlobalSnapshot:c}=tk(e,n);if(c){let t=c&&"remotesInfo"in c&&c.remotesInfo&&C(c.remotesInfo,e.name).key;t&&(delete c.remotesInfo[t],I.__FEDERATION__.__MANIFEST_LOADING__[t]&&delete I.__FEDERATION__.__MANIFEST_LOADING__[t])}n.moduleCache.delete(e.name)}}catch(e){a.log("removeRemote fail: ",e)}}constructor(e){this.hooks=new tg({beforeRegisterRemote:new tp("beforeRegisterRemote"),registerRemote:new tp("registerRemote"),beforeRequest:new tm("beforeRequest"),onLoad:new td("onLoad"),handlePreloadModule:new th("handlePreloadModule"),errorLoadRemote:new td("errorLoadRemote"),beforePreloadRemote:new td("beforePreloadRemote"),generatePreloadAssets:new td("generatePreloadAssets"),afterPreloadRemote:new td,loadEntry:new td}),this.host=e,this.idToRemoteMap={}}}let tO="boolean"!=typeof FEDERATION_OPTIMIZE_NO_SNAPSHOT_PLUGIN||!FEDERATION_OPTIMIZE_NO_SNAPSHOT_PLUGIN;class tN{initOptions(e){this.registerPlugins(e.plugins);let t=this.formatOptions(this.options,e);return this.options=t,t}async loadShare(e,t){return this.sharedHandler.loadShare(e,t)}loadShareSync(e,t){return this.sharedHandler.loadShareSync(e,t)}initializeSharing(e=G,t){return this.sharedHandler.initializeSharing(e,t)}initRawContainer(e,t,n){let r=new tc({host:this,remoteInfo:ti({name:e,entry:t})});return r.remoteEntryExports=n,this.moduleCache.set(e,r),r}async loadRemote(e,t){return this.remoteHandler.loadRemote(e,t)}async preloadRemote(e){return this.remoteHandler.preloadRemote(e)}initShareScopeMap(e,t,n={}){this.sharedHandler.initShareScopeMap(e,t,n)}formatOptions(e,t){let{shared:n}=eB(e,t),{userOptions:i,options:o}=this.hooks.lifecycle.beforeInit.emit({origin:this,userOptions:t,options:e,shareInfo:n}),s=this.remoteHandler.formatAndRegisterRemote(o,i),{shared:a}=this.sharedHandler.registerShared(o,i),l=[...o.plugins];i.plugins&&i.plugins.forEach(e=>{l.includes(e)||l.push(e)});let u=r._extends({},e,t,{plugins:l,remotes:s,shared:a});return this.hooks.lifecycle.init.emit({origin:this,options:u}),u}registerPlugins(e){let t=e4(e,this);this.options.plugins=this.options.plugins.reduce((e,t)=>(t&&e&&!e.find(e=>e.name===t.name)&&e.push(t),e),t||[])}registerRemotes(e,t){return this.remoteHandler.registerRemotes(e,t)}registerShared(e){this.sharedHandler.registerShared(this.options,r._extends({},this.options,{shared:e}))}constructor(e){this.hooks=new tg({beforeInit:new tp("beforeInit"),init:new th,beforeInitContainer:new tm("beforeInitContainer"),initContainer:new tm("initContainer")}),this.version="0.18.0",this.moduleCache=new Map,this.loaderHook=new tg({getModuleInfo:new th,createScript:new th,createLink:new th,fetch:new td,loadEntryError:new td,getModuleFactory:new td}),this.bridgeHook=new tg({beforeBridgeRender:new th,afterBridgeRender:new th,beforeBridgeDestroy:new th,afterBridgeDestroy:new th});const t=tO?[t_(),tS()]:[],n={id:e1(),name:e.name,plugins:t,remotes:[],shared:{},inBrowser:i.isBrowserEnv()};this.name=e.name,this.options=n,this.snapshotHandler=new tI(this),this.sharedHandler=new tR(this),this.remoteHandler=new tx(this),this.shareScopeMap=this.sharedHandler.shareScopeMap,this.registerPlugins([...n.plugins,...e.plugins||[]]),this.options=this.formatOptions(n,e)}}var tA=Object.freeze({__proto__:null});t.loadScript=i.loadScript,t.loadScriptNode=i.loadScriptNode,t.CurrentGlobal=S,t.Global=I,t.Module=tc,t.ModuleFederation=tN,t.addGlobalSnapshot=F,t.assert=l,t.getGlobalFederationConstructor=P,t.getGlobalSnapshot=D,t.getInfoWithoutType=C,t.getRegisteredShare=eJ,t.getRemoteEntry=tr,t.getRemoteInfo=ti,t.helpers=tu,t.isStaticResourcesEqual=v,t.matchRemoteWithNameAndExpose=e2,t.registerGlobalPlugins=U,t.resetFederationGlobalInfo=A,t.safeWrapper=m,t.satisfy=ez,t.setGlobalFederationConstructor=M,t.setGlobalFederationInstance=T,t.types=tA},8536:function(e,t){function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function r(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}t._extends=n,t._object_without_properties_loose=r},2676:function(e,t,n){var r=n(6956),i=n(7616),o=n(2119);function s(e){return new(r.getGlobalFederationConstructor()||r.ModuleFederation)(e)}let a=null;function l(e){let t=o.getGlobalFederationInstance(e.name,e.version);return t?(t.initOptions(e),a||(a=t),t):(a=s(e),r.setGlobalFederationInstance(a),a)}function u(...e){return r.assert(a,i.getShortErrorMsg(i.RUNTIME_009,i.runtimeDescMap)),a.loadRemote.apply(a,e)}function c(...e){return r.assert(a,i.getShortErrorMsg(i.RUNTIME_009,i.runtimeDescMap)),a.loadShare.apply(a,e)}function h(...e){return r.assert(a,i.getShortErrorMsg(i.RUNTIME_009,i.runtimeDescMap)),a.loadShareSync.apply(a,e)}function d(...e){return r.assert(a,i.getShortErrorMsg(i.RUNTIME_009,i.runtimeDescMap)),a.preloadRemote.apply(a,e)}function f(...e){return r.assert(a,i.getShortErrorMsg(i.RUNTIME_009,i.runtimeDescMap)),a.registerRemotes.apply(a,e)}function p(...e){return r.assert(a,i.getShortErrorMsg(i.RUNTIME_009,i.runtimeDescMap)),a.registerPlugins.apply(a,e)}function m(){return a}function g(...e){return r.assert(a,i.getShortErrorMsg(i.RUNTIME_009,i.runtimeDescMap)),a.registerShared.apply(a,e)}r.setGlobalFederationConstructor(r.ModuleFederation),t.Module=r.Module,t.ModuleFederation=r.ModuleFederation,t.getRemoteEntry=r.getRemoteEntry,t.getRemoteInfo=r.getRemoteInfo,t.loadScript=r.loadScript,t.loadScriptNode=r.loadScriptNode,t.registerGlobalPlugins=r.registerGlobalPlugins,t.createInstance=s,t.getInstance=m,t.init=l,t.loadRemote=u,t.loadShare=c,t.loadShareSync=h,t.preloadRemote=d,t.registerPlugins=p,t.registerRemotes=f,t.registerShared=g},2119:function(e,t,n){var r=n(6956);function i(){return"undefined"!=typeof FEDERATION_BUILD_IDENTIFIER?FEDERATION_BUILD_IDENTIFIER:""}t.getGlobalFederationInstance=function(e,t){let n=i();return r.CurrentGlobal.__FEDERATION__.__INSTANCES__.find(r=>!!n&&r.options.id===n||r.options.name===e&&!r.options.version&&!t||r.options.name===e&&!!t&&r.options.version===t)}},36:function(__unused_webpack_module,exports,__webpack_require__){var polyfills=__webpack_require__(9232);let FederationModuleManifest="federation-manifest.json",MANIFEST_EXT=".json",BROWSER_LOG_KEY="FEDERATION_DEBUG",NameTransformSymbol={AT:"@",HYPHEN:"-",SLASH:"/"},NameTransformMap={[NameTransformSymbol.AT]:"scope_",[NameTransformSymbol.HYPHEN]:"_",[NameTransformSymbol.SLASH]:"__"},EncodedNameTransformMap={[NameTransformMap[NameTransformSymbol.AT]]:NameTransformSymbol.AT,[NameTransformMap[NameTransformSymbol.HYPHEN]]:NameTransformSymbol.HYPHEN,[NameTransformMap[NameTransformSymbol.SLASH]]:NameTransformSymbol.SLASH},SEPARATOR=":",ManifestFileName="mf-manifest.json",StatsFileName="mf-stats.json",MFModuleType={NPM:"npm",APP:"app"},MODULE_DEVTOOL_IDENTIFIER="__MF_DEVTOOLS_MODULE_INFO__",ENCODE_NAME_PREFIX="ENCODE_NAME_PREFIX",TEMP_DIR=".federation",MFPrefetchCommon={identifier:"MFDataPrefetch",globalKey:"__PREFETCH__",library:"mf-data-prefetch",exportsKey:"__PREFETCH_EXPORTS__",fileName:"bootstrap.js"};var ContainerPlugin=Object.freeze({__proto__:null}),ContainerReferencePlugin=Object.freeze({__proto__:null}),ModuleFederationPlugin=Object.freeze({__proto__:null}),SharePlugin=Object.freeze({__proto__:null});function isBrowserEnv(){return"undefined"!=typeof window&&void 0!==window.document}function isReactNativeEnv(){var e;return"undefined"!=typeof navigator&&(null==(e=navigator)?void 0:e.product)==="ReactNative"}function isBrowserDebug(){try{if(isBrowserEnv()&&window.localStorage)return!!localStorage.getItem(BROWSER_LOG_KEY)}catch(e){}return!1}function isDebugMode(){return"undefined"!=typeof process&&process.env&&process.env.FEDERATION_DEBUG?!!process.env.FEDERATION_DEBUG:!!("undefined"!=typeof FEDERATION_DEBUG&&FEDERATION_DEBUG)||isBrowserDebug()}let getProcessEnv=function(){return"undefined"!=typeof process&&process.env?process.env:{}},LOG_CATEGORY="[ Federation Runtime ]",parseEntry=(e,t,n=SEPARATOR)=>{let r=e.split(n),i="development"===getProcessEnv().NODE_ENV&&t,o="*",s=e=>e.startsWith("http")||e.includes(MANIFEST_EXT);if(r.length>=2){let[t,...a]=r;e.startsWith(n)&&(t=r.slice(0,2).join(n),a=[i||r.slice(2).join(n)]);let l=i||a.join(n);return s(l)?{name:t,entry:l}:{name:t,version:l||o}}if(1===r.length){let[e]=r;return i&&s(i)?{name:e,entry:i}:{name:e,version:i||o}}throw`Invalid entry value: ${e}`},composeKeyWithSeparator=function(...e){return e.length?e.reduce((e,t)=>t?e?`${e}${SEPARATOR}${t}`:t:e,""):""},encodeName=function(e,t="",n=!1){try{let r=n?".js":"";return`${t}${e.replace(RegExp(`${NameTransformSymbol.AT}`,"g"),NameTransformMap[NameTransformSymbol.AT]).replace(RegExp(`${NameTransformSymbol.HYPHEN}`,"g"),NameTransformMap[NameTransformSymbol.HYPHEN]).replace(RegExp(`${NameTransformSymbol.SLASH}`,"g"),NameTransformMap[NameTransformSymbol.SLASH])}${r}`}catch(e){throw e}},decodeName=function(e,t,n){try{let r=e;if(t){if(!r.startsWith(t))return r;r=r.replace(RegExp(t,"g"),"")}return r=r.replace(RegExp(`${NameTransformMap[NameTransformSymbol.AT]}`,"g"),EncodedNameTransformMap[NameTransformMap[NameTransformSymbol.AT]]).replace(RegExp(`${NameTransformMap[NameTransformSymbol.SLASH]}`,"g"),EncodedNameTransformMap[NameTransformMap[NameTransformSymbol.SLASH]]).replace(RegExp(`${NameTransformMap[NameTransformSymbol.HYPHEN]}`,"g"),EncodedNameTransformMap[NameTransformMap[NameTransformSymbol.HYPHEN]]),n&&(r=r.replace(".js","")),r}catch(e){throw e}},generateExposeFilename=(e,t)=>{if(!e)return"";let n=e;return"."===n&&(n="default_export"),n.startsWith("./")&&(n=n.replace("./","")),encodeName(n,"__federation_expose_",t)},generateShareFilename=(e,t)=>e?encodeName(e,"__federation_shared_",t):"",getResourceUrl=(e,t)=>{if("getPublicPath"in e){let n;return n=e.getPublicPath.startsWith("function")?Function("return "+e.getPublicPath)()():Function(e.getPublicPath)(),`${n}${t}`}return"publicPath"in e?!isBrowserEnv()&&!isReactNativeEnv()&&"ssrPublicPath"in e?`${e.ssrPublicPath}${t}`:`${e.publicPath}${t}`:(console.warn("Cannot get resource URL. If in debug mode, please ignore.",e,t),"")},assert=(e,t)=>{e||error(t)},error=e=>{throw Error(`${LOG_CATEGORY}: ${e}`)},warn=e=>{console.warn(`${LOG_CATEGORY}: ${e}`)};function safeToString(e){try{return JSON.stringify(e,null,2)}catch(e){return""}}let VERSION_PATTERN_REGEXP=/^([\d^=v<>~]|[*xX]$)/;function isRequiredVersion(e){return VERSION_PATTERN_REGEXP.test(e)}let simpleJoinRemoteEntry=(e,t)=>{if(!e)return t;let n=(e=>{if("."===e)return"";if(e.startsWith("./"))return e.replace("./","");if(e.startsWith("/")){let t=e.slice(1);return t.endsWith("/")?t.slice(0,-1):t}return e})(e);return n?n.endsWith("/")?`${n}${t}`:`${n}/${t}`:t};function inferAutoPublicPath(e){return e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/")}function generateSnapshotFromManifest(e,t={}){var n,r,i;let o,{remotes:s={},overrides:a={},version:l}=t,u=()=>"publicPath"in e.metaData?"auto"===e.metaData.publicPath&&l?inferAutoPublicPath(l):e.metaData.publicPath:e.metaData.getPublicPath,c=Object.keys(a),h={};Object.keys(s).length||(h=(null==(i=e.remotes)?void 0:i.reduce((e,t)=>{let n,r=t.federationContainerName;return n=c.includes(r)?a[r]:"version"in t?t.version:t.entry,e[r]={matchedVersion:n},e},{}))||{}),Object.keys(s).forEach(e=>h[e]={matchedVersion:c.includes(e)?a[e]:s[e]});let{remoteEntry:{path:d,name:f,type:p},types:m,buildInfo:{buildVersion:g},globalName:y,ssrRemoteEntry:_}=e.metaData,{exposes:v}=e,b={version:l||"",buildVersion:g,globalName:y,remoteEntry:simpleJoinRemoteEntry(d,f),remoteEntryType:p,remoteTypes:simpleJoinRemoteEntry(m.path,m.name),remoteTypesZip:m.zip||"",remoteTypesAPI:m.api||"",remotesInfo:h,shared:null==e?void 0:e.shared.map(e=>({assets:e.assets,sharedName:e.name,version:e.version})),modules:null==v?void 0:v.map(e=>({moduleName:e.name,modulePath:e.path,assets:e.assets}))};if(null==(n=e.metaData)?void 0:n.prefetchInterface){let t=e.metaData.prefetchInterface;b=polyfills._({},b,{prefetchInterface:t})}if(null==(r=e.metaData)?void 0:r.prefetchEntry){let{path:t,name:n,type:r}=e.metaData.prefetchEntry;b=polyfills._({},b,{prefetchEntry:simpleJoinRemoteEntry(t,n),prefetchEntryType:r})}return o="publicPath"in e.metaData?polyfills._({},b,{publicPath:u(),ssrPublicPath:e.metaData.ssrPublicPath}):polyfills._({},b,{getPublicPath:u()}),_&&(o.ssrRemoteEntry=simpleJoinRemoteEntry(_.path,_.name),o.ssrRemoteEntryType=_.type||"commonjs-module"),o}function isManifestProvider(e){return!!("remoteEntry"in e&&e.remoteEntry.includes(MANIFEST_EXT))}let PREFIX="[ Module Federation ]",Logger=class{setPrefix(e){this.prefix=e}log(...e){console.log(this.prefix,...e)}warn(...e){console.log(this.prefix,...e)}error(...e){console.log(this.prefix,...e)}success(...e){console.log(this.prefix,...e)}info(...e){console.log(this.prefix,...e)}ready(...e){console.log(this.prefix,...e)}debug(...e){isDebugMode()&&console.log(this.prefix,...e)}constructor(e){this.prefix=e}};function createLogger(e){return new Logger(e)}let logger=createLogger(PREFIX);async function safeWrapper(e,t){try{return await e()}catch(e){t||warn(e);return}}function isStaticResourcesEqual(e,t){let n=/^(https?:)?\/\//i;return e.replace(n,"").replace(/\/$/,"")===t.replace(n,"").replace(/\/$/,"")}function createScript(e){let t,n=null,r=!0,i=2e4,o=document.getElementsByTagName("script");for(let t=0;t<o.length;t++){let i=o[t],s=i.getAttribute("src");if(s&&isStaticResourcesEqual(s,e.url)){n=i,r=!1;break}}if(!n){let t,r=e.attrs;(n=document.createElement("script")).type=(null==r?void 0:r.type)==="module"?"module":"text/javascript",e.createScriptHook&&((t=e.createScriptHook(e.url,e.attrs))instanceof HTMLScriptElement?n=t:"object"==typeof t&&("script"in t&&t.script&&(n=t.script),"timeout"in t&&t.timeout&&(i=t.timeout))),n.src||(n.src=e.url),r&&!t&&Object.keys(r).forEach(e=>{n&&("async"===e||"defer"===e?n[e]=r[e]:n.getAttribute(e)||n.setAttribute(e,r[e]))})}let s=async(r,i)=>{clearTimeout(t);let o=()=>{(null==i?void 0:i.type)==="error"?(null==e?void 0:e.onErrorCallback)&&(null==e||e.onErrorCallback(i)):(null==e?void 0:e.cb)&&(null==e||e.cb())};if(n&&(n.onerror=null,n.onload=null,safeWrapper(()=>{let{needDeleteScript:t=!0}=e;t&&(null==n?void 0:n.parentNode)&&n.parentNode.removeChild(n)}),r&&"function"==typeof r)){let e=r(i);if(e instanceof Promise){let t=await e;return o(),t}return o(),e}o()};return n.onerror=s.bind(null,n.onerror),n.onload=s.bind(null,n.onload),t=setTimeout(()=>{s(null,Error(`Remote script "${e.url}" time-outed.`))},i),{script:n,needAttach:r}}function createLink(e){let t=null,n=!0,r=document.getElementsByTagName("link");for(let i=0;i<r.length;i++){let o=r[i],s=o.getAttribute("href"),a=o.getAttribute("rel");if(s&&isStaticResourcesEqual(s,e.url)&&a===e.attrs.rel){t=o,n=!1;break}}if(!t){let n;(t=document.createElement("link")).setAttribute("href",e.url);let r=e.attrs;e.createLinkHook&&(n=e.createLinkHook(e.url,r))instanceof HTMLLinkElement&&(t=n),r&&!n&&Object.keys(r).forEach(e=>{t&&!t.getAttribute(e)&&t.setAttribute(e,r[e])})}let i=(n,r)=>{let i=()=>{(null==r?void 0:r.type)==="error"?(null==e?void 0:e.onErrorCallback)&&(null==e||e.onErrorCallback(r)):(null==e?void 0:e.cb)&&(null==e||e.cb())};if(t&&(t.onerror=null,t.onload=null,safeWrapper(()=>{let{needDeleteLink:n=!0}=e;n&&(null==t?void 0:t.parentNode)&&t.parentNode.removeChild(t)}),n)){let e=n(r);return i(),e}i()};return t.onerror=i.bind(null,t.onerror),t.onload=i.bind(null,t.onload),{link:t,needAttach:n}}function loadScript(e,t){let{attrs:n={},createScriptHook:r}=t;return new Promise((t,i)=>{let{script:o,needAttach:s}=createScript({url:e,cb:t,onErrorCallback:i,attrs:polyfills._({fetchpriority:"high"},n),createScriptHook:r,needDeleteScript:!0});s&&document.head.appendChild(o)})}function importNodeModule(e){if(!e)throw Error("import specifier is required");return Function("name","return import(name)")(e).then(e=>e).catch(t=>{throw console.error(`Error importing module ${e}:`,t),t})}let loadNodeFetch=async()=>{let e=await importNodeModule("node-fetch");return e.default||e},lazyLoaderHookFetch=async(e,t,n)=>{let r=(e,t)=>n.lifecycle.fetch.emit(e,t),i=await r(e,t||{});return i&&i instanceof Response?i:("undefined"==typeof fetch?await loadNodeFetch():fetch)(e,t||{})},createScriptNode="undefined"==typeof ENV_TARGET||"web"!==ENV_TARGET?(url,cb,attrs,loaderHook)=>{let urlObj;if(null==loaderHook?void 0:loaderHook.createScriptHook){let hookResult=loaderHook.createScriptHook(url);hookResult&&"object"==typeof hookResult&&"url"in hookResult&&(url=hookResult.url)}try{urlObj=new URL(url)}catch(e){console.error("Error constructing URL:",e),cb(Error(`Invalid URL: ${e}`));return}let getFetch=async()=>(null==loaderHook?void 0:loaderHook.fetch)?(e,t)=>lazyLoaderHookFetch(e,t,loaderHook):"undefined"==typeof fetch?loadNodeFetch():fetch,handleScriptFetch=async(f,urlObj)=>{try{var _vm_constants,_vm_constants_USE_MAIN_CONTEXT_DEFAULT_LOADER;let res=await f(urlObj.href),data=await res.text(),[path,vm]=await Promise.all([importNodeModule("path"),importNodeModule("vm")]),scriptContext={exports:{},module:{exports:{}}},urlDirname=urlObj.pathname.split("/").slice(0,-1).join("/"),filename=path.basename(urlObj.pathname),script=new vm.Script(`(function(exports, module, require, __dirname, __filename) {${data}
})`,{filename,importModuleDynamically:null!=(_vm_constants_USE_MAIN_CONTEXT_DEFAULT_LOADER=null==(_vm_constants=vm.constants)?void 0:_vm_constants.USE_MAIN_CONTEXT_DEFAULT_LOADER)?_vm_constants_USE_MAIN_CONTEXT_DEFAULT_LOADER:importNodeModule});script.runInThisContext()(scriptContext.exports,scriptContext.module,eval("require"),urlDirname,filename);let exportedInterface=scriptContext.module.exports||scriptContext.exports;if(attrs&&exportedInterface&&attrs.globalName){let container=exportedInterface[attrs.globalName]||exportedInterface;cb(void 0,container);return}cb(void 0,exportedInterface)}catch(e){cb(e instanceof Error?e:Error(`Script execution error: ${e}`))}};getFetch().then(async e=>{if((null==attrs?void 0:attrs.type)==="esm"||(null==attrs?void 0:attrs.type)==="module")return loadModule(urlObj.href,{fetch:e,vm:await importNodeModule("vm")}).then(async e=>{await e.evaluate(),cb(void 0,e.namespace)}).catch(e=>{cb(e instanceof Error?e:Error(`Script execution error: ${e}`))});handleScriptFetch(e,urlObj)}).catch(e=>{cb(e)})}:(e,t,n,r)=>{t(Error("createScriptNode is disabled in non-Node.js environment"))},loadScriptNode="undefined"==typeof ENV_TARGET||"web"!==ENV_TARGET?(e,t)=>new Promise((n,r)=>{createScriptNode(e,(e,i)=>{if(e)r(e);else{var o,s;let e=(null==t||null==(o=t.attrs)?void 0:o.globalName)||`__FEDERATION_${null==t||null==(s=t.attrs)?void 0:s.name}:custom__`;n(globalThis[e]=i)}},t.attrs,t.loaderHook)}):(e,t)=>{throw Error("loadScriptNode is disabled in non-Node.js environment")};async function loadModule(e,t){let{fetch:n,vm:r}=t,i=await n(e),o=await i.text(),s=new r.SourceTextModule(o,{importModuleDynamically:async(n,r)=>loadModule(new URL(n,e).href,t)});return await s.link(async n=>{let r=new URL(n,e).href;return await loadModule(r,t)}),s}function normalizeOptions(e,t,n){return function(r){if(!1===r)return!1;if(void 0===r)if(e)return t;else return!1;if(!0===r)return t;if(r&&"object"==typeof r)return polyfills._({},t,r);throw Error(`Unexpected type for \`${n}\`, expect boolean/undefined/object, got: ${typeof r}`)}}let createModuleFederationConfig=e=>e;exports.BROWSER_LOG_KEY=BROWSER_LOG_KEY,exports.ENCODE_NAME_PREFIX=ENCODE_NAME_PREFIX,exports.EncodedNameTransformMap=EncodedNameTransformMap,exports.FederationModuleManifest=FederationModuleManifest,exports.MANIFEST_EXT=MANIFEST_EXT,exports.MFModuleType=MFModuleType,exports.MFPrefetchCommon=MFPrefetchCommon,exports.MODULE_DEVTOOL_IDENTIFIER=MODULE_DEVTOOL_IDENTIFIER,exports.ManifestFileName=ManifestFileName,exports.NameTransformMap=NameTransformMap,exports.NameTransformSymbol=NameTransformSymbol,exports.SEPARATOR=SEPARATOR,exports.StatsFileName=StatsFileName,exports.TEMP_DIR=TEMP_DIR,exports.assert=assert,exports.composeKeyWithSeparator=composeKeyWithSeparator,exports.containerPlugin=ContainerPlugin,exports.containerReferencePlugin=ContainerReferencePlugin,exports.createLink=createLink,exports.createLogger=createLogger,exports.createModuleFederationConfig=createModuleFederationConfig,exports.createScript=createScript,exports.createScriptNode=createScriptNode,exports.decodeName=decodeName,exports.encodeName=encodeName,exports.error=error,exports.generateExposeFilename=generateExposeFilename,exports.generateShareFilename=generateShareFilename,exports.generateSnapshotFromManifest=generateSnapshotFromManifest,exports.getProcessEnv=getProcessEnv,exports.getResourceUrl=getResourceUrl,exports.inferAutoPublicPath=inferAutoPublicPath,exports.isBrowserEnv=isBrowserEnv,exports.isDebugMode=isDebugMode,exports.isManifestProvider=isManifestProvider,exports.isReactNativeEnv=isReactNativeEnv,exports.isRequiredVersion=isRequiredVersion,exports.isStaticResourcesEqual=isStaticResourcesEqual,exports.loadScript=loadScript,exports.loadScriptNode=loadScriptNode,exports.logger=logger,exports.moduleFederationPlugin=ModuleFederationPlugin,exports.normalizeOptions=normalizeOptions,exports.parseEntry=parseEntry,exports.safeToString=safeToString,exports.safeWrapper=safeWrapper,exports.sharePlugin=SharePlugin,exports.simpleJoinRemoteEntry=simpleJoinRemoteEntry,exports.warn=warn},9232:function(e,t){function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}t._=n},7258:function(e,t){t.FEDERATION_SUPPORTED_TYPES=["script"]},2446:function(e,t,n){var r=n(2676),i=n(7258),o=n(36);function s(e){e.S&&!e.federation.hasAttachShareScopeMap&&e.federation.instance&&e.federation.instance.shareScopeMap&&(e.S=e.federation.instance.shareScopeMap,e.federation.hasAttachShareScopeMap=!0)}function a(e){let{chunkId:t,promises:n,chunkMapping:r,idToExternalAndNameMapping:a,webpackRequire:l,idToRemoteMap:u}=e;s(l),l.o(r,t)&&r[t].forEach(e=>{let t=l.R;t||(t=[]);let r=a[e],s=u[e];if(t.indexOf(r)>=0)return;if(t.push(r),r.p)return n.push(r.p);let c=t=>{t||(t=Error("Container missing")),"string"==typeof t.message&&(t.message+=`
while loading "${r[1]}" from ${r[2]}`),l.m[e]=()=>{throw t},r.p=0},h=(e,t,i,o,s,a)=>{try{let l=e(t,i);if(!l||!l.then)return s(l,o,a);{let e=l.then(e=>s(e,o),c);if(!a)return e;n.push(r.p=e)}}catch(e){c(e)}},d=(e,t,n)=>e?h(l.I,r[0],0,e,f,n):c();var f=(e,n,i)=>h(n.get,r[1],t,0,p,i),p=t=>{r.p=1,l.m[e]=e=>{e.exports=t()}};let m=()=>{try{let e=o.decodeName(s[0].name,o.ENCODE_NAME_PREFIX)+r[1].slice(1),t=l.federation.instance,n=()=>l.federation.instance.loadRemote(e,{loadFactory:!1,from:"build"});if("version-first"===t.options.shareStrategy)return Promise.all(t.sharedHandler.initializeSharing(r[0])).then(()=>n());return n()}catch(e){c(e)}};1===s.length&&i.FEDERATION_SUPPORTED_TYPES.includes(s[0].externalType)&&s[0].name?h(m,r[2],0,0,p,1):h(l,r[2],0,0,d,1)})}function l(e){let{chunkId:t,promises:n,chunkMapping:r,installedModules:i,moduleToHandlerMapping:o,webpackRequire:a}=e;s(a),a.o(r,t)&&r[t].forEach(e=>{if(a.o(i,e))return n.push(i[e]);let t=t=>{i[e]=0,a.m[e]=n=>{delete a.c[e],n.exports=t()}},r=t=>{delete i[e],a.m[e]=n=>{throw delete a.c[e],t}};try{let s=a.federation.instance;if(!s)throw Error("Federation instance not found!");let{shareKey:l,getter:u,shareInfo:c}=o[e],h=s.loadShare(l,{customShareInfo:c}).then(e=>!1===e?u():e);h.then?n.push(i[e]=h.then(t).catch(r)):t(h)}catch(e){r(e)}})}function u({shareScopeName:e,webpackRequire:t,initPromises:n,initTokens:r,initScope:o}){let a=Array.isArray(e)?e:[e];var l=[],u=function(a){o||(o=[]);let l=t.federation.instance;var u=r[a];if(u||(u=r[a]={from:l.name}),o.indexOf(u)>=0)return;o.push(u);let c=n[a];if(c)return c;var h=e=>"undefined"!=typeof console&&console.warn&&console.warn(e),d=n=>{var r=e=>h("Initialization of sharing external failed: "+e);try{var i=t(n);if(!i)return;var s=n=>n&&n.init&&n.init(t.S[a],o,{shareScopeMap:t.S||{},shareScopeKeys:e});if(i.then)return f.push(i.then(s,r));var l=s(i);if(l&&"boolean"!=typeof l&&l.then)return f.push(l.catch(r))}catch(e){r(e)}};let f=l.initializeSharing(a,{strategy:l.options.shareStrategy,initScope:o,from:"build"});s(t);let p=t.federation.bundlerRuntimeOptions.remotes;return(p&&Object.keys(p.idToRemoteMap).forEach(e=>{let t=p.idToRemoteMap[e],n=p.idToExternalAndNameMapping[e][2];if(t.length>1)d(n);else if(1===t.length){let e=t[0];i.FEDERATION_SUPPORTED_TYPES.includes(e.externalType)||d(n)}}),f.length)?n[a]=Promise.all(f).then(()=>n[a]=!0):n[a]=!0};return a.forEach(e=>{l.push(u(e))}),Promise.all(l).then(()=>!0)}function c(e){let{moduleId:t,moduleToHandlerMapping:n,webpackRequire:r}=e,i=r.federation.instance;if(!i)throw Error("Federation instance not found!");let{shareKey:o,shareInfo:s}=n[t];try{return i.loadShareSync(o,{customShareInfo:s})}catch(e){throw console.error('loadShareSync failed! The function should not be called unless you set "eager:true". If you do not set it, and encounter this issue, you can check whether an async boundary is implemented.'),console.error("The original error message is as follows: "),e}}function h(e){let{moduleToHandlerMapping:t,webpackRequire:n,installedModules:r,initialConsumes:i}=e;i.forEach(e=>{n.m[e]=i=>{r[e]=0,delete n.c[e];let o=c({moduleId:e,moduleToHandlerMapping:t,webpackRequire:n});if("function"!=typeof o)throw Error(`Shared module is not available for eager consumption: ${e}`);i.exports=o()}})}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function f(e){let{webpackRequire:t,shareScope:n,initScope:r,shareScopeKey:i,remoteEntryInitOptions:o}=e;if(!t.S||!t.federation||!t.federation.instance||!t.federation.initOptions)return;let s=t.federation.instance;s.initOptions(d({name:t.federation.initOptions.name,remotes:[]},o));let a=null==o?void 0:o.shareScopeKeys,l=null==o?void 0:o.shareScopeMap;if(i&&"string"!=typeof i)i.forEach(e=>{if(!a||!l)return void s.initShareScopeMap(e,n,{hostShareScopeMap:(null==o?void 0:o.shareScopeMap)||{}});l[e]||(l[e]={});let t=l[e];s.initShareScopeMap(e,t,{hostShareScopeMap:(null==o?void 0:o.shareScopeMap)||{}})});else{let e=i||"default";Array.isArray(a)?a.forEach(e=>{l[e]||(l[e]={});let t=l[e];s.initShareScopeMap(e,t,{hostShareScopeMap:(null==o?void 0:o.shareScopeMap)||{}})}):s.initShareScopeMap(e,n,{hostShareScopeMap:(null==o?void 0:o.shareScopeMap)||{}})}return(t.federation.attachShareScopeMap&&t.federation.attachShareScopeMap(t),"function"==typeof t.federation.prefetch&&t.federation.prefetch(),Array.isArray(i))?t.federation.initOptions.shared?t.I(i,r):Promise.all(i.map(e=>t.I(e,r))).then(()=>!0):t.I(i||"default",r)}e.exports={runtime:function(e){var t=Object.create(null);if(e)for(var n in e)t[n]=e[n];return t.default=e,Object.freeze(t)}(r),instance:void 0,initOptions:void 0,bundlerRuntime:{remotes:a,consumes:l,I:u,S:{},installInitialConsumes:h,initContainerEntry:f},attachShareScopeMap:s,bundlerRuntimeOptions:{}}},2201:function(e,t,n){n.d(t,{Nu:()=>_});var r=n(3955),i=n(4399),o=n(8219);function s(e,t={}){let n,r=e?.pipeThrough(new TextDecoderStream).pipeThrough(new EventDecoderStream),i=r?.getReader(),o=!1;return new AsyncIteratorClass(async()=>{n??=startSpan("consume_event_iterator_stream");try{for(;;){if(void 0===i)return{done:!0,value:void 0};let{done:e,value:t}=await runInSpanContext(n,()=>i.read());if(e){if(o)throw new AbortError("Stream was cancelled");return{done:!0,value:void 0}}switch(t.event){case"message":{let e=parseEmptyableJSON(t.data);return isTypescriptObject(e)&&(e=withEventMeta(e,t)),n?.addEvent("message"),{done:!1,value:e}}case"error":{let e=new ErrorEvent({data:parseEmptyableJSON(t.data)});throw e=withEventMeta(e,t),n?.addEvent("error"),e}case"done":{let e=parseEmptyableJSON(t.data);return isTypescriptObject(e)&&(e=withEventMeta(e,t)),n?.addEvent("done"),{done:!0,value:e}}default:n?.addEvent("maybe_keepalive")}}}catch(e){throw e instanceof ErrorEvent||setSpanError(n,e,t),e}},async e=>{try{"next"!==e&&(o=!0,n?.addEvent("cancelled")),await runInSpanContext(n,()=>i?.cancel())}catch(e){throw setSpanError(n,e,t),e}finally{n?.end()}})}function a(e,t={}){let n,r,i=t.eventIteratorKeepAliveEnabled??!0,o=t.eventIteratorKeepAliveInterval??5e3,s=t.eventIteratorKeepAliveComment??"",l=!1;return new ReadableStream({start(){r=startSpan("stream_event_iterator")},async pull(t){try{i&&(n=setInterval(()=>{t.enqueue(encodeEventMessage({comments:[s]})),r?.addEvent("keepalive")},o));let a=await runInSpanContext(r,()=>e.next());if(clearInterval(n),l)return;let u=getEventMeta(a.value);if(!a.done||void 0!==a.value||void 0!==u){let e=a.done?"done":"message";t.enqueue(encodeEventMessage({...u,event:e,data:stringifyJSON(a.value)})),r?.addEvent(e)}a.done&&(t.close(),r?.end())}catch(e){if(clearInterval(n),l)return;e instanceof ErrorEvent?(t.enqueue(encodeEventMessage({...getEventMeta(e),event:"error",data:stringifyJSON(e.data)})),r?.addEvent("error"),t.close()):(setSpanError(r,e),t.error(e)),r?.end()}},async cancel(){try{l=!0,clearInterval(n),r?.addEvent("cancelled"),await runInSpanContext(r,()=>e.return?.())}catch(e){throw setSpanError(r,e),e}finally{r?.end()}}}).pipeThrough(new TextEncoderStream)}function l(e,t={}){return e.forEach((e,n)=>{Array.isArray(t[n])?t[n].push(e):void 0!==t[n]?t[n]=[t[n],e]:t[n]=e}),t}class u{plugins;constructor(e=[]){this.plugins=[...e].sort((e,t)=>(e.order??0)-(t.order??0))}init(e){for(let t of this.plugins)t.init?.(e)}}let c=0,h=1,d=2,f=3,p=4,m=5,g=6,y=7;class _{customSerializers;constructor(e={}){if(this.customSerializers=e.customJsonSerializers??[],this.customSerializers.length!==new Set(this.customSerializers.map(e=>e.type)).size)throw Error("Custom serializer type must be unique.")}serialize(e,t=[],n=[],i=[],o=[]){for(let r of this.customSerializers)if(r.condition(e)){let s=this.serialize(r.serialize(e),t,n,i,o);return n.push([r.type,...t]),s}if(e instanceof Blob)return i.push(t),o.push(e),[e,n,i,o];if("bigint"==typeof e)return n.push([c,...t]),[e.toString(),n,i,o];if(e instanceof Date)return(n.push([h,...t]),Number.isNaN(e.getTime()))?[null,n,i,o]:[e.toISOString(),n,i,o];if(Number.isNaN(e))return n.push([d,...t]),[null,n,i,o];if(e instanceof URL)return n.push([p,...t]),[e.toString(),n,i,o];if(e instanceof RegExp)return n.push([m,...t]),[e.toString(),n,i,o];if(e instanceof Set){let r=this.serialize(Array.from(e),t,n,i,o);return n.push([g,...t]),r}if(e instanceof Map){let r=this.serialize(Array.from(e.entries()),t,n,i,o);return n.push([y,...t]),r}if(Array.isArray(e))return[e.map((e,r)=>void 0===e?(n.push([f,...t,r]),e):this.serialize(e,[...t,r],n,i,o)[0]),n,i,o];if((0,r.Gv)(e)){let r={};for(let s in e)("toJSON"!==s||"function"!=typeof e[s])&&(r[s]=this.serialize(e[s],[...t,s],n,i,o)[0]);return[r,n,i,o]}return[e,n,i,o]}deserialize(e,t,n,r){let i={data:e};for(let e of(n&&r&&n.forEach((e,t)=>{let n=i,o="data";e.forEach(e=>{n=n[o],o=e}),n[o]=r(t)}),t)){let t=e[0],n=i,r="data";for(let t=1;t<e.length;t++)n=n[r],r=e[t];for(let e of this.customSerializers)if(e.type===t){n[r]=e.deserialize(n[r]);break}switch(t){case c:n[r]=BigInt(n[r]);break;case h:n[r]=new Date(n[r]??"Invalid Date");break;case d:n[r]=NaN;break;case f:n[r]=void 0;break;case p:n[r]=new URL(n[r]);break;case m:{let[,e,t]=n[r].match(/^\/(.*)\/([a-z]*)$/);n[r]=new RegExp(e,t);break}case g:n[r]=new Set(n[r]);break;case y:n[r]=new Map(n[r])}}return i.data}}function v(e){return`/${e.map(encodeURIComponent).join("/")}`}function b(e){return"function"==typeof e.forEach?l(e):e}function w(e){return Object.entries(o.C).find(([,t])=>t.status===e)?.[0]??"MALFORMED_ORPC_ERROR_RESPONSE"}},8219:function(e,t,n){n.d(t,{C:()=>a,c:()=>d,d:()=>m,e:()=>g,f:()=>l,g:()=>y,i:()=>f,m:()=>_,t:()=>p});var r=n(3955),i=n(4399);let o="@orpc/client",s="1.10.0",a={BAD_REQUEST:{status:400,message:"Bad Request"},UNAUTHORIZED:{status:401,message:"Unauthorized"},FORBIDDEN:{status:403,message:"Forbidden"},NOT_FOUND:{status:404,message:"Not Found"},METHOD_NOT_SUPPORTED:{status:405,message:"Method Not Supported"},NOT_ACCEPTABLE:{status:406,message:"Not Acceptable"},TIMEOUT:{status:408,message:"Request Timeout"},CONFLICT:{status:409,message:"Conflict"},PRECONDITION_FAILED:{status:412,message:"Precondition Failed"},PAYLOAD_TOO_LARGE:{status:413,message:"Payload Too Large"},UNSUPPORTED_MEDIA_TYPE:{status:415,message:"Unsupported Media Type"},UNPROCESSABLE_CONTENT:{status:422,message:"Unprocessable Content"},TOO_MANY_REQUESTS:{status:429,message:"Too Many Requests"},CLIENT_CLOSED_REQUEST:{status:499,message:"Client Closed Request"},INTERNAL_SERVER_ERROR:{status:500,message:"Internal Server Error"},NOT_IMPLEMENTED:{status:501,message:"Not Implemented"},BAD_GATEWAY:{status:502,message:"Bad Gateway"},SERVICE_UNAVAILABLE:{status:503,message:"Service Unavailable"},GATEWAY_TIMEOUT:{status:504,message:"Gateway Timeout"}};function l(e,t){return t??a[e]?.status??500}function u(e,t){return t||a[e]?.message||e}let c=Symbol.for(`__${o}@${s}/error/ORPC_ERROR_CONSTRUCTORS__`);globalThis[c]??=new WeakSet;let h=globalThis[c];class d extends Error{defined;code;status;data;constructor(e,...t){const n=(0,r.$Z)(t);if(void 0!==n.status&&!m(n.status))throw Error("[ORPCError] Invalid error status code.");super(u(e,n.message),n),this.code=e,this.status=l(e,n.status),this.defined=n.defined??!1,this.data=n.data}toJSON(){return{defined:this.defined,code:this.code,status:this.status,message:this.message,data:this.data}}static[Symbol.hasInstance](e){if(h.has(this)){let t=(0,r.z9)(e);if(t&&h.has(t))return!0}return super[Symbol.hasInstance](e)}}function f(e){return e instanceof d&&e.defined}function p(e){return e instanceof d?e:new d("INTERNAL_SERVER_ERROR",{message:"Internal server error",cause:e})}function m(e){return e<200||e>=400}function g(e){if(!(0,r.Gv)(e))return!1;let t=["defined","code","status","message","data"];return!Object.keys(e).some(e=>!t.includes(e))&&"defined"in e&&"boolean"==typeof e.defined&&"code"in e&&"string"==typeof e.code&&"status"in e&&"number"==typeof e.status&&m(e.status)&&"message"in e&&"string"==typeof e.message}function y(e,t={}){return new d(e.code,{...t,...e})}function _(e,t){let n=async e=>{let n=await t.error(e);if(n!==e){let t=(0,i.Kg)(e);t&&(0,r.fb)(n)&&(n=(0,i.c8)(n,t))}return n};return new r.Nz(async()=>{let{done:o,value:s}=await (async()=>{try{return await e.next()}catch(e){throw await n(e)}})(),a=await t.value(s,o);if(a!==s){let e=(0,i.Kg)(s);e&&(0,r.fb)(a)&&(a=(0,i.c8)(a,e))}return{done:o,value:a}},async()=>{try{await e.return?.()}catch(e){throw await n(e)}})}h.add(d)},9297:function(e,t,n){n(2201),n(3955),n(4399),n(845).P},7101:function(e,t,n){n(3955),n(4399),n(845).P},9644:function(e,t,n){n(2201),n(3955),n(4399),n(845).P},8607:function(e,t,n){n(845),n(3955)},845:function(e,t,n){n.d(t,{P:()=>i});var r=n(3955);class i{maxBufferedEvents;constructor(e={}){this.maxBufferedEvents=e.maxBufferedEvents??100}subscribe(e,t,n){let i;if("function"==typeof t)return this.subscribeListener(e,t,n);let o=t?.signal,s=t?.maxBufferedEvents??this.maxBufferedEvents;o?.throwIfAborted();let a=[],l=[],u=this.subscribe(e,e=>{let t=l.shift();t?t[0]({done:!1,value:e}):(a.push(e),a.length>s&&a.shift())},{lastEventId:t?.lastEventId,onError:e=>{i={error:e},l.forEach(t=>t[1](e)),o?.removeEventListener("abort",c),l.length=0,a.length=0,u.then(e=>e()).catch(()=>{})}});function c(e){l.forEach(t=>t[1](e.target.reason)),l.length=0,a.length=0,u.then(e=>e()).catch(()=>{})}return o?.addEventListener("abort",c,{once:!0}),new r.Nz(async()=>{if(i)throw i.error;if(o?.aborted)throw o.reason;return(await u,a.length>0)?{done:!1,value:a.shift()}:new Promise((e,t)=>{l.push([e,t])})},async()=>{l.forEach(e=>e[0]({done:!0,value:void 0})),o?.removeEventListener("abort",c),l.length=0,a.length=0,await u.then(e=>e())})}}},3955:function(e,t,n){function r(e){return e[0]??{}}function i(e){return Array.isArray(e)?e:null==e?[]:[e]}n.d(t,{$Z:()=>r,$r:()=>i,DY:()=>R,ER:()=>G,Gv:()=>C,Jt:()=>j,L_:()=>O,Np:()=>q,Nz:()=>E,Oo:()=>u,S5:()=>N,Ss:()=>I,Uq:()=>F,YU:()=>H,Zc:()=>T,_p:()=>v,ao:()=>x,e4:()=>P,eE:()=>f,fb:()=>D,hL:()=>L,mm:()=>B,np:()=>z,uj:()=>y,vC:()=>A,xC:()=>o,z9:()=>M,zL:()=>S,zh:()=>k});let o="orpc",s="@orpc/shared",a="1.10.0";class l extends Error{constructor(...e){super(...e),this.name="AbortError"}}function u(e){let t;return()=>{if(t)return t.result;let n=e();return t={result:n},n}}function c(e){let t=Promise.resolve();return(...n)=>t=t.catch(()=>{}).then(()=>e(...n))}let h=2,d=`__${s}@${a}/otel/config__`;function f(){return globalThis[d]}function p(e,t={},n){let r=f()?.tracer;return r?.startSpan(e,t,n)}function m(e,t,n={}){if(!e)return;let r=g(t);e.recordException(r),n.signal?.aborted&&n.signal.reason===t||e.setStatus({code:h,message:r.message})}function g(e){if(e instanceof Error){let t={message:e.message,name:e.name,stack:e.stack};return"code"in e&&("string"==typeof e.code||"number"==typeof e.code)&&(t.code=e.code),t}return{message:String(e)}}async function y({name:e,context:t,...n},r){let i=f()?.tracer;if(!i)return r();let o=async e=>{try{return await r(e)}catch(t){throw m(e,t,n),t}finally{e.end()}};return t?i.startActiveSpan(e,n,t,o):i.startActiveSpan(e,n,o)}async function _(e,t){let n=f();if(!e||!n)return t();let r=n.trace.setSpan(n.context.active(),e);return n.context.with(r,t)}function v(e){return!!e&&"object"==typeof e&&"next"in e&&"function"==typeof e.next&&Symbol.asyncIterator in e&&"function"==typeof e[Symbol.asyncIterator]}let b=Symbol.for("asyncDispose"),w=Symbol.asyncDispose??b;class E{#e=!1;#t=!1;#n;#r;constructor(e,t){this.#n=t,this.#r=c(async()=>{if(this.#e)return{done:!0,value:void 0};try{let t=await e();return t.done&&(this.#e=!0),t}catch(e){throw this.#e=!0,e}finally{this.#e&&!this.#t&&(this.#t=!0,await this.#n("next"))}})}next(){return this.#r()}async return(e){return this.#e=!0,this.#t||(this.#t=!0,await this.#n("return")),{done:!0,value:e}}async throw(e){throw this.#e=!0,this.#t||(this.#t=!0,await this.#n("throw")),e}async [w](){this.#e=!0,this.#t||(this.#t=!0,await this.#n("dispose"))}[Symbol.asyncIterator](){return this}}function S({name:e,...t},n){let r;return new E(async()=>{r??=p(e);try{let e=await _(r,()=>n.next());return r?.addEvent(e.done?"completed":"yielded"),e}catch(e){throw m(r,e,t),e}},async e=>{try{"next"!==e&&await _(r,()=>n.return?.())}catch(e){throw m(r,e,t),e}finally{r?.end()}})}class k{#i=new Map;#o;constructor(e={}){this.#o=e.maxBufferedEvents??100}get size(){return this.#i.size}publish(e,t){let n=this.#i.get(e);if(n)for(let e of n)e(t)}subscribe(e,t){if("function"==typeof t){let n=this.#i.get(e);return n||this.#i.set(e,n=[]),n.push(t),u(()=>{n.splice(n.indexOf(t),1),0===n.length&&this.#i.delete(e)})}let n=t?.signal,r=t?.maxBufferedEvents??this.#o;n?.throwIfAborted();let i=[],o=[],s=this.subscribe(e,e=>{let t=o.shift();t?t[0]({done:!1,value:e}):(i.push(e),i.length>r&&i.shift())}),a=e=>{s(),o.forEach(t=>t[1](e.target.reason)),o.length=0,i.length=0};return n?.addEventListener("abort",a,{once:!0}),new E(async()=>{if(n?.aborted)throw n.reason;return i.length>0?{done:!1,value:i.shift()}:new Promise((e,t)=>{o.push([e,t])})},async()=>{s(),n?.removeEventListener("abort",a),o.forEach(e=>e[0]({done:!0,value:void 0})),o.length=0,i.length=0})}}class I{index=BigInt(1);generate(){let e=this.index.toString(36);return this.index++,e}}function R(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:+(e>t)}function x(e){return async(t,...n)=>(await e(t,...n),await t.next())}function O(e){return async(t,...n)=>{let r=await t.next();return await e(r,t,...n),r}}function N(e){return async(t,...n)=>{try{return await t.next()}catch(r){throw await e(r,t,...n),r}}}function A(e){let t;return async(n,...r)=>{try{let e=await n.next();return t=[null,e,!0],e}catch(e){throw t=[e,void 0,!1],e}finally{await e(t,n,...r)}}}function T(e,t,n){let r=(t,i)=>{let o=e[i];return o?o({...t,next:(e=t)=>r(e,i+1)}):n(t)};return r(t,0)}function P(e){return JSON.stringify(e)}function M(e){return D(e)?Object.getPrototypeOf(e)?.constructor:null}function C(e){if(!e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||!t||!t.constructor}function D(e){return!!e&&("object"==typeof e||"function"==typeof e)}function $(e){if(Array.isArray(e))return e.map($);if(C(e)){let t={};for(let n in e)t[n]=$(e[n]);return t}return e}function j(e,t){let n=e;for(let e of t){if(!D(n))return;n=n[e]}return n}function L(e){let t=typeof e;return"string"===t||"number"===t||"symbol"===t}function F(e,...t){return"function"==typeof e?e(...t):e}function q(e,t){return void 0===e?t:e}let U=/^\s*function\s*\(\)\s*\{\s*\[native code\]\s*\}\s*$/;function z(e,t){return new Proxy("function"==typeof e?t:e,{get(n,r){let i=r in t?t:F(e),o=Reflect.get(i,r);return"function"==typeof o?o.bind(i):o},has:(n,r)=>Reflect.has(t,r)||Reflect.has(F(e),r)})}function H(e){let t=e.getReader();return new E(async()=>t.read(),async()=>{await t.cancel()})}function B(e){return new ReadableStream({async pull(t){let{done:n,value:r}=await e.next();n?t.close():t.enqueue(r)},async cancel(){await e.return?.()}})}function G(e){return new ReadableStream({async pull(t){let{done:n,value:r}=await e.next();if(n)t.close();else{let e=C(r)?{...r}:Array.isArray(r)?r.map(e=>e):r;t.enqueue(e)}},async cancel(){await e.return?.()}})}},4399:function(e,t,n){n.d(t,{Kg:()=>f,NN:()=>s,aw:()=>m,c8:()=>d,mJ:()=>p});var r=n(3955);class i extends TypeError{}class o extends TypeError{}class s extends Error{data;constructor(e){super(e?.message??"An error event was received",e),this.data=e?.data}}function a(e){let t=e.replace(/\n+$/,"").split(/\n/),n={data:void 0,event:void 0,id:void 0,retry:void 0,comments:[]};for(let e of t){let t=e.indexOf(":"),r=-1===t?e:e.slice(0,t),i=-1===t?"":e.slice(t+1).replace(/^\s/,"");if(0===t)n.comments.push(i);else if("data"===r)n.data??="",n.data+=`${i}
`;else if("event"===r)n.event=i;else if("id"===r)n.id=i;else if("retry"===r){let e=Number.parseInt(i);Number.isInteger(e)&&e>=0&&e.toString()===i&&(n.retry=e)}}return n.data=n.data?.replace(/\n$/,""),n}function l(e){if(e.includes("\n"))throw new i("Event's id must not contain a newline character")}function u(e){if(!Number.isInteger(e)||e<0)throw new i("Event's retry must be a integer and >= 0")}function c(e){if(e.includes("\n"))throw new i("Event's comment must not contain a newline character")}TransformStream;let h=Symbol("ORPC_EVENT_SOURCE_META");function d(e,t){if(void 0===t.id&&void 0===t.retry&&!t.comments?.length)return e;if(void 0!==t.id&&l(t.id),void 0!==t.retry&&u(t.retry),void 0!==t.comments)for(let e of t.comments)c(e);return new Proxy(e,{get:(e,n,r)=>n===h?t:Reflect.get(e,n,r)})}function f(e){return(0,r.fb)(e)?Reflect.get(e,h):void 0}class p extends r.Nz{hibernationCallback;constructor(e){super(async()=>{throw Error("Cannot iterate over hibernating iterator directly")},async e=>{if("next"!==e)throw Error("Cannot cleanup hibernating iterator directly")}),this.hibernationCallback=e}}function m(e,t){let n={...e};for(let e in t)Array.isArray(t[e])?n[e]=[...(0,r.$r)(n[e]),...t[e]]:void 0!==t[e]&&(Array.isArray(n[e])?n[e]=[...n[e],t[e]]:void 0!==n[e]?n[e]=[n[e],t[e]]:n[e]=t[e]);return n}},8946:function(e,t,n){n.d(t,{A:()=>eB});var r,i,o=9e15,s=1e9,a="0123456789abcdef",l="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",u="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",c={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:9e15,crypto:!1},h=!0,d="[DecimalError] ",f=d+"Invalid argument: ",p=d+"Precision limit exceeded",m=d+"crypto unavailable",g="[object Decimal]",y=Math.floor,_=Math.pow,v=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,b=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,w=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,E=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,S=1e7,k=7,I=0x1fffffffffffff,R=l.length-1,x=u.length-1,O={toStringTag:g};function N(e){var t,n,r,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)(n=k-(r=e[t]+"").length)&&(o+=U(n)),o+=r;(n=k-(r=(s=e[t])+"").length)&&(o+=U(n))}else if(0===s)return"0";for(;s%10==0;)s/=10;return o+s}function A(e,t,n){if(e!==~~e||e<t||e>n)throw Error(f+e)}function T(e,t,n,r){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=k,i=0):(i=Math.ceil((t+1)/k),t%=k),o=_(10,k-t),a=e[i]%o|0,null==r?t<3?(0==t?a=a/100|0:1==t&&(a=a/10|0),s=n<4&&99999==a||n>3&&49999==a||5e4==a||0==a):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(e[i+1]/o/100|0)==_(10,t-2)-1||(a==o/2||0==a)&&(e[i+1]/o/100|0)==0:t<4?(0==t?a=a/1e3|0:1==t?a=a/100|0:2==t&&(a=a/10|0),s=(r||n<4)&&9999==a||!r&&n>3&&4999==a):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==_(10,t-3)-1,s}function P(e,t,n){for(var r,i,o=[0],s=0,l=e.length;s<l;){for(i=o.length;i--;)o[i]*=t;for(o[0]+=a.indexOf(e.charAt(s++)),r=0;r<o.length;r++)o[r]>n-1&&(void 0===o[r+1]&&(o[r+1]=0),o[r+1]+=o[r]/n|0,o[r]%=n)}return o.reverse()}function M(e,t){var n,r,i;if(t.isZero())return t;(r=t.d.length)<32?i=(1/J(4,n=Math.ceil(r/3))).toString():(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=Q(e,1,t.times(i),new e(1));for(var o=n;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}O.absoluteValue=O.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),D(e)},O.ceil=function(){return D(new this.constructor(this),this.e+1,2)},O.clampedTo=O.clamp=function(e,t){var n=this,r=n.constructor;if(e=new r(e),t=new r(t),!e.s||!t.s)return new r(NaN);if(e.gt(t))throw Error(f+t);return 0>n.cmp(e)?e:n.cmp(t)>0?t:new r(n)},O.comparedTo=O.cmp=function(e){var t,n,r,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,l=o.s,u=e.s;if(!s||!a)return l&&u?l!==u?l:s===a?0:!s^l<0?1:-1:NaN;if(!s[0]||!a[0])return s[0]?l:a[0]?-u:0;if(l!==u)return l;if(o.e!==e.e)return o.e>e.e^l<0?1:-1;for(t=0,n=(r=s.length)<(i=a.length)?r:i;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^l<0?1:-1;return r===i?0:r>i^l<0?1:-1},O.cosine=O.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+k,r.rounding=1,n=M(r,X(r,n)),r.precision=e,r.rounding=t,D(2==i||3==i?n.neg():n,e,t,!0)):new r(1):new r(NaN)},O.cubeRoot=O.cbrt=function(){var e,t,n,r,i,o,s,a,l,u,c=this,d=c.constructor;if(!c.isFinite()||c.isZero())return new d(c);for(h=!1,(o=c.s*_(c.s*c,1/3))&&Math.abs(o)!=1/0?r=new d(o.toString()):(n=N(c.d),(o=((e=c.e)-n.length+1)%3)&&(n+=1==o||-2==o?"0":"00"),o=_(n,1/3),e=y((e+1)/3)-(e%3==(e<0?-1:2)),(r=new d(n=o==1/0?"5e"+e:(n=o.toExponential()).slice(0,n.indexOf("e")+1)+e)).s=c.s),s=(e=d.precision)+3;;)if(r=C((u=(l=(a=r).times(a).times(a)).plus(c)).plus(c).times(a),u.plus(l),s+2,1),N(a.d).slice(0,s)===(n=N(r.d)).slice(0,s)){if("9999"!=(n=n.slice(s-3,s+1))&&(i||"4999"!=n)){+n&&(+n.slice(1)||"5"!=n.charAt(0))||(D(r,e+1,1),t=!r.times(r).times(r).eq(c));break}if(!i&&(D(a,e+1,0),a.times(a).times(a).eq(c))){r=a;break}s+=4,i=1}return h=!0,D(r,e,d.rounding,t)},O.decimalPlaces=O.dp=function(){var e,t=this.d,n=NaN;if(t){if(n=((e=t.length-1)-y(this.e/k))*k,e=t[e])for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n},O.dividedBy=O.div=function(e){return C(this,new this.constructor(e))},O.dividedToIntegerBy=O.divToInt=function(e){var t=this,n=t.constructor;return D(C(t,new n(e),0,1,1),n.precision,n.rounding)},O.equals=O.eq=function(e){return 0===this.cmp(e)},O.floor=function(){return D(new this.constructor(this),this.e+1,3)},O.greaterThan=O.gt=function(e){return this.cmp(e)>0},O.greaterThanOrEqualTo=O.gte=function(e){var t=this.cmp(e);return 1==t||0===t},O.hyperbolicCosine=O.cosh=function(){var e,t,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,(i=o.d.length)<32?t=(1/J(4,e=Math.ceil(i/3))).toString():(e=16,t="2.3283064365386962890625e-10"),o=Q(s,1,o.times(t),new s(1),!0);for(var l,u=e,c=new s(8);u--;)l=o.times(o),o=a.minus(l.times(c.minus(l.times(c))));return D(o,s.precision=n,s.rounding=r,!0)},O.hyperbolicSine=O.sinh=function(){var e,t,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,n=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,(r=i.d.length)<3)i=Q(o,2,i,i,!0);else{e=(e=1.4*Math.sqrt(r))>16?16:0|e,i=Q(o,2,i=i.times(1/J(5,e)),i,!0);for(var s,a=new o(5),l=new o(16),u=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(l.times(s).plus(u))))}return o.precision=t,o.rounding=n,D(i,t,n,!0)},O.hyperbolicTangent=O.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,C(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)},O.inverseCosine=O.acos=function(){var e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,i=t.rounding;return -1!==n?0===n?e.isNeg()?F(t,r,i):new t(0):new t(NaN):e.isZero()?F(t,r+4,i).times(.5):(t.precision=r+6,t.rounding=1,e=new t(1).minus(e).div(e.plus(1)).sqrt().atan(),t.precision=r,t.rounding=i,e.times(2))},O.inverseHyperbolicCosine=O.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,h=!1,n=n.times(n).minus(1).sqrt().plus(n),h=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)},O.inverseHyperbolicSine=O.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,h=!1,n=n.times(n).plus(1).sqrt().plus(n),h=!0,r.precision=e,r.rounding=t,n.ln())},O.inverseHyperbolicTangent=O.atanh=function(){var e,t,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,Math.max(r=i.sd(),e)<-(2*i.e)-1)?D(new o(i),e,t,!0):(o.precision=n=r-i.e,i=C(i.plus(1),new o(1).minus(i),n+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5)):new o(NaN)},O.inverseSine=O.asin=function(){var e,t,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),n=o.precision,r=o.rounding,-1!==t)?0===t?((e=F(o,n+4,r).times(.5)).s=i.s,e):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2))},O.inverseTangent=O.atan=function(){var e,t,n,r,i,o,s,a,l,u=this,c=u.constructor,d=c.precision,f=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);else if(u.abs().eq(1)&&d+4<=x)return(s=F(c,d+4,f).times(.25)).s=u.s,s}else{if(!u.s)return new c(NaN);if(d+4<=x)return(s=F(c,d+4,f).times(.5)).s=u.s,s}for(c.precision=a=d+10,c.rounding=1,e=n=Math.min(28,a/k+2|0);e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(h=!1,t=Math.ceil(a/k),r=1,l=u.times(u),s=new c(u),i=u;-1!==e;)if(i=i.times(l),o=s.minus(i.div(r+=2)),i=i.times(l),void 0!==(s=o.plus(i.div(r+=2))).d[t])for(e=t;s.d[e]===o.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),h=!0,D(s,c.precision=d,c.rounding=f,!0)},O.isFinite=function(){return!!this.d},O.isInteger=O.isInt=function(){return!!this.d&&y(this.e/k)>this.d.length-2},O.isNaN=function(){return!this.s},O.isNegative=O.isNeg=function(){return this.s<0},O.isPositive=O.isPos=function(){return this.s>0},O.isZero=function(){return!!this.d&&0===this.d[0]},O.lessThan=O.lt=function(e){return 0>this.cmp(e)},O.lessThanOrEqualTo=O.lte=function(e){return 1>this.cmp(e)},O.logarithm=O.log=function(e){var t,n,r,i,o,s,a,l,u=this,c=u.constructor,d=c.precision,f=c.rounding,p=5;if(null==e)e=new c(10),t=!0;else{if(n=(e=new c(e)).d,e.s<0||!n||!n[0]||e.eq(1))return new c(NaN);t=e.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new c(n&&!n[0]?-1/0:1!=u.s?NaN:n?0:1/0);if(t)if(n.length>1)o=!0;else{for(i=n[0];i%10==0;)i/=10;o=1!==i}if(h=!1,T((l=C(s=V(u,a=d+p),r=t?L(c,a+10):V(e,a),a,1)).d,i=d,f))do if(a+=10,l=C(s=V(u,a),r=t?L(c,a+10):V(e,a),a,1),!o){+N(l.d).slice(i+1,i+15)+1==1e14&&(l=D(l,d+1,0));break}while(T(l.d,i+=10,f));return h=!0,D(l,d,f)},O.minus=O.sub=function(e){var t,n,r,i,o,s,a,l,u,c,d,f,p=this,m=p.constructor;if(e=new m(e),!p.d||!e.d)return p.s&&e.s?p.d?e.s=-e.s:e=new m(e.d||p.s!==e.s?p:NaN):e=new m(NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(u=p.d,f=e.d,a=m.precision,l=m.rounding,!u[0]||!f[0]){if(f[0])e.s=-e.s;else{if(!u[0])return new m(3===l?-0:0);e=new m(p)}return h?D(e,a,l):e}if(n=y(e.e/k),c=y(p.e/k),u=u.slice(),o=c-n){for((d=o<0)?(t=u,o=-o,s=f.length):(t=f,n=c,s=u.length),o>(r=Math.max(Math.ceil(a/k),s)+2)&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for((d=(r=u.length)<(s=f.length))&&(s=r),r=0;r<s;r++)if(u[r]!=f[r]){d=u[r]<f[r];break}o=0}for(d&&(t=u,u=f,f=t,e.s=-e.s),s=u.length,r=f.length-s;r>0;--r)u[s++]=0;for(r=f.length;r>o;){if(u[--r]<f[r]){for(i=r;i&&0===u[--i];)u[i]=S-1;--u[i],u[r]+=S}u[r]-=f[r]}for(;0===u[--s];)u.pop();for(;0===u[0];u.shift())--n;return u[0]?(e.d=u,e.e=j(u,n),h?D(e,a,l):e):new m(3===l?-0:0)},O.modulo=O.mod=function(e){var t,n=this,r=n.constructor;return(e=new r(e),n.d&&e.s&&(!e.d||e.d[0]))?e.d&&(!n.d||n.d[0])?(h=!1,9==r.modulo?(t=C(n,e.abs(),0,3,1),t.s*=e.s):t=C(n,e,0,r.modulo,1),t=t.times(e),h=!0,n.minus(t)):D(new r(n),r.precision,r.rounding):new r(NaN)},O.naturalExponential=O.exp=function(){return G(this)},O.naturalLogarithm=O.ln=function(){return V(this)},O.negated=O.neg=function(){var e=new this.constructor(this);return e.s=-e.s,D(e)},O.plus=O.add=function(e){var t,n,r,i,o,s,a,l,u,c,d=this,f=d.constructor;if(e=new f(e),!d.d||!e.d)return d.s&&e.s?d.d||(e=new f(e.d||d.s===e.s?d:NaN)):e=new f(NaN),e;if(d.s!=e.s)return e.s=-e.s,d.minus(e);if(u=d.d,c=e.d,a=f.precision,l=f.rounding,!u[0]||!c[0])return c[0]||(e=new f(d)),h?D(e,a,l):e;if(o=y(d.e/k),r=y(e.e/k),u=u.slice(),i=o-r){for(i<0?(n=u,i=-i,s=c.length):(n=c,r=o,s=u.length),i>(s=(o=Math.ceil(a/k))>s?o+1:s+1)&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for((s=u.length)-(i=c.length)<0&&(i=s,n=c,c=u,u=n),t=0;i;)t=(u[--i]=u[i]+c[i]+t)/S|0,u[i]%=S;for(t&&(u.unshift(t),++r),s=u.length;0==u[--s];)u.pop();return e.d=u,e.e=j(u,r),h?D(e,a,l):e},O.precision=O.sd=function(e){var t,n=this;if(void 0!==e&&!!e!==e&&1!==e&&0!==e)throw Error(f+e);return n.d?(t=q(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t},O.round=function(){var e=this,t=e.constructor;return D(new t(e),e.e+1,t.rounding)},O.sine=O.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+k,r.rounding=1,n=Z(r,X(r,n)),r.precision=e,r.rounding=t,D(i>2?n.neg():n,e,t,!0)):new r(NaN)},O.squareRoot=O.sqrt=function(){var e,t,n,r,i,o,s=this,a=s.d,l=s.e,u=s.s,c=s.constructor;if(1!==u||!a||!a[0])return new c(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(h=!1,0==(u=Math.sqrt(+s))||u==1/0?(((t=N(a)).length+l)%2==0&&(t+="0"),u=Math.sqrt(t),l=y((l+1)/2)-(l<0||l%2),r=new c(t=u==1/0?"5e"+l:(t=u.toExponential()).slice(0,t.indexOf("e")+1)+l)):r=new c(u.toString()),n=(l=c.precision)+3;;)if(r=(o=r).plus(C(s,o,n+2,1)).times(.5),N(o.d).slice(0,n)===(t=N(r.d)).slice(0,n)){if("9999"!=(t=t.slice(n-3,n+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(D(r,l+1,1),e=!r.times(r).eq(s));break}if(!i&&(D(o,l+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}return h=!0,D(r,l,c.rounding,e)},O.tangent=O.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,(n=n.sin()).s=1,n=C(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,D(2==i||4==i?n.neg():n,e,t,!0)):new r(NaN)},O.times=O.mul=function(e){var t,n,r,i,o,s,a,l,u,c=this,d=c.constructor,f=c.d,p=(e=new d(e)).d;if(e.s*=c.s,!f||!f[0]||!p||!p[0])return new d(!e.s||f&&!f[0]&&!p||p&&!p[0]&&!f?NaN:!f||!p?e.s/0:0*e.s);for(n=y(c.e/k)+y(e.e/k),(l=f.length)<(u=p.length)&&(o=f,f=p,p=o,s=l,l=u,u=s),o=[],r=s=l+u;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,i=l+r;i>r;)a=o[i]+p[r]*f[i-r-1]+t,o[i--]=a%S|0,t=a/S|0;o[i]=(o[i]+t)%S|0}for(;!o[--s];)o.pop();return t?++n:o.shift(),e.d=o,e.e=j(o,n),h?D(e,d.precision,d.rounding):e},O.toBinary=function(e,t){return ee(this,2,e,t)},O.toDecimalPlaces=O.toDP=function(e,t){var n=this,r=n.constructor;return(n=new r(n),void 0===e)?n:(A(e,0,s),void 0===t?t=r.rounding:A(t,0,8),D(n,e+n.e+1,t))},O.toExponential=function(e,t){var n,r=this,i=r.constructor;return void 0===e?n=$(r,!0):(A(e,0,s),void 0===t?t=i.rounding:A(t,0,8),n=$(r=D(new i(r),e+1,t),!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n},O.toFixed=function(e,t){var n,r,i=this,o=i.constructor;return void 0===e?n=$(i):(A(e,0,s),void 0===t?t=o.rounding:A(t,0,8),n=$(r=D(new o(i),e+i.e+1,t),!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n},O.toFraction=function(e){var t,n,r,i,o,s,a,l,u,c,d,p,m=this,g=m.d,y=m.constructor;if(!g)return new y(m);if(u=n=new y(1),r=l=new y(0),s=(o=(t=new y(r)).e=q(g)-m.e-1)%k,t.d[0]=_(10,s<0?k+s:s),null==e)e=o>0?t:u;else{if(!(a=new y(e)).isInt()||a.lt(u))throw Error(f+a);e=a.gt(t)?o>0?t:u:a}for(h=!1,a=new y(N(g)),c=y.precision,y.precision=o=g.length*k*2;d=C(a,t,0,1,1),1!=(i=n.plus(d.times(r))).cmp(e);)n=r,r=i,i=u,u=l.plus(d.times(i)),l=i,i=t,t=a.minus(d.times(i)),a=i;return i=C(e.minus(n),r,0,1,1),l=l.plus(i.times(u)),n=n.plus(i.times(r)),l.s=u.s=m.s,p=1>C(u,r,o,1).minus(m).abs().cmp(C(l,n,o,1).minus(m).abs())?[u,r]:[l,n],y.precision=c,h=!0,p},O.toHexadecimal=O.toHex=function(e,t){return ee(this,16,e,t)},O.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),null==e){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),void 0===t?t=r.rounding:A(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(h=!1,n=C(n,e,0,t,1).times(e),h=!0,D(n)):(e.s=n.s,n=e),n},O.toNumber=function(){return+this},O.toOctal=function(e,t){return ee(this,8,e,t)},O.toPower=O.pow=function(e){var t,n,r,i,o,s,a=this,l=a.constructor,u=+(e=new l(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new l(_(+a,u));if((a=new l(a)).eq(1))return a;if(r=l.precision,o=l.rounding,e.eq(1))return D(a,r,o);if((t=y(e.e/k))>=e.d.length-1&&(n=u<0?-u:u)<=I)return i=z(l,a,n,r),e.s<0?new l(1).div(i):D(i,r,o);if((s=a.s)<0){if(t<e.d.length-1)return new l(NaN);if((1&e.d[t])==0&&(s=1),0==a.e&&1==a.d[0]&&1==a.d.length)return a.s=s,a}return(t=0!=(n=_(+a,u))&&isFinite(n)?new l(n+"").e:y(u*(Math.log("0."+N(a.d))/Math.LN10+a.e+1)))>l.maxE+1||t<l.minE-1?new l(t>0?s/0:0):(h=!1,l.rounding=a.s=1,n=Math.min(12,(t+"").length),(i=G(e.times(V(a,r+n)),r)).d&&T((i=D(i,r+5,1)).d,r,o)&&(t=r+10,+N((i=D(G(e.times(V(a,t+n)),t),t+5,1)).d).slice(r+1,r+15)+1==1e14&&(i=D(i,r+1,0))),i.s=s,h=!0,l.rounding=o,D(i,r,o))},O.toPrecision=function(e,t){var n,r=this,i=r.constructor;return void 0===e?n=$(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(A(e,1,s),void 0===t?t=i.rounding:A(t,0,8),n=$(r=D(new i(r),e,t),e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n},O.toSignificantDigits=O.toSD=function(e,t){var n=this,r=n.constructor;return void 0===e?(e=r.precision,t=r.rounding):(A(e,1,s),void 0===t?t=r.rounding:A(t,0,8)),D(new r(n),e,t)},O.toString=function(){var e=this,t=e.constructor,n=$(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n},O.truncated=O.trunc=function(){return D(new this.constructor(this),this.e+1,1)},O.valueOf=O.toJSON=function(){var e=this,t=e.constructor,n=$(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};var C=function(){function e(e,t,n){var r,i=0,o=e.length;for(e=e.slice();o--;)r=e[o]*t+i,e[o]=r%n|0,i=r/n|0;return i&&e.unshift(i),e}function t(e,t,n,r){var i,o;if(n!=r)o=n>r?1:-1;else for(i=o=0;i<n;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function n(e,t,n,r){for(var i=0;n--;)e[n]-=i,i=+(e[n]<t[n]),e[n]=i*r+e[n]-t[n];for(;!e[0]&&e.length>1;)e.shift()}return function(i,o,s,a,l,u){var c,h,d,f,p,m,g,_,v,b,w,E,I,R,x,O,N,A,T,P,M=i.constructor,C=i.s==o.s?1:-1,$=i.d,j=o.d;if(!$||!$[0]||!j||!j[0])return new M(!i.s||!o.s||($?j&&$[0]==j[0]:!j)?NaN:$&&0==$[0]||!j?0*C:C/0);for(u?(p=1,h=i.e-o.e):(u=S,p=k,h=y(i.e/p)-y(o.e/p)),T=j.length,N=$.length,b=(v=new M(C)).d=[],d=0;j[d]==($[d]||0);d++);if(j[d]>($[d]||0)&&h--,null==s?(R=s=M.precision,a=M.rounding):R=l?s+(i.e-o.e)+1:s,R<0)b.push(1),m=!0;else{if(R=R/p+2|0,d=0,1==T){for(f=0,j=j[0],R++;(d<N||f)&&R--;d++)x=f*u+($[d]||0),b[d]=x/j|0,f=x%j|0;m=f||d<N}else{for((f=u/(j[0]+1)|0)>1&&(j=e(j,f,u),$=e($,f,u),T=j.length,N=$.length),O=T,E=(w=$.slice(0,T)).length;E<T;)w[E++]=0;(P=j.slice()).unshift(0),A=j[0],j[1]>=u/2&&++A;do f=0,(c=t(j,w,T,E))<0?(I=w[0],T!=E&&(I=I*u+(w[1]||0)),(f=I/A|0)>1?(f>=u&&(f=u-1),_=(g=e(j,f,u)).length,E=w.length,1==(c=t(g,w,_,E))&&(f--,n(g,T<_?P:j,_,u))):(0==f&&(c=f=1),g=j.slice()),(_=g.length)<E&&g.unshift(0),n(w,g,E,u),-1==c&&(E=w.length,(c=t(j,w,T,E))<1&&(f++,n(w,T<E?P:j,E,u))),E=w.length):0===c&&(f++,w=[0]),b[d++]=f,c&&w[0]?w[E++]=$[O]||0:(w=[$[O]],E=1);while((O++<N||void 0!==w[0])&&R--);m=void 0!==w[0]}b[0]||b.shift()}if(1==p)v.e=h,r=m;else{for(d=1,f=b[0];f>=10;f/=10)d++;v.e=d+h*p-1,D(v,l?s+v.e+1:s,a,m)}return v}}();function D(e,t,n,r){var i,o,s,a,l,u,c,d,f,p=e.constructor;e:if(null!=t){if(!(d=e.d))return e;for(i=1,a=d[0];a>=10;a/=10)i++;if((o=t-i)<0)o+=k,s=t,l=(c=d[f=0])/_(10,i-s-1)%10|0;else if((f=Math.ceil((o+1)/k))>=(a=d.length))if(r){for(;a++<=f;)d.push(0);c=l=0,i=1,o%=k,s=o-k+1}else break e;else{for(i=1,c=a=d[f];a>=10;a/=10)i++;o%=k,l=(s=o-k+i)<0?0:c/_(10,i-s-1)%10|0}if(r=r||t<0||void 0!==d[f+1]||(s<0?c:c%_(10,i-s-1)),u=n<4?(l||r)&&(0==n||n==(e.s<0?3:2)):l>5||5==l&&(4==n||r||6==n&&(o>0?s>0?c/_(10,i-s):0:d[f-1])%10&1||n==(e.s<0?8:7)),t<1||!d[0])return d.length=0,u?(t-=e.e+1,d[0]=_(10,(k-t%k)%k),e.e=-t||0):d[0]=e.e=0,e;if(0==o?(d.length=f,a=1,f--):(d.length=f+1,a=_(10,k-o),d[f]=s>0?(c/_(10,i-s)%_(10,s)|0)*a:0),u)for(;;)if(0==f){for(o=1,s=d[0];s>=10;s/=10)o++;for(s=d[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,d[0]==S&&(d[0]=1));break}else{if(d[f]+=a,d[f]!=S)break;d[f--]=0,a=1}for(o=d.length;0===d[--o];)d.pop()}return h&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function $(e,t,n){if(!e.isFinite())return K(e);var r,i=e.e,o=N(e.d),s=o.length;return t?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+U(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+U(-i-1)+o,n&&(r=n-s)>0&&(o+=U(r))):i>=s?(o+=U(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+U(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=U(r))),o}function j(e,t){var n=e[0];for(t*=k;n>=10;n/=10)t++;return t}function L(e,t,n){if(t>R)throw h=!0,n&&(e.precision=n),Error(p);return D(new e(l),t,1,!0)}function F(e,t,n){if(t>x)throw Error(p);return D(new e(u),t,n,!0)}function q(e){var t=e.length-1,n=t*k+1;if(t=e[t]){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function U(e){for(var t="";e--;)t+="0";return t}function z(e,t,n,r){var i,o=new e(1),s=Math.ceil(r/k+4);for(h=!1;;){if(n%2&&et((o=o.times(t)).d,s)&&(i=!0),0===(n=y(n/2))){n=o.d.length-1,i&&0===o.d[n]&&++o.d[n];break}et((t=t.times(t)).d,s)}return h=!0,o}function H(e){return 1&e.d[e.d.length-1]}function B(e,t,n){for(var r,i,o=new e(t[0]),s=0;++s<t.length;){if(!(i=new e(t[s])).s){o=i;break}((r=o.cmp(i))===n||0===r&&o.s===n)&&(o=i)}return o}function G(e,t){var n,r,i,o,s,a,l,u=0,c=0,d=0,f=e.constructor,p=f.rounding,m=f.precision;if(!e.d||!e.d[0]||e.e>17)return new f(e.d?!e.d[0]?1:e.s<0?0:1/0:e.s?e.s<0?0:e:0/0);for(null==t?(h=!1,l=m):l=t,a=new f(.03125);e.e>-2;)e=e.times(a),d+=5;for(l+=r=Math.log(_(2,d))/Math.LN10*2+5|0,n=o=s=new f(1),f.precision=l;;){if(o=D(o.times(e),l,1),n=n.times(++c),N((a=s.plus(C(o,n,l,1))).d).slice(0,l)===N(s.d).slice(0,l)){for(i=d;i--;)s=D(s.times(s),l,1);if(null!=t)return f.precision=m,s;if(!(u<3&&T(s.d,l-r,p,u)))return D(s,f.precision=m,p,h=!0);f.precision=l+=10,n=o=a=new f(1),c=0,u++}s=a}}function V(e,t){var n,r,i,o,s,a,l,u,c,d,f,p=1,m=10,g=e,y=g.d,_=g.constructor,v=_.rounding,b=_.precision;if(g.s<0||!y||!y[0]||!g.e&&1==y[0]&&1==y.length)return new _(y&&!y[0]?-1/0:1!=g.s?NaN:y?0:g);if(null==t?(h=!1,c=b):c=t,_.precision=c+=m,r=(n=N(y)).charAt(0),!(15e14>Math.abs(o=g.e)))return u=L(_,c+2,b).times(o+""),g=V(new _(r+"."+n.slice(1)),c-m).plus(u),_.precision=b,null==t?D(g,b,v,h=!0):g;for(;r<7&&1!=r||1==r&&n.charAt(1)>3;)r=(n=N((g=g.times(e)).d)).charAt(0),p++;for(o=g.e,r>1?(g=new _("0."+n),o++):g=new _(r+"."+n.slice(1)),d=g,l=s=g=C(g.minus(1),g.plus(1),c,1),f=D(g.times(g),c,1),i=3;;){if(s=D(s.times(f),c,1),N((u=l.plus(C(s,new _(i),c,1))).d).slice(0,c)===N(l.d).slice(0,c)){if(l=l.times(2),0!==o&&(l=l.plus(L(_,c+2,b).times(o+""))),l=C(l,new _(p),c,1),null!=t)return _.precision=b,l;if(!T(l.d,c-m,v,a))return D(l,_.precision=b,v,h=!0);_.precision=c+=m,u=s=g=C(d.minus(1),d.plus(1),c,1),f=D(g.times(g),c,1),i=a=1}l=u,i+=2}}function K(e){return String(e.s*e.s/0)}function W(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;48===t.charCodeAt(r);r++);for(i=t.length;48===t.charCodeAt(i-1);--i);if(t=t.slice(r,i)){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%k,n<0&&(r+=k),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=k;r<i;)e.d.push(+t.slice(r,r+=k));r=k-(t=t.slice(r)).length}else r-=i;for(;r--;)t+="0";e.d.push(+t),h&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Y(e,t){var n,r,i,o,s,a,l,u,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),E.test(t))return W(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(b.test(t))n=16,t=t.toLowerCase();else if(v.test(t))n=2;else if(w.test(t))n=8;else throw Error(f+t);for((o=t.search(/p/i))>0?(l=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),s=(o=t.indexOf("."))>=0,r=e.constructor,s&&(o=(a=(t=t.replace(".","")).length)-o,i=z(r,new r(n),o,2*o)),o=c=(u=P(t,n,S)).length-1;0===u[o];--o)u.pop();return o<0?new r(0*e.s):(e.e=j(u,c),e.d=u,h=!1,s&&(e=C(e,i,4*a)),l&&(e=e.times(54>Math.abs(l)?_(2,l):eH.pow(2,l))),h=!0,e)}function Z(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:Q(e,2,t,t);n=(n=1.4*Math.sqrt(r))>16?16:0|n,t=Q(e,2,t=t.times(1/J(5,n)),t);for(var i,o=new e(5),s=new e(16),a=new e(20);n--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function Q(e,t,n,r,i){var o,s,a,l,u=e.precision,c=Math.ceil(u/k);for(h=!1,l=n.times(n),a=new e(r);;){if(s=C(a.times(l),new e(t++*t++),u,1),a=i?r.plus(s):r.minus(s),r=C(s.times(l),new e(t++*t++),u,1),void 0!==(s=a.plus(r)).d[c]){for(o=c;s.d[o]===a.d[o]&&o--;);if(-1==o)break}o=a,a=r,r=s,s=o}return h=!0,s.d.length=c+1,s}function J(e,t){for(var n=e;--t;)n*=e;return n}function X(e,t){var n,r=t.s<0,o=F(e,e.precision,1),s=o.times(.5);if((t=t.abs()).lte(s))return i=r?4:1,t;if((n=t.divToInt(o)).isZero())i=r?3:2;else{if((t=t.minus(n.times(o))).lte(s))return i=H(n)?r?2:3:r?4:1,t;i=H(n)?r?1:4:r?3:2}return t.minus(o).abs()}function ee(e,t,n,i){var o,l,u,c,h,d,f,p,m,g=e.constructor,y=void 0!==n;if(y?(A(n,1,s),void 0===i?i=g.rounding:A(i,0,8)):(n=g.precision,i=g.rounding),e.isFinite()){for(u=(f=$(e)).indexOf("."),y?(o=2,16==t?n=4*n-3:8==t&&(n=3*n-2)):o=t,u>=0&&(f=f.replace(".",""),(m=new g(1)).e=f.length-u,m.d=P($(m),10,o),m.e=m.d.length),l=h=(p=P(f,10,o)).length;0==p[--h];)p.pop();if(p[0]){if(u<0?l--:((e=new g(e)).d=p,e.e=l,p=(e=C(e,m,n,i,0,o)).d,l=e.e,d=r),u=p[n],c=o/2,d=d||void 0!==p[n+1],d=i<4?(void 0!==u||d)&&(0===i||i===(e.s<0?3:2)):u>c||u===c&&(4===i||d||6===i&&1&p[n-1]||i===(e.s<0?8:7)),p.length=n,d)for(;++p[--n]>o-1;)p[n]=0,n||(++l,p.unshift(1));for(h=p.length;!p[h-1];--h);for(u=0,f="";u<h;u++)f+=a.charAt(p[u]);if(y){if(h>1)if(16==t||8==t){for(u=16==t?4:3,--h;h%u;h++)f+="0";for(h=(p=P(f,o,t)).length;!p[h-1];--h);for(u=1,f="1.";u<h;u++)f+=a.charAt(p[u])}else f=f.charAt(0)+"."+f.slice(1);f=f+(l<0?"p":"p+")+l}else if(l<0){for(;++l;)f="0"+f;f="0."+f}else if(++l>h)for(l-=h;l--;)f+="0";else l<h&&(f=f.slice(0,l)+"."+f.slice(l))}else f=y?"0p+0":"0";f=(16==t?"0x":2==t?"0b":8==t?"0o":"")+f}else f=K(e);return e.s<0?"-"+f:f}function et(e,t){if(e.length>t)return e.length=t,!0}function en(e){return new this(e).abs()}function er(e){return new this(e).acos()}function ei(e){return new this(e).acosh()}function eo(e,t){return new this(e).plus(t)}function es(e){return new this(e).asin()}function ea(e){return new this(e).asinh()}function el(e){return new this(e).atan()}function eu(e){return new this(e).atanh()}function ec(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,o=r+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(n=t.s<0?F(this,r,i):new this(0)).s=e.s:!e.d||t.isZero()?(n=F(this,o,1).times(.5)).s=e.s:t.s<0?(this.precision=o,this.rounding=1,n=this.atan(C(e,t,o,1)),t=F(this,o,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(C(e,t,o,1)):(n=F(this,o,1).times(t.s>0?.25:.75)).s=e.s:n=new this(NaN),n}function eh(e){return new this(e).cbrt()}function ed(e){return D(e=new this(e),e.e+1,2)}function ef(e,t,n){return new this(e).clamp(t,n)}function ep(e){if(!e||"object"!=typeof e)throw Error(d+"Object expected");var t,n,r,i=!0===e.defaults,a=["precision",1,s,"rounding",0,8,"toExpNeg",-o,0,"toExpPos",0,o,"maxE",0,o,"minE",-o,0,"modulo",0,9];for(t=0;t<a.length;t+=3)if(n=a[t],i&&(this[n]=c[n]),void 0!==(r=e[n]))if(y(r)===r&&r>=a[t+1]&&r<=a[t+2])this[n]=r;else throw Error(f+n+": "+r);if(n="crypto",i&&(this[n]=c[n]),void 0!==(r=e[n]))if(!0===r||!1===r||0===r||1===r)if(r)if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(m);else this[n]=!1;else throw Error(f+n+": "+r);return this}function em(e){return new this(e).cos()}function eg(e){return new this(e).cosh()}function ey(e){var t,n,r;function i(e){var t,n,r,o=this;if(!(o instanceof i))return new i(e);if(o.constructor=i,eE(e)){o.s=e.s,h?!e.d||e.e>i.maxE?(o.e=NaN,o.d=null):e.e<i.minE?(o.e=0,o.d=[0]):(o.e=e.e,o.d=e.d.slice()):(o.e=e.e,o.d=e.d?e.d.slice():e.d);return}if("number"==(r=typeof e)){if(0===e){o.s=1/e<0?-1:1,o.e=0,o.d=[0];return}if(e<0?(e=-e,o.s=-1):o.s=1,e===~~e&&e<1e7){for(t=0,n=e;n>=10;n/=10)t++;h?t>i.maxE?(o.e=NaN,o.d=null):t<i.minE?(o.e=0,o.d=[0]):(o.e=t,o.d=[e]):(o.e=t,o.d=[e]);return}if(0*e!=0){e||(o.s=NaN),o.e=NaN,o.d=null;return}return W(o,e.toString())}if("string"===r)return 45===(n=e.charCodeAt(0))?(e=e.slice(1),o.s=-1):(43===n&&(e=e.slice(1)),o.s=1),E.test(e)?W(o,e):Y(o,e);if("bigint"===r)return e<0?(e=-e,o.s=-1):o.s=1,W(o,e.toString());throw Error(f+e)}if(i.prototype=O,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=ep,i.clone=ey,i.isDecimal=eE,i.abs=en,i.acos=er,i.acosh=ei,i.add=eo,i.asin=es,i.asinh=ea,i.atan=el,i.atanh=eu,i.atan2=ec,i.cbrt=eh,i.ceil=ed,i.clamp=ef,i.cos=em,i.cosh=eg,i.div=e_,i.exp=ev,i.floor=eb,i.hypot=ew,i.ln=eS,i.log=ek,i.log10=eR,i.log2=eI,i.max=ex,i.min=eO,i.mod=eN,i.mul=eA,i.pow=eT,i.random=eP,i.round=eM,i.sign=eC,i.sin=eD,i.sinh=e$,i.sqrt=ej,i.sub=eL,i.sum=eF,i.tan=eq,i.tanh=eU,i.trunc=ez,void 0===e&&(e={}),e&&!0!==e.defaults)for(t=0,r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"];t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return i.config(e),i}function e_(e,t){return new this(e).div(t)}function ev(e){return new this(e).exp()}function eb(e){return D(e=new this(e),e.e+1,3)}function ew(){var e,t,n=new this(0);for(e=0,h=!1;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return h=!0,new this(1/0);n=t}return h=!0,n.sqrt()}function eE(e){return e instanceof eH||e&&e.toStringTag===g||!1}function eS(e){return new this(e).ln()}function ek(e,t){return new this(e).log(t)}function eI(e){return new this(e).log(2)}function eR(e){return new this(e).log(10)}function ex(){return B(this,arguments,-1)}function eO(){return B(this,arguments,1)}function eN(e,t){return new this(e).mod(t)}function eA(e,t){return new this(e).mul(t)}function eT(e,t){return new this(e).pow(t)}function eP(e){var t,n,r,i,o=0,a=new this(1),l=[];if(void 0===e?e=this.precision:A(e,1,s),r=Math.ceil(e/k),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)(i=t[o])>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:l[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)(i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((127&t[o+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,o):(l.push(i%1e7),o+=4);o=r/4}else throw Error(m);else for(;o<r;)l[o++]=1e7*Math.random()|0;for(r=l[--o],e%=k,r&&e&&(i=_(10,k-e),l[o]=(r/i|0)*i);0===l[o];o--)l.pop();if(o<0)n=0,l=[0];else{for(n=-1;0===l[0];n-=k)l.shift();for(r=1,i=l[0];i>=10;i/=10)r++;r<k&&(n-=k-r)}return a.e=n,a.d=l,a}function eM(e){return D(e=new this(e),e.e+1,this.rounding)}function eC(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function eD(e){return new this(e).sin()}function e$(e){return new this(e).sinh()}function ej(e){return new this(e).sqrt()}function eL(e,t){return new this(e).sub(t)}function eF(){var e=0,t=arguments,n=new this(t[0]);for(h=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return h=!0,D(n,this.precision,this.rounding)}function eq(e){return new this(e).tan()}function eU(e){return new this(e).tanh()}function ez(e){return D(e=new this(e),e.e+1,1)}O[Symbol.for("nodejs.util.inspect.custom")]=O.toString,O[Symbol.toStringTag]="Decimal";var eH=O.constructor=ey(c);l=new eH(l),u=new eH(u);let eB=eH},2168:function(e){e.exports=JSON.parse("{\"blacklist_client.lua\":\"local blacklist = ARGV[num_static_argv + 1]\\n\\nif redis.call('zscore', client_last_seen_key, blacklist) then\\n  redis.call('zadd', client_last_seen_key, 0, blacklist)\\nend\\n\\n\\nreturn {}\\n\",\"check.lua\":\"local weight = tonumber(ARGV[num_static_argv + 1])\\n\\nlocal capacity = process_tick(now, false)['capacity']\\nlocal nextRequest = tonumber(redis.call('hget', settings_key, 'nextRequest'))\\n\\nreturn conditions_check(capacity, weight) and nextRequest - now <= 0\\n\",\"conditions_check.lua\":\"local conditions_check = function (capacity, weight)\\n  return capacity == nil or weight <= capacity\\nend\\n\",\"current_reservoir.lua\":\"return process_tick(now, false)['reservoir']\\n\",\"done.lua\":\"process_tick(now, false)\\n\\nreturn tonumber(redis.call('hget', settings_key, 'done'))\\n\",\"free.lua\":\"local index = ARGV[num_static_argv + 1]\\n\\nredis.call('zadd', job_expirations_key, 0, index)\\n\\nreturn process_tick(now, false)['running']\\n\",\"get_time.lua\":\"redis.replicate_commands()\\n\\nlocal get_time = function ()\\n  local time = redis.call('time')\\n\\n  return tonumber(time[1]..string.sub(time[2], 1, 3))\\nend\\n\",\"group_check.lua\":\"return not (redis.call('exists', settings_key) == 1)\\n\",\"heartbeat.lua\":\"process_tick(now, true)\\n\",\"increment_reservoir.lua\":\"local incr = tonumber(ARGV[num_static_argv + 1])\\n\\nredis.call('hincrby', settings_key, 'reservoir', incr)\\n\\nlocal reservoir = process_tick(now, true)['reservoir']\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn reservoir\\n\",\"init.lua\":\"local clear = tonumber(ARGV[num_static_argv + 1])\\nlocal limiter_version = ARGV[num_static_argv + 2]\\nlocal num_local_argv = num_static_argv + 2\\n\\nif clear == 1 then\\n  redis.call('del', unpack(KEYS))\\nend\\n\\nif redis.call('exists', settings_key) == 0 then\\n  -- Create\\n  local args = {'hmset', settings_key}\\n\\n  for i = num_local_argv + 1, #ARGV do\\n    table.insert(args, ARGV[i])\\n  end\\n\\n  redis.call(unpack(args))\\n  redis.call('hmset', settings_key,\\n    'nextRequest', now,\\n    'lastReservoirRefresh', now,\\n    'lastReservoirIncrease', now,\\n    'running', 0,\\n    'done', 0,\\n    'unblockTime', 0,\\n    'capacityPriorityCounter', 0\\n  )\\n\\nelse\\n  -- Apply migrations\\n  local settings = redis.call('hmget', settings_key,\\n    'id',\\n    'version'\\n  )\\n  local id = settings[1]\\n  local current_version = settings[2]\\n\\n  if current_version ~= limiter_version then\\n    local version_digits = {}\\n    for k, v in string.gmatch(current_version, \\\"([^.]+)\\\") do\\n      table.insert(version_digits, tonumber(k))\\n    end\\n\\n    -- 2.10.0\\n    if version_digits[2] < 10 then\\n      redis.call('hsetnx', settings_key, 'reservoirRefreshInterval', '')\\n      redis.call('hsetnx', settings_key, 'reservoirRefreshAmount', '')\\n      redis.call('hsetnx', settings_key, 'lastReservoirRefresh', '')\\n      redis.call('hsetnx', settings_key, 'done', 0)\\n      redis.call('hset', settings_key, 'version', '2.10.0')\\n    end\\n\\n    -- 2.11.1\\n    if version_digits[2] < 11 or (version_digits[2] == 11 and version_digits[3] < 1) then\\n      if redis.call('hstrlen', settings_key, 'lastReservoirRefresh') == 0 then\\n        redis.call('hmset', settings_key,\\n          'lastReservoirRefresh', now,\\n          'version', '2.11.1'\\n        )\\n      end\\n    end\\n\\n    -- 2.14.0\\n    if version_digits[2] < 14 then\\n      local old_running_key = 'b_'..id..'_running'\\n      local old_executing_key = 'b_'..id..'_executing'\\n\\n      if redis.call('exists', old_running_key) == 1 then\\n        redis.call('rename', old_running_key, job_weights_key)\\n      end\\n      if redis.call('exists', old_executing_key) == 1 then\\n        redis.call('rename', old_executing_key, job_expirations_key)\\n      end\\n      redis.call('hset', settings_key, 'version', '2.14.0')\\n    end\\n\\n    -- 2.15.2\\n    if version_digits[2] < 15 or (version_digits[2] == 15 and version_digits[3] < 2) then\\n      redis.call('hsetnx', settings_key, 'capacityPriorityCounter', 0)\\n      redis.call('hset', settings_key, 'version', '2.15.2')\\n    end\\n\\n    -- 2.17.0\\n    if version_digits[2] < 17 then\\n      redis.call('hsetnx', settings_key, 'clientTimeout', 10000)\\n      redis.call('hset', settings_key, 'version', '2.17.0')\\n    end\\n\\n    -- 2.18.0\\n    if version_digits[2] < 18 then\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseInterval', '')\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseAmount', '')\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseMaximum', '')\\n      redis.call('hsetnx', settings_key, 'lastReservoirIncrease', now)\\n      redis.call('hset', settings_key, 'version', '2.18.0')\\n    end\\n\\n  end\\n\\n  process_tick(now, false)\\nend\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn {}\\n\",\"process_tick.lua\":\"local process_tick = function (now, always_publish)\\n\\n  local compute_capacity = function (maxConcurrent, running, reservoir)\\n    if maxConcurrent ~= nil and reservoir ~= nil then\\n      return math.min((maxConcurrent - running), reservoir)\\n    elseif maxConcurrent ~= nil then\\n      return maxConcurrent - running\\n    elseif reservoir ~= nil then\\n      return reservoir\\n    else\\n      return nil\\n    end\\n  end\\n\\n  local settings = redis.call('hmget', settings_key,\\n    'id',\\n    'maxConcurrent',\\n    'running',\\n    'reservoir',\\n    'reservoirRefreshInterval',\\n    'reservoirRefreshAmount',\\n    'lastReservoirRefresh',\\n    'reservoirIncreaseInterval',\\n    'reservoirIncreaseAmount',\\n    'reservoirIncreaseMaximum',\\n    'lastReservoirIncrease',\\n    'capacityPriorityCounter',\\n    'clientTimeout'\\n  )\\n  local id = settings[1]\\n  local maxConcurrent = tonumber(settings[2])\\n  local running = tonumber(settings[3])\\n  local reservoir = tonumber(settings[4])\\n  local reservoirRefreshInterval = tonumber(settings[5])\\n  local reservoirRefreshAmount = tonumber(settings[6])\\n  local lastReservoirRefresh = tonumber(settings[7])\\n  local reservoirIncreaseInterval = tonumber(settings[8])\\n  local reservoirIncreaseAmount = tonumber(settings[9])\\n  local reservoirIncreaseMaximum = tonumber(settings[10])\\n  local lastReservoirIncrease = tonumber(settings[11])\\n  local capacityPriorityCounter = tonumber(settings[12])\\n  local clientTimeout = tonumber(settings[13])\\n\\n  local initial_capacity = compute_capacity(maxConcurrent, running, reservoir)\\n\\n  --\\n  -- Process 'running' changes\\n  --\\n  local expired = redis.call('zrangebyscore', job_expirations_key, '-inf', '('..now)\\n\\n  if #expired > 0 then\\n    redis.call('zremrangebyscore', job_expirations_key, '-inf', '('..now)\\n\\n    local flush_batch = function (batch, acc)\\n      local weights = redis.call('hmget', job_weights_key, unpack(batch))\\n                      redis.call('hdel',  job_weights_key, unpack(batch))\\n      local clients = redis.call('hmget', job_clients_key, unpack(batch))\\n                      redis.call('hdel',  job_clients_key, unpack(batch))\\n\\n      -- Calculate sum of removed weights\\n      for i = 1, #weights do\\n        acc['total'] = acc['total'] + (tonumber(weights[i]) or 0)\\n      end\\n\\n      -- Calculate sum of removed weights by client\\n      local client_weights = {}\\n      for i = 1, #clients do\\n        local removed = tonumber(weights[i]) or 0\\n        if removed > 0 then\\n          acc['client_weights'][clients[i]] = (acc['client_weights'][clients[i]] or 0) + removed\\n        end\\n      end\\n    end\\n\\n    local acc = {\\n      ['total'] = 0,\\n      ['client_weights'] = {}\\n    }\\n    local batch_size = 1000\\n\\n    -- Compute changes to Zsets and apply changes to Hashes\\n    for i = 1, #expired, batch_size do\\n      local batch = {}\\n      for j = i, math.min(i + batch_size - 1, #expired) do\\n        table.insert(batch, expired[j])\\n      end\\n\\n      flush_batch(batch, acc)\\n    end\\n\\n    -- Apply changes to Zsets\\n    if acc['total'] > 0 then\\n      redis.call('hincrby', settings_key, 'done', acc['total'])\\n      running = tonumber(redis.call('hincrby', settings_key, 'running', -acc['total']))\\n    end\\n\\n    for client, weight in pairs(acc['client_weights']) do\\n      redis.call('zincrby', client_running_key, -weight, client)\\n    end\\n  end\\n\\n  --\\n  -- Process 'reservoir' changes\\n  --\\n  local reservoirRefreshActive = reservoirRefreshInterval ~= nil and reservoirRefreshAmount ~= nil\\n  if reservoirRefreshActive and now >= lastReservoirRefresh + reservoirRefreshInterval then\\n    reservoir = reservoirRefreshAmount\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'lastReservoirRefresh', now\\n    )\\n  end\\n\\n  local reservoirIncreaseActive = reservoirIncreaseInterval ~= nil and reservoirIncreaseAmount ~= nil\\n  if reservoirIncreaseActive and now >= lastReservoirIncrease + reservoirIncreaseInterval then\\n    local num_intervals = math.floor((now - lastReservoirIncrease) / reservoirIncreaseInterval)\\n    local incr = reservoirIncreaseAmount * num_intervals\\n    if reservoirIncreaseMaximum ~= nil then\\n      incr = math.min(incr, reservoirIncreaseMaximum - (reservoir or 0))\\n    end\\n    if incr > 0 then\\n      reservoir = (reservoir or 0) + incr\\n    end\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'lastReservoirIncrease', lastReservoirIncrease + (num_intervals * reservoirIncreaseInterval)\\n    )\\n  end\\n\\n  --\\n  -- Clear unresponsive clients\\n  --\\n  local unresponsive = redis.call('zrangebyscore', client_last_seen_key, '-inf', (now - clientTimeout))\\n  local unresponsive_lookup = {}\\n  local terminated_clients = {}\\n  for i = 1, #unresponsive do\\n    unresponsive_lookup[unresponsive[i]] = true\\n    if tonumber(redis.call('zscore', client_running_key, unresponsive[i])) == 0 then\\n      table.insert(terminated_clients, unresponsive[i])\\n    end\\n  end\\n  if #terminated_clients > 0 then\\n    redis.call('zrem', client_running_key,         unpack(terminated_clients))\\n    redis.call('hdel', client_num_queued_key,      unpack(terminated_clients))\\n    redis.call('zrem', client_last_registered_key, unpack(terminated_clients))\\n    redis.call('zrem', client_last_seen_key,       unpack(terminated_clients))\\n  end\\n\\n  --\\n  -- Broadcast capacity changes\\n  --\\n  local final_capacity = compute_capacity(maxConcurrent, running, reservoir)\\n\\n  if always_publish or (initial_capacity ~= nil and final_capacity == nil) then\\n    -- always_publish or was not unlimited, now unlimited\\n    redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))\\n\\n  elseif initial_capacity ~= nil and final_capacity ~= nil and final_capacity > initial_capacity then\\n    -- capacity was increased\\n    -- send the capacity message to the limiter having the lowest number of running jobs\\n    -- the tiebreaker is the limiter having not registered a job in the longest time\\n\\n    local lowest_concurrency_value = nil\\n    local lowest_concurrency_clients = {}\\n    local lowest_concurrency_last_registered = {}\\n    local client_concurrencies = redis.call('zrange', client_running_key, 0, -1, 'withscores')\\n\\n    for i = 1, #client_concurrencies, 2 do\\n      local client = client_concurrencies[i]\\n      local concurrency = tonumber(client_concurrencies[i+1])\\n\\n      if (\\n        lowest_concurrency_value == nil or lowest_concurrency_value == concurrency\\n      ) and (\\n        not unresponsive_lookup[client]\\n      ) and (\\n        tonumber(redis.call('hget', client_num_queued_key, client)) > 0\\n      ) then\\n        lowest_concurrency_value = concurrency\\n        table.insert(lowest_concurrency_clients, client)\\n        local last_registered = tonumber(redis.call('zscore', client_last_registered_key, client))\\n        table.insert(lowest_concurrency_last_registered, last_registered)\\n      end\\n    end\\n\\n    if #lowest_concurrency_clients > 0 then\\n      local position = 1\\n      local earliest = lowest_concurrency_last_registered[1]\\n\\n      for i,v in ipairs(lowest_concurrency_last_registered) do\\n        if v < earliest then\\n          position = i\\n          earliest = v\\n        end\\n      end\\n\\n      local next_client = lowest_concurrency_clients[position]\\n      redis.call('publish', 'b_'..id,\\n        'capacity-priority:'..(final_capacity or '')..\\n        ':'..next_client..\\n        ':'..capacityPriorityCounter\\n      )\\n      redis.call('hincrby', settings_key, 'capacityPriorityCounter', '1')\\n    else\\n      redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))\\n    end\\n  end\\n\\n  return {\\n    ['capacity'] = final_capacity,\\n    ['running'] = running,\\n    ['reservoir'] = reservoir\\n  }\\nend\\n\",\"queued.lua\":\"local clientTimeout = tonumber(redis.call('hget', settings_key, 'clientTimeout'))\\nlocal valid_clients = redis.call('zrangebyscore', client_last_seen_key, (now - clientTimeout), 'inf')\\nlocal client_queued = redis.call('hmget', client_num_queued_key, unpack(valid_clients))\\n\\nlocal sum = 0\\nfor i = 1, #client_queued do\\n  sum = sum + tonumber(client_queued[i])\\nend\\n\\nreturn sum\\n\",\"refresh_expiration.lua\":\"local refresh_expiration = function (now, nextRequest, groupTimeout)\\n\\n  if groupTimeout ~= nil then\\n    local ttl = (nextRequest + groupTimeout) - now\\n\\n    for i = 1, #KEYS do\\n      redis.call('pexpire', KEYS[i], ttl)\\n    end\\n  end\\n\\nend\\n\",\"refs.lua\":\"local settings_key = KEYS[1]\\nlocal job_weights_key = KEYS[2]\\nlocal job_expirations_key = KEYS[3]\\nlocal job_clients_key = KEYS[4]\\nlocal client_running_key = KEYS[5]\\nlocal client_num_queued_key = KEYS[6]\\nlocal client_last_registered_key = KEYS[7]\\nlocal client_last_seen_key = KEYS[8]\\n\\nlocal now = tonumber(ARGV[1])\\nlocal client = ARGV[2]\\n\\nlocal num_static_argv = 2\\n\",\"register.lua\":\"local index = ARGV[num_static_argv + 1]\\nlocal weight = tonumber(ARGV[num_static_argv + 2])\\nlocal expiration = tonumber(ARGV[num_static_argv + 3])\\n\\nlocal state = process_tick(now, false)\\nlocal capacity = state['capacity']\\nlocal reservoir = state['reservoir']\\n\\nlocal settings = redis.call('hmget', settings_key,\\n  'nextRequest',\\n  'minTime',\\n  'groupTimeout'\\n)\\nlocal nextRequest = tonumber(settings[1])\\nlocal minTime = tonumber(settings[2])\\nlocal groupTimeout = tonumber(settings[3])\\n\\nif conditions_check(capacity, weight) then\\n\\n  redis.call('hincrby', settings_key, 'running', weight)\\n  redis.call('hset', job_weights_key, index, weight)\\n  if expiration ~= nil then\\n    redis.call('zadd', job_expirations_key, now + expiration, index)\\n  end\\n  redis.call('hset', job_clients_key, index, client)\\n  redis.call('zincrby', client_running_key, weight, client)\\n  redis.call('hincrby', client_num_queued_key, client, -1)\\n  redis.call('zadd', client_last_registered_key, now, client)\\n\\n  local wait = math.max(nextRequest - now, 0)\\n  local newNextRequest = now + wait + minTime\\n\\n  if reservoir == nil then\\n    redis.call('hset', settings_key,\\n      'nextRequest', newNextRequest\\n    )\\n  else\\n    reservoir = reservoir - weight\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'nextRequest', newNextRequest\\n    )\\n  end\\n\\n  refresh_expiration(now, newNextRequest, groupTimeout)\\n\\n  return {true, wait, reservoir}\\n\\nelse\\n  return {false}\\nend\\n\",\"register_client.lua\":\"local queued = tonumber(ARGV[num_static_argv + 1])\\n\\n-- Could have been re-registered concurrently\\nif not redis.call('zscore', client_last_seen_key, client) then\\n  redis.call('zadd', client_running_key, 0, client)\\n  redis.call('hset', client_num_queued_key, client, queued)\\n  redis.call('zadd', client_last_registered_key, 0, client)\\nend\\n\\nredis.call('zadd', client_last_seen_key, now, client)\\n\\nreturn {}\\n\",\"running.lua\":\"return process_tick(now, false)['running']\\n\",\"submit.lua\":\"local queueLength = tonumber(ARGV[num_static_argv + 1])\\nlocal weight = tonumber(ARGV[num_static_argv + 2])\\n\\nlocal capacity = process_tick(now, false)['capacity']\\n\\nlocal settings = redis.call('hmget', settings_key,\\n  'id',\\n  'maxConcurrent',\\n  'highWater',\\n  'nextRequest',\\n  'strategy',\\n  'unblockTime',\\n  'penalty',\\n  'minTime',\\n  'groupTimeout'\\n)\\nlocal id = settings[1]\\nlocal maxConcurrent = tonumber(settings[2])\\nlocal highWater = tonumber(settings[3])\\nlocal nextRequest = tonumber(settings[4])\\nlocal strategy = tonumber(settings[5])\\nlocal unblockTime = tonumber(settings[6])\\nlocal penalty = tonumber(settings[7])\\nlocal minTime = tonumber(settings[8])\\nlocal groupTimeout = tonumber(settings[9])\\n\\nif maxConcurrent ~= nil and weight > maxConcurrent then\\n  return redis.error_reply('OVERWEIGHT:'..weight..':'..maxConcurrent)\\nend\\n\\nlocal reachedHWM = (highWater ~= nil and queueLength == highWater\\n  and not (\\n    conditions_check(capacity, weight)\\n    and nextRequest - now <= 0\\n  )\\n)\\n\\nlocal blocked = strategy == 3 and (reachedHWM or unblockTime >= now)\\n\\nif blocked then\\n  local computedPenalty = penalty\\n  if computedPenalty == nil then\\n    if minTime == 0 then\\n      computedPenalty = 5000\\n    else\\n      computedPenalty = 15 * minTime\\n    end\\n  end\\n\\n  local newNextRequest = now + computedPenalty + minTime\\n\\n  redis.call('hmset', settings_key,\\n    'unblockTime', now + computedPenalty,\\n    'nextRequest', newNextRequest\\n  )\\n\\n  local clients_queued_reset = redis.call('hkeys', client_num_queued_key)\\n  local queued_reset = {}\\n  for i = 1, #clients_queued_reset do\\n    table.insert(queued_reset, clients_queued_reset[i])\\n    table.insert(queued_reset, 0)\\n  end\\n  redis.call('hmset', client_num_queued_key, unpack(queued_reset))\\n\\n  redis.call('publish', 'b_'..id, 'blocked:')\\n\\n  refresh_expiration(now, newNextRequest, groupTimeout)\\nend\\n\\nif not blocked and not reachedHWM then\\n  redis.call('hincrby', client_num_queued_key, client, 1)\\nend\\n\\nreturn {reachedHWM, blocked, strategy}\\n\",\"update_settings.lua\":\"local args = {'hmset', settings_key}\\n\\nfor i = num_static_argv + 1, #ARGV do\\n  table.insert(args, ARGV[i])\\nend\\n\\nredis.call(unpack(args))\\n\\nprocess_tick(now, true)\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn {}\\n\",\"validate_client.lua\":\"if not redis.call('zscore', client_last_seen_key, client) then\\n  return redis.error_reply('UNKNOWN_CLIENT')\\nend\\n\\nredis.call('zadd', client_last_seen_key, now, client)\\n\",\"validate_keys.lua\":\"if not (redis.call('exists', settings_key) == 1) then\\n  return redis.error_reply('SETTINGS_KEY_NOT_FOUND')\\nend\\n\"}")},4006:function(e){e.exports={r:"2.19.5"}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.c=__webpack_module_cache__,__webpack_require__.x=()=>__webpack_require__(5663),(()=>{__webpack_require__.federation||(__webpack_require__.federation={chunkMatcher:function(e){return!/^(149|521)$/.test(e)},rootOutputDir:""})})(),(()=>{__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t}})(),(()=>{__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}})(),(()=>{var e=__webpack_require__.x,t=!1;__webpack_require__.x=function(){if(t||(t=!0,__webpack_require__(6544)),"function"==typeof e)return e();console.warn("[MF] Invalid prevStartup")}})(),(()=>{__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce((t,n)=>(__webpack_require__.f[n](e,t),t),[]))})(),(()=>{__webpack_require__.u=e=>""+e+".js"})(),(()=>{__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{__webpack_require__.S={},__webpack_require__.initializeSharingData={scopeToSharingDataMapping:{default:[{name:"@orpc/contract",version:"^1.10.0",factory:()=>Promise.all([__webpack_require__.e("16"),__webpack_require__.e("957")]).then(()=>()=>__webpack_require__(3804)),eager:0,singleton:1,requiredVersion:"^1.10.0",strictVersion:0},{name:"@orpc/server",version:"^1.10.0",factory:()=>Promise.all([__webpack_require__.e("16"),__webpack_require__.e("683"),__webpack_require__.e("149")]).then(()=>()=>__webpack_require__(7750)),eager:0,singleton:1,requiredVersion:"^1.10.0",strictVersion:0},{name:"effect",version:"3.18.1",factory:()=>__webpack_require__.e("553").then(()=>()=>__webpack_require__(9704)),eager:0,singleton:1,requiredVersion:"3.18.1",strictVersion:0},{name:"every-plugin",version:"0.3.2",factory:()=>Promise.all([__webpack_require__.e("654"),__webpack_require__.e("149"),__webpack_require__.e("521")]).then(()=>()=>__webpack_require__(2629)),eager:0,singleton:1,requiredVersion:"0.3.2",strictVersion:0},{name:"zod",version:"4.1.5",factory:()=>__webpack_require__.e("195").then(()=>()=>__webpack_require__(5926)),eager:0,singleton:1,requiredVersion:"4.1.5",strictVersion:0}]},uniqueName:"near-intents_debridge-data-provider"},__webpack_require__.I=__webpack_require__.I||function(){throw Error("should have __webpack_require__.I")}})(),(()=>{__webpack_require__.consumesLoadingData={chunkMapping:{149:["3876"],889:["9873","1522","2059","3876","4464"],521:["9873","1522","2059"]},moduleIdToConsumeDataMapping:{4464:{shareScope:"default",shareKey:"every-plugin",import:"every-plugin",requiredVersion:"0.3.2",strictVersion:!1,singleton:!0,eager:!1,fallback:()=>__webpack_require__.e("654").then(()=>()=>__webpack_require__(2629))},2059:{shareScope:"default",shareKey:"effect",import:"effect",requiredVersion:"3.18.1",strictVersion:!1,singleton:!0,eager:!1,fallback:()=>__webpack_require__.e("553").then(()=>()=>__webpack_require__(9704))},9873:{shareScope:"default",shareKey:"@orpc/server",import:"@orpc/server",requiredVersion:"^1.10.0",strictVersion:!1,singleton:!0,eager:!1,fallback:()=>Promise.all([__webpack_require__.e("16"),__webpack_require__.e("683")]).then(()=>()=>__webpack_require__(7750))},1522:{shareScope:"default",shareKey:"zod",import:"zod",requiredVersion:"4.1.5",strictVersion:!1,singleton:!0,eager:!1,fallback:()=>__webpack_require__.e("195").then(()=>()=>__webpack_require__(5926))},3876:{shareScope:"default",shareKey:"@orpc/contract",import:"@orpc/contract",requiredVersion:"^1.10.0",strictVersion:!1,singleton:!0,eager:!1,fallback:()=>Promise.all([__webpack_require__.e("16"),__webpack_require__.e("957")]).then(()=>()=>__webpack_require__(3804))}},initialConsumes:["9873","1522","2059","3876","4464"]},__webpack_require__.f.consumes=__webpack_require__.f.consumes||function(){throw Error("should have __webpack_require__.f.consumes")}})(),(()=>{var e={889:0},t=t=>{var n=t.modules,r=t.ids,i=t.runtime;for(var o in n)__webpack_require__.o(n,o)&&(__webpack_require__.m[o]=n[o]);i&&i(__webpack_require__);for(var s=0;s<r.length;s++)e[r[s]]&&e[r[s]][0](),e[r[s]]=0};__webpack_require__.f.readFileVm=function(n,r){var i=e[n];if(0!==i)if(i)r.push(i[2]);else if(/^(149|521)$/.test(n))e[n]=0;else{var o=new Promise(function(r,o){i=e[n]=[r,o];var s=require("path").join(__dirname,""+__webpack_require__.u(n));require("fs").readFile(s,"utf-8",function(e,n){if(e)return o(e);var r={};require("vm").runInThisContext("(function(exports, require, __dirname, __filename) {"+n+"\n})",s)(r,require,require("path").dirname(s),s),t(r)})});r.push(i[2]=o)}}})();var __webpack_exports__=__webpack_require__.x();module.exports=__webpack_exports__})();
//# sourceMappingURL=main.js.map