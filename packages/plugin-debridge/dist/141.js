"use strict";exports.ids=["141"],exports.modules={736:function(e,t,n){var r,i;i=n(5944),r=n(990),e.exports=(function(){class e{constructor(e={}){this.options=e,i.load(this.options,this.defaults,this),this.Events=new r(this),this._arr=[],this._resetPromise(),this._lastFlush=Date.now()}_resetPromise(){return this._promise=new this.Promise((e,t)=>this._resolve=e)}_flush(){return clearTimeout(this._timeout),this._lastFlush=Date.now(),this._resolve(),this.Events.trigger("batch",this._arr),this._arr=[],this._resetPromise()}add(e){var t;return this._arr.push(e),t=this._promise,this._arr.length===this.maxSize?this._flush():null!=this.maxTime&&1===this._arr.length&&(this._timeout=setTimeout(()=>this._flush(),this.maxTime)),t}}return e.prototype.defaults={maxTime:null,maxSize:null,Promise:Promise},e}).call(void 0)},1452:function(e,t,n){function r(e,t){return u(e)||i(e,t)||o()}function i(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return n}function s(e){return u(e)||a(e)||o()}function o(){throw TypeError("Invalid attempt to destructure non-iterable instance")}function a(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function u(e){if(Array.isArray(e))return e}function l(e,t,n,r,i,s,o){try{var a=e[s](o),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,i)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){l(s,r,i,o,a,"next",e)}function a(e){l(s,r,i,o,a,"throw",e)}o(void 0)})}}var h,d,f,_,p,v,g,m,y,b,w=[].splice;p=10,h=5,b=n(5944),v=n(47),f=n(4284),_=n(87),g=n(5735),d=n(990),m=n(6553),y=n(9124),e.exports=(function(){class e{constructor(t={},...n){var r,i;this._addToQueue=this._addToQueue.bind(this),this._validateOptions(t,n),b.load(t,this.instanceDefaults,this),this._queues=new v(p),this._scheduled={},this._states=new m(["RECEIVED","QUEUED","RUNNING","EXECUTING"].concat(this.trackDoneStatus?["DONE"]:[])),this._limiter=null,this.Events=new d(this),this._submitLock=new y("submit",this.Promise),this._registerLock=new y("register",this.Promise),i=b.load(t,this.storeDefaults,{}),this._store=(function(){if("redis"===this.datastore||"ioredis"===this.datastore||null!=this.connection)return new g(this,i,r=b.load(t,this.redisStoreDefaults,{}));if("local"===this.datastore)return new _(this,i,r=b.load(t,this.localStoreDefaults,{}));throw new e.prototype.BottleneckError(`Invalid datastore type: ${this.datastore}`)}).call(this),this._queues.on("leftzero",()=>{var e;return null!=(e=this._store.heartbeat)&&"function"==typeof e.ref?e.ref():void 0}),this._queues.on("zero",()=>{var e;return null!=(e=this._store.heartbeat)&&"function"==typeof e.unref?e.unref():void 0})}_validateOptions(t,n){if(null==t||"object"!=typeof t||0!==n.length)throw new e.prototype.BottleneckError("Bottleneck v2 takes a single object argument. Refer to https://github.com/SGrondin/bottleneck#upgrading-to-v2 if you're upgrading from Bottleneck v1.")}ready(){return this._store.ready}clients(){return this._store.clients}channel(){return`b_${this.id}`}channel_client(){return`b_${this.id}_${this._store.clientId}`}publish(e){return this._store.__publish__(e)}disconnect(e=!0){return this._store.__disconnect__(e)}chain(e){return this._limiter=e,this}queued(e){return this._queues.queued(e)}clusterQueued(){return this._store.__queued__()}empty(){return 0===this.queued()&&this._submitLock.isEmpty()}running(){return this._store.__running__()}done(){return this._store.__done__()}jobStatus(e){return this._states.jobStatus(e)}jobs(e){return this._states.statusJobs(e)}counts(){return this._states.statusCounts()}_randomIndex(){return Math.random().toString(36).slice(2)}check(e=1){return this._store.__check__(e)}_clearGlobalState(e){return null!=this._scheduled[e]&&(clearTimeout(this._scheduled[e].expiration),delete this._scheduled[e],!0)}_free(e,t,n,r){var i=this;return c(function*(){var t,s;try{if(s=(yield i._store.__free__(e,n.weight)).running,i.Events.trigger("debug",`Freed ${n.id}`,r),0===s&&i.empty())return i.Events.trigger("idle")}catch(e){return t=e,i.Events.trigger("error",t)}})()}_run(e,t,n){var r,i,s;return t.doRun(),r=this._clearGlobalState.bind(this,e),s=this._run.bind(this,e,t),i=this._free.bind(this,e,t),this._scheduled[e]={timeout:setTimeout(()=>t.doExecute(this._limiter,r,s,i),n),expiration:null!=t.options.expiration?setTimeout(function(){return t.doExpire(r,s,i)},n+t.options.expiration):void 0,job:t}}_drainOne(e){return this._registerLock.schedule(()=>{if(0===this.queued())return this.Promise.resolve(null);var t,n,r,i,s=this._queues.getFirst(),o=r=s.first();return(i=o.options,t=o.args,null!=e&&i.weight>e)?this.Promise.resolve(null):(this.Events.trigger("debug",`Draining ${i.id}`,{args:t,options:i}),n=this._randomIndex(),this._store.__register__(n,i.weight,i.expiration).then(({success:e,wait:o,reservoir:a})=>{var u;return(this.Events.trigger("debug",`Drained ${i.id}`,{success:e,args:t,options:i}),e)?(s.shift(),(u=this.empty())&&this.Events.trigger("empty"),0===a&&this.Events.trigger("depleted",u),this._run(n,r,o),this.Promise.resolve(i.weight)):this.Promise.resolve(null)}))})}_drainAll(e,t=0){return this._drainOne(e).then(n=>{var r;return null!=n?(r=null!=e?e-n:e,this._drainAll(r,t+n)):this.Promise.resolve(t)}).catch(e=>this.Events.trigger("error",e))}_dropAllQueued(e){return this._queues.shiftAll(function(t){return t.doDrop({message:e})})}stop(t={}){var n,r;return t=b.load(t,this.stopDefaults),r=e=>{var t;return t=()=>{var t;return(t=this._states.counts)[0]+t[1]+t[2]+t[3]===e},new this.Promise((e,n)=>t()?e():this.on("done",()=>{if(t())return this.removeAllListeners("done"),e()}))},n=t.dropWaitingJobs?(this._run=function(e,n){return n.doDrop({message:t.dropErrorMessage})},this._drainOne=()=>this.Promise.resolve(null),this._registerLock.schedule(()=>this._submitLock.schedule(()=>{var e,n,i;for(e in n=this._scheduled)i=n[e],"RUNNING"===this.jobStatus(i.job.options.id)&&(clearTimeout(i.timeout),clearTimeout(i.expiration),i.job.doDrop({message:t.dropErrorMessage}));return this._dropAllQueued(t.dropErrorMessage),r(0)}))):this.schedule({priority:p-1,weight:0},()=>r(1)),this._receive=function(n){return n._reject(new e.prototype.BottleneckError(t.enqueueErrorMessage))},this.stop=()=>this.Promise.reject(new e.prototype.BottleneckError("stop() has already been called")),n}_addToQueue(t){var n=this;return c(function*(){var r,i,s,o,a,u,l;r=t.args,o=t.options;try{var c=yield n._store.__submit__(n.queued(),o.weight);a=c.reachedHWM,i=c.blocked,l=c.strategy}catch(e){return s=e,n.Events.trigger("debug",`Could not queue ${o.id}`,{args:r,options:o,error:s}),t.doDrop({error:s}),!1}return i?(t.doDrop(),!0):a&&(null!=(u=l===e.prototype.strategy.LEAK?n._queues.shiftLastFrom(o.priority):l===e.prototype.strategy.OVERFLOW_PRIORITY?n._queues.shiftLastFrom(o.priority+1):l===e.prototype.strategy.OVERFLOW?t:void 0)&&u.doDrop(),null==u||l===e.prototype.strategy.OVERFLOW)?(null==u&&t.doDrop(),a):(t.doQueue(a,i),n._queues.push(t),yield n._drainAll(),a)})()}_receive(t){return null!=this._states.jobStatus(t.options.id)?(t._reject(new e.prototype.BottleneckError(`A job with the same id already exists (id=${t.options.id})`)),!1):(t.doReceive(),this._submitLock.schedule(this._addToQueue,t))}submit(...e){var t,n,i,o,a,u;return"function"==typeof e[0]?(n=(a=s(e))[0],e=a.slice(1),t=r(w.call(e,-1),1)[0],o=b.load({},this.jobDefaults)):(o=(u=s(e))[0],n=u[1],e=u.slice(2),t=r(w.call(e,-1),1)[0],o=b.load(o,this.jobDefaults)),(i=new f((...e)=>new this.Promise(function(t,r){return n(...e,function(...e){return(null!=e[0]?r:t)(e)})}),e,o,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise)).promise.then(function(e){return"function"==typeof t?t(...e):void 0}).catch(function(e){return Array.isArray(e)?"function"==typeof t?t(...e):void 0:"function"==typeof t?t(e):void 0}),this._receive(i)}schedule(...e){var t,n,r;if("function"==typeof e[0]){var i=s(e);r=i[0],e=i.slice(1),n={}}else{var o=s(e);n=o[0],r=o[1],e=o.slice(2)}return t=new f(r,e,n,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise),this._receive(t),t.promise}wrap(e){var t,n;return t=this.schedule.bind(this),(n=function(...n){return t(e.bind(this),...n)}).withOptions=function(n,...r){return t(n,e,...r)},n}updateSettings(e={}){var t=this;return c(function*(){return yield t._store.__updateSettings__(b.overwrite(e,t.storeDefaults)),b.overwrite(e,t.instanceDefaults,t),t})()}currentReservoir(){return this._store.__currentReservoir__()}incrementReservoir(e=0){return this._store.__incrementReservoir__(e)}}return e.default=e,e.Events=d,e.version=e.prototype.version=n(4006).r,e.strategy=e.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3},e.BottleneckError=e.prototype.BottleneckError=n(4916),e.Group=e.prototype.Group=n(3996),e.RedisConnection=e.prototype.RedisConnection=n(9588),e.IORedisConnection=e.prototype.IORedisConnection=n(3400),e.Batcher=e.prototype.Batcher=n(736),e.prototype.jobDefaults={priority:h,weight:1,expiration:null,id:"<no-id>"},e.prototype.storeDefaults={maxConcurrent:null,minTime:0,highWater:null,strategy:e.prototype.strategy.LEAK,penalty:null,reservoir:null,reservoirRefreshInterval:null,reservoirRefreshAmount:null,reservoirIncreaseInterval:null,reservoirIncreaseAmount:null,reservoirIncreaseMaximum:null},e.prototype.localStoreDefaults={Promise:Promise,timeout:null,heartbeatInterval:250},e.prototype.redisStoreDefaults={Promise:Promise,timeout:null,heartbeatInterval:5e3,clientTimeout:1e4,Redis:null,clientOptions:{},clusterNodes:null,clearDatastore:!1,connection:null},e.prototype.instanceDefaults={datastore:"local",connection:null,id:"<no-id>",rejectOnDrop:!0,trackDoneStatus:!1,Promise:Promise},e.prototype.stopDefaults={enqueueErrorMessage:"This limiter has been stopped and cannot accept new jobs.",dropWaitingJobs:!0,dropErrorMessage:"This limiter has been stopped."},e}).call(void 0)},4916:function(e){e.exports=class extends Error{}},1979:function(e){e.exports=class{constructor(e,t){this.incr=e,this.decr=t,this._first=null,this._last=null,this.length=0}push(e){var t;this.length++,"function"==typeof this.incr&&this.incr(),t={value:e,prev:this._last,next:null},null!=this._last?(this._last.next=t,this._last=t):this._first=this._last=t}shift(){var e;return null==this._first?void 0:(this.length--,"function"==typeof this.decr&&this.decr(),e=this._first.value,null!=(this._first=this._first.next)?this._first.prev=null:this._last=null,e)}first(){if(null!=this._first)return this._first.value}getArray(){var e,t,n;for(e=this._first,n=[];null!=e;)n.push((t=e,e=e.next,t.value));return n}forEachShift(e){var t;for(t=this.shift();null!=t;)e(t),t=this.shift()}debug(){var e,t,n,r,i;for(e=this._first,i=[];null!=e;)i.push((t=e,e=e.next,{value:t.value,prev:null!=(n=t.prev)?n.value:void 0,next:null!=(r=t.next)?r.value:void 0}));return i}}},990:function(e){function t(e,t,n,r,i,s,o){try{var a=e[s](o),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,i)}function n(e){return function(){var n=this,r=arguments;return new Promise(function(i,s){var o=e.apply(n,r);function a(e){t(o,i,s,a,u,"next",e)}function u(e){t(o,i,s,a,u,"throw",e)}a(void 0)})}}e.exports=class{constructor(e){if(this.instance=e,this._events={},null!=this.instance.on||null!=this.instance.once||null!=this.instance.removeAllListeners)throw Error("An Emitter already exists for this object");this.instance.on=(e,t)=>this._addListener(e,"many",t),this.instance.once=(e,t)=>this._addListener(e,"once",t),this.instance.removeAllListeners=(e=null)=>null!=e?delete this._events[e]:this._events={}}_addListener(e,t,n){var r;return null==(r=this._events)[e]&&(r[e]=[]),this._events[e].push({cb:n,status:t}),this.instance}listenerCount(e){return null!=this._events[e]?this._events[e].length:0}trigger(e,...t){var r=this;return n(function*(){var i,s;try{if("debug"!==e&&r.trigger("debug",`Event triggered: ${e}`,t),null==r._events[e])return;return r._events[e]=r._events[e].filter(function(e){return"none"!==e.status}),s=r._events[e].map(function(){var e=n(function*(e){var n,i;if("none"!==e.status){"once"===e.status&&(e.status="none");try{if(i="function"==typeof e.cb?e.cb(...t):void 0,"function"==typeof(null!=i?i.then:void 0))return yield i;return i}catch(e){return n=e,r.trigger("error",n),null}}});return function(t){return e.apply(this,arguments)}}()),(yield Promise.all(s)).find(function(e){return null!=e})}catch(e){return i=e,r.trigger("error",i),null}})()}}},3996:function(e,t,n){var r,i,s,o,a;function u(e,t){return h(e)||c(e,t)||l()}function l(){throw TypeError("Invalid attempt to destructure non-iterable instance")}function c(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return n}function h(e){if(Array.isArray(e))return e}function d(e,t,n,r,i,s,o){try{var a=e[s](o),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,i)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){d(s,r,i,o,a,"next",e)}function a(e){d(s,r,i,o,a,"throw",e)}o(void 0)})}}a=n(5944),r=n(990),s=n(9588),i=n(3400),o=n(4035),e.exports=(function(){class e{constructor(e={}){this.deleteKey=this.deleteKey.bind(this),this.limiterOptions=e,a.load(this.limiterOptions,this.defaults,this),this.Events=new r(this),this.instances={},this.Bottleneck=n(1452),this._startAutoCleanup(),this.sharedConnection=null!=this.connection,null==this.connection&&("redis"===this.limiterOptions.datastore?this.connection=new s(Object.assign({},this.limiterOptions,{Events:this.Events})):"ioredis"===this.limiterOptions.datastore&&(this.connection=new i(Object.assign({},this.limiterOptions,{Events:this.Events}))))}key(e=""){var t;return null!=(t=this.instances[e])?t:(()=>{var t;return t=this.instances[e]=new this.Bottleneck(Object.assign(this.limiterOptions,{id:`${this.id}-${e}`,timeout:this.timeout,connection:this.connection})),this.Events.trigger("created",t,e),t})()}deleteKey(e=""){var t=this;return f(function*(){var n,r;return r=t.instances[e],t.connection&&(n=yield t.connection.__runCommand__(["del",...o.allKeys(`${t.id}-${e}`)])),null!=r&&(delete t.instances[e],yield r.disconnect()),null!=r||n>0})()}limiters(){var e,t,n,r;for(e in t=this.instances,n=[],t)r=t[e],n.push({key:e,limiter:r});return n}keys(){return Object.keys(this.instances)}clusterKeys(){var e=this;return f(function*(){var t,n,r,i,s,o,a,l,c;if(null==e.connection)return e.Promise.resolve(e.keys());for(o=[],t=null,c=`b_${e.id}-`.length,n=9;0!==t;){var h=u((yield e.connection.__runCommand__(["scan",null!=t?t:0,"match",`b_${e.id}-*_settings`,"count",1e4])),2);for(i=0,l=h[0],r=h[1],t=~~l,a=r.length;i<a;i++)s=r[i],o.push(s.slice(c,-n))}return o})()}_startAutoCleanup(){var e,t=this;return clearInterval(this.interval),"function"==typeof(e=this.interval=setInterval(f(function*(){var e,n,r,i,s,o;for(n in s=Date.now(),r=t.instances,i=[],r){o=r[n];try{(yield o._store.__groupCheck__(s))?i.push(t.deleteKey(n)):i.push(void 0)}catch(t){e=t,i.push(o.Events.trigger("error",e))}}return i}),this.timeout/2)).unref?e.unref():void 0}updateSettings(e={}){if(a.overwrite(e,this.defaults,this),a.overwrite(e,e,this.limiterOptions),null!=e.timeout)return this._startAutoCleanup()}disconnect(e=!0){var t;if(!this.sharedConnection)return null!=(t=this.connection)?t.disconnect(e):void 0}}return e.prototype.defaults={timeout:3e5,connection:null,Promise:Promise,id:"group-key"},e}).call(void 0)},3400:function(module,__unused_webpack_exports,__webpack_require__){var Events,IORedisConnection,Scripts,parser;function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return n}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,n,r,i,s,o){try{var a=e[s](o),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){asyncGeneratorStep(s,r,i,o,a,"next",e)}function a(e){asyncGeneratorStep(s,r,i,o,a,"throw",e)}o(void 0)})}}parser=__webpack_require__(5944),Events=__webpack_require__(990),Scripts=__webpack_require__(4035),IORedisConnection=(function(){class IORedisConnection{constructor(options={}){parser.load(options,this.defaults,this),null==this.Redis&&(this.Redis=eval("require")("ioredis")),null==this.Events&&(this.Events=new Events(this)),this.terminated=!1,null!=this.clusterNodes?(this.client=new this.Redis.Cluster(this.clusterNodes,this.clientOptions),this.subscriber=new this.Redis.Cluster(this.clusterNodes,this.clientOptions)):null!=this.client&&null==this.client.duplicate?this.subscriber=new this.Redis.Cluster(this.client.startupNodes,this.client.options):(null==this.client&&(this.client=new this.Redis(this.clientOptions)),this.subscriber=this.client.duplicate()),this.limiters={},this.ready=this.Promise.all([this._setup(this.client,!1),this._setup(this.subscriber,!0)]).then(()=>(this._loadScripts(),{client:this.client,subscriber:this.subscriber}))}_setup(e,t){return e.setMaxListeners(0),new this.Promise((n,r)=>(e.on("error",e=>this.Events.trigger("error",e)),t&&e.on("message",(e,t)=>{var n;return null!=(n=this.limiters[e])?n._store.onMessage(e,t):void 0}),"ready"===e.status)?n():e.once("ready",n))}_loadScripts(){return Scripts.names.forEach(e=>this.client.defineCommand(e,{lua:Scripts.payload(e)}))}__runCommand__(e){var t=this;return _asyncToGenerator(function*(){yield t.ready;var n,r=_slicedToArray((yield t.client.pipeline([e]).exec()),1),i=_slicedToArray(r[0],2);return n=i[0],i[1]})()}__addLimiter__(e){return this.Promise.all([e.channel(),e.channel_client()].map(t=>new this.Promise((n,r)=>this.subscriber.subscribe(t,()=>(this.limiters[t]=e,n())))))}__removeLimiter__(e){var t=this;return[e.channel(),e.channel_client()].forEach(function(){var e=_asyncToGenerator(function*(e){return t.terminated||(yield t.subscriber.unsubscribe(e)),delete t.limiters[e]});return function(t){return e.apply(this,arguments)}}())}__scriptArgs__(e,t,n,r){var i;return[(i=Scripts.keys(e,t)).length].concat(i,n,r)}__scriptFn__(e){return this.client[e].bind(this.client)}disconnect(e=!0){var t,n,r,i;for(t=0,r=(i=Object.keys(this.limiters)).length;t<r;t++)n=i[t],clearInterval(this.limiters[n]._store.heartbeat);return(this.limiters={},this.terminated=!0,e)?this.Promise.all([this.client.quit(),this.subscriber.quit()]):(this.client.disconnect(),this.subscriber.disconnect(),this.Promise.resolve())}}return IORedisConnection.prototype.datastore="ioredis",IORedisConnection.prototype.defaults={Redis:null,clientOptions:{},clusterNodes:null,client:null,Promise:Promise,Events:null},IORedisConnection}).call(void 0),module.exports=IORedisConnection},4284:function(e,t,n){var r,i,s,o;function a(e,t,n,r,i,s,o){try{var a=e[s](o),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,i)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){a(s,r,i,o,u,"next",e)}function u(e){a(s,r,i,o,u,"throw",e)}o(void 0)})}}s=10,i=5,o=n(5944),r=n(4916),e.exports=class{constructor(e,t,n,r,i,s,a,u){this.task=e,this.args=t,this.rejectOnDrop=i,this.Events=s,this._states=a,this.Promise=u,this.options=o.load(n,r),this.options.priority=this._sanitizePriority(this.options.priority),this.options.id===r.id&&(this.options.id=`${this.options.id}-${this._randomIndex()}`),this.promise=new this.Promise((e,t)=>{this._resolve=e,this._reject=t}),this.retryCount=0}_sanitizePriority(e){var t;return(t=~~e!==e?i:e)<0?0:t>s-1?s-1:t}_randomIndex(){return Math.random().toString(36).slice(2)}doDrop({error:e,message:t="This job has been dropped by Bottleneck"}={}){return!!this._states.remove(this.options.id)&&(this.rejectOnDrop&&this._reject(null!=e?e:new r(t)),this.Events.trigger("dropped",{args:this.args,options:this.options,task:this.task,promise:this.promise}),!0)}_assertStatus(e){var t;if((t=this._states.jobStatus(this.options.id))!==e&&("DONE"!==e||null!==t))throw new r(`Invalid job status ${t}, expected ${e}. Please open an issue at https://github.com/SGrondin/bottleneck/issues`)}doReceive(){return this._states.start(this.options.id),this.Events.trigger("received",{args:this.args,options:this.options})}doQueue(e,t){return this._assertStatus("RECEIVED"),this._states.next(this.options.id),this.Events.trigger("queued",{args:this.args,options:this.options,reachedHWM:e,blocked:t})}doRun(){return 0===this.retryCount?(this._assertStatus("QUEUED"),this._states.next(this.options.id)):this._assertStatus("EXECUTING"),this.Events.trigger("scheduled",{args:this.args,options:this.options})}doExecute(e,t,n,r){var i=this;return u(function*(){var s,o,a;0===i.retryCount?(i._assertStatus("RUNNING"),i._states.next(i.options.id)):i._assertStatus("EXECUTING"),o={args:i.args,options:i.options,retryCount:i.retryCount},i.Events.trigger("executing",o);try{if(a=yield null!=e?e.schedule(i.options,i.task,...i.args):i.task(...i.args),t())return i.doDone(o),yield r(i.options,o),i._assertStatus("DONE"),i._resolve(a)}catch(e){return s=e,i._onFailure(s,o,t,n,r)}})()}doExpire(e,t,n){var i,s;return this._states.jobStatus("RUNNING"===this.options.id)&&this._states.next(this.options.id),this._assertStatus("EXECUTING"),s={args:this.args,options:this.options,retryCount:this.retryCount},i=new r(`This job timed out after ${this.options.expiration} ms.`),this._onFailure(i,s,e,t,n)}_onFailure(e,t,n,r,i){var s=this;return u(function*(){var o,a;if(n())return null!=(o=yield s.Events.trigger("failed",e,t))?(a=~~o,s.Events.trigger("retry",`Retrying ${s.options.id} after ${a} ms`,t),s.retryCount++,r(a)):(s.doDone(t),yield i(s.options,t),s._assertStatus("DONE"),s._reject(e))})()}doDone(e){return this._assertStatus("EXECUTING"),this._states.next(this.options.id),this.Events.trigger("done",e)}}},87:function(e,t,n){var r,i;function s(e,t,n,r,i,s,o){try{var a=e[s](o),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,i)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){s(o,r,i,a,u,"next",e)}function u(e){s(o,r,i,a,u,"throw",e)}a(void 0)})}}i=n(5944),r=n(4916),e.exports=class{constructor(e,t,n){this.instance=e,this.storeOptions=t,this.clientId=this.instance._randomIndex(),i.load(n,n,this),this._nextRequest=this._lastReservoirRefresh=this._lastReservoirIncrease=Date.now(),this._running=0,this._done=0,this._unblockTime=0,this.ready=this.Promise.resolve(),this.clients={},this._startHeartbeat()}_startHeartbeat(){var e;return null==this.heartbeat&&(null!=this.storeOptions.reservoirRefreshInterval&&null!=this.storeOptions.reservoirRefreshAmount||null!=this.storeOptions.reservoirIncreaseInterval&&null!=this.storeOptions.reservoirIncreaseAmount)?"function"==typeof(e=this.heartbeat=setInterval(()=>{var e,t,n,r,i;if(r=Date.now(),null!=this.storeOptions.reservoirRefreshInterval&&r>=this._lastReservoirRefresh+this.storeOptions.reservoirRefreshInterval&&(this._lastReservoirRefresh=r,this.storeOptions.reservoir=this.storeOptions.reservoirRefreshAmount,this.instance._drainAll(this.computeCapacity())),null!=this.storeOptions.reservoirIncreaseInterval&&r>=this._lastReservoirIncrease+this.storeOptions.reservoirIncreaseInterval){var s=this.storeOptions;if(e=s.reservoirIncreaseAmount,n=s.reservoirIncreaseMaximum,i=s.reservoir,this._lastReservoirIncrease=r,(t=null!=n?Math.min(e,n-i):e)>0)return this.storeOptions.reservoir+=t,this.instance._drainAll(this.computeCapacity())}},this.heartbeatInterval)).unref?e.unref():void 0:clearInterval(this.heartbeat)}__publish__(e){var t=this;return o(function*(){return yield t.yieldLoop(),t.instance.Events.trigger("message",e.toString())})()}__disconnect__(e){var t=this;return o(function*(){return yield t.yieldLoop(),clearInterval(t.heartbeat),t.Promise.resolve()})()}yieldLoop(e=0){return new this.Promise(function(t,n){return setTimeout(t,e)})}computePenalty(){var e;return null!=(e=this.storeOptions.penalty)?e:15*this.storeOptions.minTime||5e3}__updateSettings__(e){var t=this;return o(function*(){return yield t.yieldLoop(),i.overwrite(e,e,t.storeOptions),t._startHeartbeat(),t.instance._drainAll(t.computeCapacity()),!0})()}__running__(){var e=this;return o(function*(){return yield e.yieldLoop(),e._running})()}__queued__(){var e=this;return o(function*(){return yield e.yieldLoop(),e.instance.queued()})()}__done__(){var e=this;return o(function*(){return yield e.yieldLoop(),e._done})()}__groupCheck__(e){var t=this;return o(function*(){return yield t.yieldLoop(),t._nextRequest+t.timeout<e})()}computeCapacity(){var e,t,n=this.storeOptions;return(e=n.maxConcurrent,t=n.reservoir,null!=e&&null!=t)?Math.min(e-this._running,t):null!=e?e-this._running:null!=t?t:null}conditionsCheck(e){var t;return null==(t=this.computeCapacity())||e<=t}__incrementReservoir__(e){var t=this;return o(function*(){var n;return yield t.yieldLoop(),n=t.storeOptions.reservoir+=e,t.instance._drainAll(t.computeCapacity()),n})()}__currentReservoir__(){var e=this;return o(function*(){return yield e.yieldLoop(),e.storeOptions.reservoir})()}isBlocked(e){return this._unblockTime>=e}check(e,t){return this.conditionsCheck(e)&&this._nextRequest-t<=0}__check__(e){var t=this;return o(function*(){var n;return yield t.yieldLoop(),n=Date.now(),t.check(e,n)})()}__register__(e,t,n){var r=this;return o(function*(){var e,n;return(yield r.yieldLoop(),e=Date.now(),r.conditionsCheck(t))?(r._running+=t,null!=r.storeOptions.reservoir&&(r.storeOptions.reservoir-=t),n=Math.max(r._nextRequest-e,0),r._nextRequest=e+n+r.storeOptions.minTime,{success:!0,wait:n,reservoir:r.storeOptions.reservoir}):{success:!1}})()}strategyIsBlock(){return 3===this.storeOptions.strategy}__submit__(e,t){var n=this;return o(function*(){var i,s,o;if(yield n.yieldLoop(),null!=n.storeOptions.maxConcurrent&&t>n.storeOptions.maxConcurrent)throw new r(`Impossible to add a job having a weight of ${t} to a limiter having a maxConcurrent setting of ${n.storeOptions.maxConcurrent}`);return s=Date.now(),o=null!=n.storeOptions.highWater&&e===n.storeOptions.highWater&&!n.check(t,s),(i=n.strategyIsBlock()&&(o||n.isBlocked(s)))&&(n._unblockTime=s+n.computePenalty(),n._nextRequest=n._unblockTime+n.storeOptions.minTime,n.instance._dropAllQueued()),{reachedHWM:o,blocked:i,strategy:n.storeOptions.strategy}})()}__free__(e,t){var n=this;return o(function*(){return yield n.yieldLoop(),n._running-=t,n._done+=t,n.instance._drainAll(n.computeCapacity()),{running:n._running}})()}}},47:function(e,t,n){var r,i;r=n(1979),i=n(990),e.exports=class{constructor(e){var t;this.Events=new i(this),this._length=0,this._lists=(function(){var n,i,s;for(s=[],t=n=1,i=e;1<=i?n<=i:n>=i;t=1<=i?++n:--n)s.push(new r(()=>this.incr(),()=>this.decr()));return s}).call(this)}incr(){if(0==this._length++)return this.Events.trigger("leftzero")}decr(){if(0==--this._length)return this.Events.trigger("zero")}push(e){return this._lists[e.options.priority].push(e)}queued(e){return null!=e?this._lists[e].length:this._length}shiftAll(e){return this._lists.forEach(function(t){return t.forEachShift(e)})}getFirst(e=this._lists){var t,n,r;for(t=0,n=e.length;t<n;t++)if((r=e[t]).length>0)return r;return[]}shiftLastFrom(e){return this.getFirst(this._lists.slice(e).reverse()).shift()}}},9588:function(module,__unused_webpack_exports,__webpack_require__){var Events,RedisConnection,Scripts,parser;function asyncGeneratorStep(e,t,n,r,i,s,o){try{var a=e[s](o),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){asyncGeneratorStep(s,r,i,o,a,"next",e)}function a(e){asyncGeneratorStep(s,r,i,o,a,"throw",e)}o(void 0)})}}parser=__webpack_require__(5944),Events=__webpack_require__(990),Scripts=__webpack_require__(4035),RedisConnection=(function(){class RedisConnection{constructor(options={}){parser.load(options,this.defaults,this),null==this.Redis&&(this.Redis=eval("require")("redis")),null==this.Events&&(this.Events=new Events(this)),this.terminated=!1,null==this.client&&(this.client=this.Redis.createClient(this.clientOptions)),this.subscriber=this.client.duplicate(),this.limiters={},this.shas={},this.ready=this.Promise.all([this._setup(this.client,!1),this._setup(this.subscriber,!0)]).then(()=>this._loadScripts()).then(()=>({client:this.client,subscriber:this.subscriber}))}_setup(e,t){return e.setMaxListeners(0),new this.Promise((n,r)=>(e.on("error",e=>this.Events.trigger("error",e)),t&&e.on("message",(e,t)=>{var n;return null!=(n=this.limiters[e])?n._store.onMessage(e,t):void 0}),e.ready)?n():e.once("ready",n))}_loadScript(e){return new this.Promise((t,n)=>{var r;return r=Scripts.payload(e),this.client.multi([["script","load",r]]).exec((r,i)=>null!=r?n(r):(this.shas[e]=i[0],t(i[0])))})}_loadScripts(){return this.Promise.all(Scripts.names.map(e=>this._loadScript(e)))}__runCommand__(e){var t=this;return _asyncToGenerator(function*(){return yield t.ready,new t.Promise((n,r)=>t.client.multi([e]).exec_atomic(function(e,t){return null!=e?r(e):n(t[0])}))})()}__addLimiter__(e){return this.Promise.all([e.channel(),e.channel_client()].map(t=>new this.Promise((n,r)=>{var i;return i=r=>{if(r===t)return this.subscriber.removeListener("subscribe",i),this.limiters[t]=e,n()},this.subscriber.on("subscribe",i),this.subscriber.subscribe(t)})))}__removeLimiter__(e){var t=this;return this.Promise.all([e.channel(),e.channel_client()].map(function(){var e=_asyncToGenerator(function*(e){return t.terminated||(yield new t.Promise((n,r)=>t.subscriber.unsubscribe(e,function(t,i){return null!=t?r(t):i===e?n():void 0}))),delete t.limiters[e]});return function(t){return e.apply(this,arguments)}}()))}__scriptArgs__(e,t,n,r){var i;return i=Scripts.keys(e,t),[this.shas[e],i.length].concat(i,n,r)}__scriptFn__(e){return this.client.evalsha.bind(this.client)}disconnect(e=!0){var t,n,r,i;for(t=0,r=(i=Object.keys(this.limiters)).length;t<r;t++)n=i[t],clearInterval(this.limiters[n]._store.heartbeat);return this.limiters={},this.terminated=!0,this.client.end(e),this.subscriber.end(e),this.Promise.resolve()}}return RedisConnection.prototype.datastore="redis",RedisConnection.prototype.defaults={Redis:null,clientOptions:{},client:null,Promise:Promise,Events:null},RedisConnection}).call(void 0),module.exports=RedisConnection},5735:function(e,t,n){var r,i,s,o;function a(e,t){return c(e)||l(e,t)||u()}function u(){throw TypeError("Invalid attempt to destructure non-iterable instance")}function l(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return n}function c(e){if(Array.isArray(e))return e}function h(e,t,n,r,i,s,o){try{var a=e[s](o),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,i)}function d(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){h(s,r,i,o,a,"next",e)}function a(e){h(s,r,i,o,a,"throw",e)}o(void 0)})}}o=n(5944),r=n(4916),s=n(9588),i=n(3400),e.exports=class{constructor(e,t,n){this.instance=e,this.storeOptions=t,this.originalId=this.instance.id,this.clientId=this.instance._randomIndex(),o.load(n,n,this),this.clients={},this.capacityPriorityCounters={},this.sharedConnection=null!=this.connection,null==this.connection&&(this.connection="redis"===this.instance.datastore?new s({Redis:this.Redis,clientOptions:this.clientOptions,Promise:this.Promise,Events:this.instance.Events}):"ioredis"===this.instance.datastore?new i({Redis:this.Redis,clientOptions:this.clientOptions,clusterNodes:this.clusterNodes,Promise:this.Promise,Events:this.instance.Events}):void 0),this.instance.connection=this.connection,this.instance.datastore=this.connection.datastore,this.ready=this.connection.ready.then(e=>(this.clients=e,this.runScript("init",this.prepareInitSettings(this.clearDatastore)))).then(()=>this.connection.__addLimiter__(this.instance)).then(()=>this.runScript("register_client",[this.instance.queued()])).then(()=>{var e;return"function"==typeof(e=this.heartbeat=setInterval(()=>this.runScript("heartbeat",[]).catch(e=>this.instance.Events.trigger("error",e)),this.heartbeatInterval)).unref&&e.unref(),this.clients})}__publish__(e){var t=this;return d(function*(){return(yield t.ready).client.publish(t.instance.channel(),`message:${e.toString()}`)})()}onMessage(e,t){var n=this;return d(function*(){var e,r,i,s,o,u,l,c,h,f;try{l=t.indexOf(":");var _=[t.slice(0,l),t.slice(l+1)];if(f=_[0],i=_[1],"capacity"===f)return yield n.instance._drainAll(i.length>0?~~i:void 0);if("capacity-priority"===f){var p=i.split(":"),v=a(p,3);if(h=v[0],c=v[1],r=v[2],e=h.length>0?~~h:void 0,c===n.clientId)return s=yield n.instance._drainAll(e),u=null!=e?e-(s||0):"",yield n.clients.client.publish(n.instance.channel(),`capacity-priority:${u}::${r}`);if(""===c)return clearTimeout(n.capacityPriorityCounters[r]),delete n.capacityPriorityCounters[r],n.instance._drainAll(e);return n.capacityPriorityCounters[r]=setTimeout(d(function*(){var t;try{return delete n.capacityPriorityCounters[r],yield n.runScript("blacklist_client",[c]),yield n.instance._drainAll(e)}catch(e){return t=e,n.instance.Events.trigger("error",t)}}),1e3)}if("message"===f)return n.instance.Events.trigger("message",i);else if("blocked"===f)return yield n.instance._dropAllQueued()}catch(e){return o=e,n.instance.Events.trigger("error",o)}})()}__disconnect__(e){return(clearInterval(this.heartbeat),this.sharedConnection)?this.connection.__removeLimiter__(this.instance):this.connection.disconnect(e)}runScript(e,t){var n=this;return d(function*(){return"init"!==e&&"register_client"!==e&&(yield n.ready),new n.Promise((r,i)=>{var s,o;return s=[Date.now(),n.clientId].concat(t),n.instance.Events.trigger("debug",`Calling Redis script: ${e}.lua`,s),o=n.connection.__scriptArgs__(e,n.originalId,s,function(e,t){return null!=e?i(e):r(t)}),n.connection.__scriptFn__(e)(...o)}).catch(r=>{if("SETTINGS_KEY_NOT_FOUND"===r.message)if("heartbeat"===e)return n.Promise.resolve();else return n.runScript("init",n.prepareInitSettings(!1)).then(()=>n.runScript(e,t));return"UNKNOWN_CLIENT"===r.message?n.runScript("register_client",[n.instance.queued()]).then(()=>n.runScript(e,t)):n.Promise.reject(r)})})()}prepareArray(e){var t,n,r,i;for(t=0,r=[],n=e.length;t<n;t++)i=e[t],r.push(null!=i?i.toString():"");return r}prepareObject(e){var t,n,r;for(n in t=[],e)r=e[n],t.push(n,null!=r?r.toString():"");return t}prepareInitSettings(e){var t;return(t=this.prepareObject(Object.assign({},this.storeOptions,{id:this.originalId,version:this.instance.version,groupTimeout:this.timeout,clientTimeout:this.clientTimeout}))).unshift(+!!e,this.instance.version),t}convertBool(e){return!!e}__updateSettings__(e){var t=this;return d(function*(){return yield t.runScript("update_settings",t.prepareObject(e)),o.overwrite(e,e,t.storeOptions)})()}__running__(){return this.runScript("running",[])}__queued__(){return this.runScript("queued",[])}__done__(){return this.runScript("done",[])}__groupCheck__(){var e=this;return d(function*(){return e.convertBool((yield e.runScript("group_check",[])))})()}__incrementReservoir__(e){return this.runScript("increment_reservoir",[e])}__currentReservoir__(){return this.runScript("current_reservoir",[])}__check__(e){var t=this;return d(function*(){return t.convertBool((yield t.runScript("check",t.prepareArray([e]))))})()}__register__(e,t,n){var r=this;return d(function*(){var i,s,o,u=a((yield r.runScript("register",r.prepareArray([e,t,n]))),3);return s=u[0],o=u[1],i=u[2],{success:r.convertBool(s),wait:o,reservoir:i}})()}__submit__(e,t){var n=this;return d(function*(){var i,s,o,u,l,c;try{var h=yield n.runScript("submit",n.prepareArray([e,t])),d=a(h,3);return l=d[0],i=d[1],c=d[2],{reachedHWM:n.convertBool(l),blocked:n.convertBool(i),strategy:c}}catch(e){if(0===(s=e).message.indexOf("OVERWEIGHT")){var f=a(s.message.split(":"),3);throw u=f[0],t=f[1],o=f[2],new r(`Impossible to add a job having a weight of ${t} to a limiter having a maxConcurrent setting of ${o}`)}throw s}})()}__free__(e,t){var n=this;return d(function*(){return{running:yield n.runScript("free",n.prepareArray([e]))}})()}}},4035:function(e,t,n){var r,i,s;r={refs:(i=n(2168))["refs.lua"],validate_keys:i["validate_keys.lua"],validate_client:i["validate_client.lua"],refresh_expiration:i["refresh_expiration.lua"],process_tick:i["process_tick.lua"],conditions_check:i["conditions_check.lua"],get_time:i["get_time.lua"]},t.allKeys=function(e){return[`b_${e}_settings`,`b_${e}_job_weights`,`b_${e}_job_expirations`,`b_${e}_job_clients`,`b_${e}_client_running`,`b_${e}_client_num_queued`,`b_${e}_client_last_registered`,`b_${e}_client_last_seen`]},s={init:{keys:t.allKeys,headers:["process_tick"],refresh_expiration:!0,code:i["init.lua"]},group_check:{keys:t.allKeys,headers:[],refresh_expiration:!1,code:i["group_check.lua"]},register_client:{keys:t.allKeys,headers:["validate_keys"],refresh_expiration:!1,code:i["register_client.lua"]},blacklist_client:{keys:t.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:!1,code:i["blacklist_client.lua"]},heartbeat:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:i["heartbeat.lua"]},update_settings:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:i["update_settings.lua"]},running:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:i["running.lua"]},queued:{keys:t.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:!1,code:i["queued.lua"]},done:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:i["done.lua"]},check:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!1,code:i["check.lua"]},submit:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!0,code:i["submit.lua"]},register:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!0,code:i["register.lua"]},free:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:i["free.lua"]},current_reservoir:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:i["current_reservoir.lua"]},increment_reservoir:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:i["increment_reservoir.lua"]}},t.names=Object.keys(s),t.keys=function(e,t){return s[e].keys(t)},t.payload=function(e){var t;return t=s[e],Array.prototype.concat(r.refs,t.headers.map(function(e){return r[e]}),t.refresh_expiration?r.refresh_expiration:"",t.code).join("\n")}},6553:function(e,t,n){var r;r=n(4916),e.exports=class{constructor(e){this.status=e,this._jobs={},this.counts=this.status.map(function(){return 0})}next(e){var t,n;return(n=(t=this._jobs[e])+1,null!=t&&n<this.status.length)?(this.counts[t]--,this.counts[n]++,this._jobs[e]++):null!=t?(this.counts[t]--,delete this._jobs[e]):void 0}start(e){var t;return t=0,this._jobs[e]=t,this.counts[t]++}remove(e){var t;return null!=(t=this._jobs[e])&&(this.counts[t]--,delete this._jobs[e]),null!=t}jobStatus(e){var t;return null!=(t=this.status[this._jobs[e]])?t:null}statusJobs(e){var t,n,i,s;if(null==e)return Object.keys(this._jobs);if((n=this.status.indexOf(e))<0)throw new r(`status must be one of ${this.status.join(", ")}`);for(t in i=this._jobs,s=[],i)i[t]===n&&s.push(t);return s}statusCounts(){return this.counts.reduce((e,t,n)=>(e[this.status[n]]=t,e),{})}}},9124:function(e,t,n){var r;function i(e,t,n,r,i,s,o){try{var a=e[s](o),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,i)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,s){var o=e.apply(t,n);function a(e){i(o,r,s,a,u,"next",e)}function u(e){i(o,r,s,a,u,"throw",e)}a(void 0)})}}r=n(1979),e.exports=class{constructor(e,t){this.schedule=this.schedule.bind(this),this.name=e,this.Promise=t,this._running=0,this._queue=new r}isEmpty(){return 0===this._queue.length}_tryToRun(){var e=this;return s(function*(){var t,n,r,i,o,a,u;if(e._running<1&&e._queue.length>0){e._running++;var l=e._queue.shift();return u=l.task,t=l.args,o=l.resolve,i=l.reject,n=yield s(function*(){try{return a=yield u(...t),function(){return o(a)}}catch(e){return r=e,function(){return i(r)}}})(),e._running--,e._tryToRun(),n()}})()}schedule(e,...t){var n,r,i;return i=r=null,n=new this.Promise(function(e,t){return i=e,r=t}),this._queue.push({task:e,args:t,resolve:i,reject:r}),this._tryToRun(),n}}},1383:function(e,t,n){e.exports=n(1452)},5944:function(e,t){t.load=function(e,t,n={}){var r,i,s;for(r in t)s=t[r],n[r]=null!=(i=e[r])?i:s;return n},t.overwrite=function(e,t,n={}){var r,i;for(r in e)i=e[r],void 0!==t[r]&&(n[r]=i);return n}},1250:function(e,t,n){var r=n(2059);n.o(r,"Effect")&&n.d(t,{Effect:function(){return r.Effect}})},9963:function(e,t,n){var r=n(3876);n.o(r,"oc")&&n.d(t,{oc:function(){return r.oc}});var i=n(9873);n.o(i,"oc")&&n.d(t,{oc:function(){return i.oc}}),n(8607),n(9297),n(7101),n(9644)},8974:function(e,t,n){var r=n(1522);n.o(r,"z")&&n.d(t,{z:function(){return r.z}})},2201:function(e,t,n){n.d(t,{Nu:()=>d});var r=n(3955);n(4399),n(8219);let i=0,s=1,o=2,a=3,u=4,l=5,c=6,h=7;class d{customSerializers;constructor(e={}){if(this.customSerializers=e.customJsonSerializers??[],this.customSerializers.length!==new Set(this.customSerializers.map(e=>e.type)).size)throw Error("Custom serializer type must be unique.")}serialize(e,t=[],n=[],d=[],f=[]){for(let r of this.customSerializers)if(r.condition(e)){let i=this.serialize(r.serialize(e),t,n,d,f);return n.push([r.type,...t]),i}if(e instanceof Blob)return d.push(t),f.push(e),[e,n,d,f];if("bigint"==typeof e)return n.push([i,...t]),[e.toString(),n,d,f];if(e instanceof Date)return(n.push([s,...t]),Number.isNaN(e.getTime()))?[null,n,d,f]:[e.toISOString(),n,d,f];if(Number.isNaN(e))return n.push([o,...t]),[null,n,d,f];if(e instanceof URL)return n.push([u,...t]),[e.toString(),n,d,f];if(e instanceof RegExp)return n.push([l,...t]),[e.toString(),n,d,f];if(e instanceof Set){let r=this.serialize(Array.from(e),t,n,d,f);return n.push([c,...t]),r}if(e instanceof Map){let r=this.serialize(Array.from(e.entries()),t,n,d,f);return n.push([h,...t]),r}if(Array.isArray(e))return[e.map((e,r)=>void 0===e?(n.push([a,...t,r]),e):this.serialize(e,[...t,r],n,d,f)[0]),n,d,f];if((0,r.Gv)(e)){let r={};for(let i in e)("toJSON"!==i||"function"!=typeof e[i])&&(r[i]=this.serialize(e[i],[...t,i],n,d,f)[0]);return[r,n,d,f]}return[e,n,d,f]}deserialize(e,t,n,r){let d={data:e};for(let e of(n&&r&&n.forEach((e,t)=>{let n=d,i="data";e.forEach(e=>{n=n[i],i=e}),n[i]=r(t)}),t)){let t=e[0],n=d,r="data";for(let t=1;t<e.length;t++)n=n[r],r=e[t];for(let e of this.customSerializers)if(e.type===t){n[r]=e.deserialize(n[r]);break}switch(t){case i:n[r]=BigInt(n[r]);break;case s:n[r]=new Date(n[r]??"Invalid Date");break;case o:n[r]=NaN;break;case a:n[r]=void 0;break;case u:n[r]=new URL(n[r]);break;case l:{let[,e,t]=n[r].match(/^\/(.*)\/([a-z]*)$/);n[r]=new RegExp(e,t);break}case c:n[r]=new Set(n[r]);break;case h:n[r]=new Map(n[r])}}return d.data}}},9297:function(e,t,n){n(2201),n(3955),n(4399),n(845).P},7101:function(e,t,n){n(3955),n(4399),n(845).P},9644:function(e,t,n){n(2201),n(3955),n(4399),n(845).P},8607:function(e,t,n){n(845),n(3955)},845:function(e,t,n){n.d(t,{P:()=>i});var r=n(3955);class i{maxBufferedEvents;constructor(e={}){this.maxBufferedEvents=e.maxBufferedEvents??100}subscribe(e,t,n){let i;if("function"==typeof t)return this.subscribeListener(e,t,n);let s=t?.signal,o=t?.maxBufferedEvents??this.maxBufferedEvents;s?.throwIfAborted();let a=[],u=[],l=this.subscribe(e,e=>{let t=u.shift();t?t[0]({done:!1,value:e}):(a.push(e),a.length>o&&a.shift())},{lastEventId:t?.lastEventId,onError:e=>{i={error:e},u.forEach(t=>t[1](e)),s?.removeEventListener("abort",c),u.length=0,a.length=0,l.then(e=>e()).catch(()=>{})}});function c(e){u.forEach(t=>t[1](e.target.reason)),u.length=0,a.length=0,l.then(e=>e()).catch(()=>{})}return s?.addEventListener("abort",c,{once:!0}),new r.Nz(async()=>{if(i)throw i.error;if(s?.aborted)throw s.reason;return(await l,a.length>0)?{done:!1,value:a.shift()}:new Promise((e,t)=>{u.push([e,t])})},async()=>{u.forEach(e=>e[0]({done:!0,value:void 0})),s?.removeEventListener("abort",c),u.length=0,a.length=0,await l.then(e=>e())})}}},8946:function(e,t,n){n.d(t,{A:()=>eG});var r,i,s=9e15,o=1e9,a="0123456789abcdef",u="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",l="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",c={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:9e15,crypto:!1},h=!0,d="[DecimalError] ",f=d+"Invalid argument: ",_=d+"Precision limit exceeded",p=d+"crypto unavailable",v="[object Decimal]",g=Math.floor,m=Math.pow,y=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,b=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,w=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,k=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,x=1e7,E=7,R=0x1fffffffffffff,N=u.length-1,O=l.length-1,I={toStringTag:v};function P(e){var t,n,r,i=e.length-1,s="",o=e[0];if(i>0){for(s+=o,t=1;t<i;t++)(n=E-(r=e[t]+"").length)&&(s+=F(n)),s+=r;(n=E-(r=(o=e[t])+"").length)&&(s+=F(n))}else if(0===o)return"0";for(;o%10==0;)o/=10;return s+o}function S(e,t,n){if(e!==~~e||e<t||e>n)throw Error(f+e)}function q(e,t,n,r){var i,s,o,a;for(s=e[0];s>=10;s/=10)--t;return--t<0?(t+=E,i=0):(i=Math.ceil((t+1)/E),t%=E),s=m(10,E-t),a=e[i]%s|0,null==r?t<3?(0==t?a=a/100|0:1==t&&(a=a/10|0),o=n<4&&99999==a||n>3&&49999==a||5e4==a||0==a):o=(n<4&&a+1==s||n>3&&a+1==s/2)&&(e[i+1]/s/100|0)==m(10,t-2)-1||(a==s/2||0==a)&&(e[i+1]/s/100|0)==0:t<4?(0==t?a=a/1e3|0:1==t?a=a/100|0:2==t&&(a=a/10|0),o=(r||n<4)&&9999==a||!r&&n>3&&4999==a):o=((r||n<4)&&a+1==s||!r&&n>3&&a+1==s/2)&&(e[i+1]/s/1e3|0)==m(10,t-3)-1,o}function A(e,t,n){for(var r,i,s=[0],o=0,u=e.length;o<u;){for(i=s.length;i--;)s[i]*=t;for(s[0]+=a.indexOf(e.charAt(o++)),r=0;r<s.length;r++)s[r]>n-1&&(void 0===s[r+1]&&(s[r+1]=0),s[r+1]+=s[r]/n|0,s[r]%=n)}return s.reverse()}function T(e,t){var n,r,i;if(t.isZero())return t;(r=t.d.length)<32?i=(1/J(4,n=Math.ceil(r/3))).toString():(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=Q(e,1,t.times(i),new e(1));for(var s=n;s--;){var o=t.times(t);t=o.times(o).minus(o).times(8).plus(1)}return e.precision-=n,t}I.absoluteValue=I.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),j(e)},I.ceil=function(){return j(new this.constructor(this),this.e+1,2)},I.clampedTo=I.clamp=function(e,t){var n=this,r=n.constructor;if(e=new r(e),t=new r(t),!e.s||!t.s)return new r(NaN);if(e.gt(t))throw Error(f+t);return 0>n.cmp(e)?e:n.cmp(t)>0?t:new r(n)},I.comparedTo=I.cmp=function(e){var t,n,r,i,s=this,o=s.d,a=(e=new s.constructor(e)).d,u=s.s,l=e.s;if(!o||!a)return u&&l?u!==l?u:o===a?0:!o^u<0?1:-1:NaN;if(!o[0]||!a[0])return o[0]?u:a[0]?-l:0;if(u!==l)return u;if(s.e!==e.e)return s.e>e.e^u<0?1:-1;for(t=0,n=(r=o.length)<(i=a.length)?r:i;t<n;++t)if(o[t]!==a[t])return o[t]>a[t]^u<0?1:-1;return r===i?0:r>i^u<0?1:-1},I.cosine=I.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+E,r.rounding=1,n=T(r,X(r,n)),r.precision=e,r.rounding=t,j(2==i||3==i?n.neg():n,e,t,!0)):new r(1):new r(NaN)},I.cubeRoot=I.cbrt=function(){var e,t,n,r,i,s,o,a,u,l,c=this,d=c.constructor;if(!c.isFinite()||c.isZero())return new d(c);for(h=!1,(s=c.s*m(c.s*c,1/3))&&Math.abs(s)!=1/0?r=new d(s.toString()):(n=P(c.d),(s=((e=c.e)-n.length+1)%3)&&(n+=1==s||-2==s?"0":"00"),s=m(n,1/3),e=g((e+1)/3)-(e%3==(e<0?-1:2)),(r=new d(n=s==1/0?"5e"+e:(n=s.toExponential()).slice(0,n.indexOf("e")+1)+e)).s=c.s),o=(e=d.precision)+3;;)if(r=C((l=(u=(a=r).times(a).times(a)).plus(c)).plus(c).times(a),l.plus(u),o+2,1),P(a.d).slice(0,o)===(n=P(r.d)).slice(0,o)){if("9999"!=(n=n.slice(o-3,o+1))&&(i||"4999"!=n)){+n&&(+n.slice(1)||"5"!=n.charAt(0))||(j(r,e+1,1),t=!r.times(r).times(r).eq(c));break}if(!i&&(j(a,e+1,0),a.times(a).times(a).eq(c))){r=a;break}o+=4,i=1}return h=!0,j(r,e,d.rounding,t)},I.decimalPlaces=I.dp=function(){var e,t=this.d,n=NaN;if(t){if(n=((e=t.length-1)-g(this.e/E))*E,e=t[e])for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n},I.dividedBy=I.div=function(e){return C(this,new this.constructor(e))},I.dividedToIntegerBy=I.divToInt=function(e){var t=this,n=t.constructor;return j(C(t,new n(e),0,1,1),n.precision,n.rounding)},I.equals=I.eq=function(e){return 0===this.cmp(e)},I.floor=function(){return j(new this.constructor(this),this.e+1,3)},I.greaterThan=I.gt=function(e){return this.cmp(e)>0},I.greaterThanOrEqualTo=I.gte=function(e){var t=this.cmp(e);return 1==t||0===t},I.hyperbolicCosine=I.cosh=function(){var e,t,n,r,i,s=this,o=s.constructor,a=new o(1);if(!s.isFinite())return new o(s.s?1/0:NaN);if(s.isZero())return a;n=o.precision,r=o.rounding,o.precision=n+Math.max(s.e,s.sd())+4,o.rounding=1,(i=s.d.length)<32?t=(1/J(4,e=Math.ceil(i/3))).toString():(e=16,t="2.3283064365386962890625e-10"),s=Q(o,1,s.times(t),new o(1),!0);for(var u,l=e,c=new o(8);l--;)u=s.times(s),s=a.minus(u.times(c.minus(u.times(c))));return j(s,o.precision=n,o.rounding=r,!0)},I.hyperbolicSine=I.sinh=function(){var e,t,n,r,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(t=s.precision,n=s.rounding,s.precision=t+Math.max(i.e,i.sd())+4,s.rounding=1,(r=i.d.length)<3)i=Q(s,2,i,i,!0);else{e=(e=1.4*Math.sqrt(r))>16?16:0|e,i=Q(s,2,i=i.times(1/J(5,e)),i,!0);for(var o,a=new s(5),u=new s(16),l=new s(20);e--;)o=i.times(i),i=i.times(a.plus(o.times(u.times(o).plus(l))))}return s.precision=t,s.rounding=n,j(i,t,n,!0)},I.hyperbolicTangent=I.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,C(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)},I.inverseCosine=I.acos=function(){var e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,i=t.rounding;return -1!==n?0===n?e.isNeg()?z(t,r,i):new t(0):new t(NaN):e.isZero()?z(t,r+4,i).times(.5):(t.precision=r+6,t.rounding=1,e=new t(1).minus(e).div(e.plus(1)).sqrt().atan(),t.precision=r,t.rounding=i,e.times(2))},I.inverseHyperbolicCosine=I.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,h=!1,n=n.times(n).minus(1).sqrt().plus(n),h=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)},I.inverseHyperbolicSine=I.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,h=!1,n=n.times(n).plus(1).sqrt().plus(n),h=!0,r.precision=e,r.rounding=t,n.ln())},I.inverseHyperbolicTangent=I.atanh=function(){var e,t,n,r,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=s.precision,t=s.rounding,Math.max(r=i.sd(),e)<-(2*i.e)-1)?j(new s(i),e,t,!0):(s.precision=n=r-i.e,i=C(i.plus(1),new s(1).minus(i),n+e,1),s.precision=e+4,s.rounding=1,i=i.ln(),s.precision=e,s.rounding=t,i.times(.5)):new s(NaN)},I.inverseSine=I.asin=function(){var e,t,n,r,i=this,s=i.constructor;return i.isZero()?new s(i):(t=i.abs().cmp(1),n=s.precision,r=s.rounding,-1!==t)?0===t?((e=z(s,n+4,r).times(.5)).s=i.s,e):new s(NaN):(s.precision=n+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=n,s.rounding=r,i.times(2))},I.inverseTangent=I.atan=function(){var e,t,n,r,i,s,o,a,u,l=this,c=l.constructor,d=c.precision,f=c.rounding;if(l.isFinite()){if(l.isZero())return new c(l);else if(l.abs().eq(1)&&d+4<=O)return(o=z(c,d+4,f).times(.25)).s=l.s,o}else{if(!l.s)return new c(NaN);if(d+4<=O)return(o=z(c,d+4,f).times(.5)).s=l.s,o}for(c.precision=a=d+10,c.rounding=1,e=n=Math.min(28,a/E+2|0);e;--e)l=l.div(l.times(l).plus(1).sqrt().plus(1));for(h=!1,t=Math.ceil(a/E),r=1,u=l.times(l),o=new c(l),i=l;-1!==e;)if(i=i.times(u),s=o.minus(i.div(r+=2)),i=i.times(u),void 0!==(o=s.plus(i.div(r+=2))).d[t])for(e=t;o.d[e]===s.d[e]&&e--;);return n&&(o=o.times(2<<n-1)),h=!0,j(o,c.precision=d,c.rounding=f,!0)},I.isFinite=function(){return!!this.d},I.isInteger=I.isInt=function(){return!!this.d&&g(this.e/E)>this.d.length-2},I.isNaN=function(){return!this.s},I.isNegative=I.isNeg=function(){return this.s<0},I.isPositive=I.isPos=function(){return this.s>0},I.isZero=function(){return!!this.d&&0===this.d[0]},I.lessThan=I.lt=function(e){return 0>this.cmp(e)},I.lessThanOrEqualTo=I.lte=function(e){return 1>this.cmp(e)},I.logarithm=I.log=function(e){var t,n,r,i,s,o,a,u,l=this,c=l.constructor,d=c.precision,f=c.rounding,_=5;if(null==e)e=new c(10),t=!0;else{if(n=(e=new c(e)).d,e.s<0||!n||!n[0]||e.eq(1))return new c(NaN);t=e.eq(10)}if(n=l.d,l.s<0||!n||!n[0]||l.eq(1))return new c(n&&!n[0]?-1/0:1!=l.s?NaN:n?0:1/0);if(t)if(n.length>1)s=!0;else{for(i=n[0];i%10==0;)i/=10;s=1!==i}if(h=!1,q((u=C(o=V(l,a=d+_),r=t?M(c,a+10):V(e,a),a,1)).d,i=d,f))do if(a+=10,u=C(o=V(l,a),r=t?M(c,a+10):V(e,a),a,1),!s){+P(u.d).slice(i+1,i+15)+1==1e14&&(u=j(u,d+1,0));break}while(q(u.d,i+=10,f));return h=!0,j(u,d,f)},I.minus=I.sub=function(e){var t,n,r,i,s,o,a,u,l,c,d,f,_=this,p=_.constructor;if(e=new p(e),!_.d||!e.d)return _.s&&e.s?_.d?e.s=-e.s:e=new p(e.d||_.s!==e.s?_:NaN):e=new p(NaN),e;if(_.s!=e.s)return e.s=-e.s,_.plus(e);if(l=_.d,f=e.d,a=p.precision,u=p.rounding,!l[0]||!f[0]){if(f[0])e.s=-e.s;else{if(!l[0])return new p(3===u?-0:0);e=new p(_)}return h?j(e,a,u):e}if(n=g(e.e/E),c=g(_.e/E),l=l.slice(),s=c-n){for((d=s<0)?(t=l,s=-s,o=f.length):(t=f,n=c,o=l.length),s>(r=Math.max(Math.ceil(a/E),o)+2)&&(s=r,t.length=1),t.reverse(),r=s;r--;)t.push(0);t.reverse()}else{for((d=(r=l.length)<(o=f.length))&&(o=r),r=0;r<o;r++)if(l[r]!=f[r]){d=l[r]<f[r];break}s=0}for(d&&(t=l,l=f,f=t,e.s=-e.s),o=l.length,r=f.length-o;r>0;--r)l[o++]=0;for(r=f.length;r>s;){if(l[--r]<f[r]){for(i=r;i&&0===l[--i];)l[i]=x-1;--l[i],l[r]+=x}l[r]-=f[r]}for(;0===l[--o];)l.pop();for(;0===l[0];l.shift())--n;return l[0]?(e.d=l,e.e=L(l,n),h?j(e,a,u):e):new p(3===u?-0:0)},I.modulo=I.mod=function(e){var t,n=this,r=n.constructor;return(e=new r(e),n.d&&e.s&&(!e.d||e.d[0]))?e.d&&(!n.d||n.d[0])?(h=!1,9==r.modulo?(t=C(n,e.abs(),0,3,1),t.s*=e.s):t=C(n,e,0,r.modulo,1),t=t.times(e),h=!0,n.minus(t)):j(new r(n),r.precision,r.rounding):new r(NaN)},I.naturalExponential=I.exp=function(){return U(this)},I.naturalLogarithm=I.ln=function(){return V(this)},I.negated=I.neg=function(){var e=new this.constructor(this);return e.s=-e.s,j(e)},I.plus=I.add=function(e){var t,n,r,i,s,o,a,u,l,c,d=this,f=d.constructor;if(e=new f(e),!d.d||!e.d)return d.s&&e.s?d.d||(e=new f(e.d||d.s===e.s?d:NaN)):e=new f(NaN),e;if(d.s!=e.s)return e.s=-e.s,d.minus(e);if(l=d.d,c=e.d,a=f.precision,u=f.rounding,!l[0]||!c[0])return c[0]||(e=new f(d)),h?j(e,a,u):e;if(s=g(d.e/E),r=g(e.e/E),l=l.slice(),i=s-r){for(i<0?(n=l,i=-i,o=c.length):(n=c,r=s,o=l.length),i>(o=(s=Math.ceil(a/E))>o?s+1:o+1)&&(i=o,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for((o=l.length)-(i=c.length)<0&&(i=o,n=c,c=l,l=n),t=0;i;)t=(l[--i]=l[i]+c[i]+t)/x|0,l[i]%=x;for(t&&(l.unshift(t),++r),o=l.length;0==l[--o];)l.pop();return e.d=l,e.e=L(l,r),h?j(e,a,u):e},I.precision=I.sd=function(e){var t,n=this;if(void 0!==e&&!!e!==e&&1!==e&&0!==e)throw Error(f+e);return n.d?(t=$(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t},I.round=function(){var e=this,t=e.constructor;return j(new t(e),e.e+1,t.rounding)},I.sine=I.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+E,r.rounding=1,n=Y(r,X(r,n)),r.precision=e,r.rounding=t,j(i>2?n.neg():n,e,t,!0)):new r(NaN)},I.squareRoot=I.sqrt=function(){var e,t,n,r,i,s,o=this,a=o.d,u=o.e,l=o.s,c=o.constructor;if(1!==l||!a||!a[0])return new c(!l||l<0&&(!a||a[0])?NaN:a?o:1/0);for(h=!1,0==(l=Math.sqrt(+o))||l==1/0?(((t=P(a)).length+u)%2==0&&(t+="0"),l=Math.sqrt(t),u=g((u+1)/2)-(u<0||u%2),r=new c(t=l==1/0?"5e"+u:(t=l.toExponential()).slice(0,t.indexOf("e")+1)+u)):r=new c(l.toString()),n=(u=c.precision)+3;;)if(r=(s=r).plus(C(o,s,n+2,1)).times(.5),P(s.d).slice(0,n)===(t=P(r.d)).slice(0,n)){if("9999"!=(t=t.slice(n-3,n+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(j(r,u+1,1),e=!r.times(r).eq(o));break}if(!i&&(j(s,u+1,0),s.times(s).eq(o))){r=s;break}n+=4,i=1}return h=!0,j(r,u,c.rounding,e)},I.tangent=I.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,(n=n.sin()).s=1,n=C(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,j(2==i||4==i?n.neg():n,e,t,!0)):new r(NaN)},I.times=I.mul=function(e){var t,n,r,i,s,o,a,u,l,c=this,d=c.constructor,f=c.d,_=(e=new d(e)).d;if(e.s*=c.s,!f||!f[0]||!_||!_[0])return new d(!e.s||f&&!f[0]&&!_||_&&!_[0]&&!f?NaN:!f||!_?e.s/0:0*e.s);for(n=g(c.e/E)+g(e.e/E),(u=f.length)<(l=_.length)&&(s=f,f=_,_=s,o=u,u=l,l=o),s=[],r=o=u+l;r--;)s.push(0);for(r=l;--r>=0;){for(t=0,i=u+r;i>r;)a=s[i]+_[r]*f[i-r-1]+t,s[i--]=a%x|0,t=a/x|0;s[i]=(s[i]+t)%x|0}for(;!s[--o];)s.pop();return t?++n:s.shift(),e.d=s,e.e=L(s,n),h?j(e,d.precision,d.rounding):e},I.toBinary=function(e,t){return ee(this,2,e,t)},I.toDecimalPlaces=I.toDP=function(e,t){var n=this,r=n.constructor;return(n=new r(n),void 0===e)?n:(S(e,0,o),void 0===t?t=r.rounding:S(t,0,8),j(n,e+n.e+1,t))},I.toExponential=function(e,t){var n,r=this,i=r.constructor;return void 0===e?n=D(r,!0):(S(e,0,o),void 0===t?t=i.rounding:S(t,0,8),n=D(r=j(new i(r),e+1,t),!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n},I.toFixed=function(e,t){var n,r,i=this,s=i.constructor;return void 0===e?n=D(i):(S(e,0,o),void 0===t?t=s.rounding:S(t,0,8),n=D(r=j(new s(i),e+i.e+1,t),!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n},I.toFraction=function(e){var t,n,r,i,s,o,a,u,l,c,d,_,p=this,v=p.d,g=p.constructor;if(!v)return new g(p);if(l=n=new g(1),r=u=new g(0),o=(s=(t=new g(r)).e=$(v)-p.e-1)%E,t.d[0]=m(10,o<0?E+o:o),null==e)e=s>0?t:l;else{if(!(a=new g(e)).isInt()||a.lt(l))throw Error(f+a);e=a.gt(t)?s>0?t:l:a}for(h=!1,a=new g(P(v)),c=g.precision,g.precision=s=v.length*E*2;d=C(a,t,0,1,1),1!=(i=n.plus(d.times(r))).cmp(e);)n=r,r=i,i=l,l=u.plus(d.times(i)),u=i,i=t,t=a.minus(d.times(i)),a=i;return i=C(e.minus(n),r,0,1,1),u=u.plus(i.times(l)),n=n.plus(i.times(r)),u.s=l.s=p.s,_=1>C(l,r,s,1).minus(p).abs().cmp(C(u,n,s,1).minus(p).abs())?[l,r]:[u,n],g.precision=c,h=!0,_},I.toHexadecimal=I.toHex=function(e,t){return ee(this,16,e,t)},I.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),null==e){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),void 0===t?t=r.rounding:S(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(h=!1,n=C(n,e,0,t,1).times(e),h=!0,j(n)):(e.s=n.s,n=e),n},I.toNumber=function(){return+this},I.toOctal=function(e,t){return ee(this,8,e,t)},I.toPower=I.pow=function(e){var t,n,r,i,s,o,a=this,u=a.constructor,l=+(e=new u(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new u(m(+a,l));if((a=new u(a)).eq(1))return a;if(r=u.precision,s=u.rounding,e.eq(1))return j(a,r,s);if((t=g(e.e/E))>=e.d.length-1&&(n=l<0?-l:l)<=R)return i=K(u,a,n,r),e.s<0?new u(1).div(i):j(i,r,s);if((o=a.s)<0){if(t<e.d.length-1)return new u(NaN);if((1&e.d[t])==0&&(o=1),0==a.e&&1==a.d[0]&&1==a.d.length)return a.s=o,a}return(t=0!=(n=m(+a,l))&&isFinite(n)?new u(n+"").e:g(l*(Math.log("0."+P(a.d))/Math.LN10+a.e+1)))>u.maxE+1||t<u.minE-1?new u(t>0?o/0:0):(h=!1,u.rounding=a.s=1,n=Math.min(12,(t+"").length),(i=U(e.times(V(a,r+n)),r)).d&&q((i=j(i,r+5,1)).d,r,s)&&(t=r+10,+P((i=j(U(e.times(V(a,t+n)),t),t+5,1)).d).slice(r+1,r+15)+1==1e14&&(i=j(i,r+1,0))),i.s=o,h=!0,u.rounding=s,j(i,r,s))},I.toPrecision=function(e,t){var n,r=this,i=r.constructor;return void 0===e?n=D(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(S(e,1,o),void 0===t?t=i.rounding:S(t,0,8),n=D(r=j(new i(r),e,t),e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n},I.toSignificantDigits=I.toSD=function(e,t){var n=this,r=n.constructor;return void 0===e?(e=r.precision,t=r.rounding):(S(e,1,o),void 0===t?t=r.rounding:S(t,0,8)),j(new r(n),e,t)},I.toString=function(){var e=this,t=e.constructor,n=D(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n},I.truncated=I.trunc=function(){return j(new this.constructor(this),this.e+1,1)},I.valueOf=I.toJSON=function(){var e=this,t=e.constructor,n=D(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};var C=function(){function e(e,t,n){var r,i=0,s=e.length;for(e=e.slice();s--;)r=e[s]*t+i,e[s]=r%n|0,i=r/n|0;return i&&e.unshift(i),e}function t(e,t,n,r){var i,s;if(n!=r)s=n>r?1:-1;else for(i=s=0;i<n;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function n(e,t,n,r){for(var i=0;n--;)e[n]-=i,i=+(e[n]<t[n]),e[n]=i*r+e[n]-t[n];for(;!e[0]&&e.length>1;)e.shift()}return function(i,s,o,a,u,l){var c,h,d,f,_,p,v,m,y,b,w,k,R,N,O,I,P,S,q,A,T=i.constructor,C=i.s==s.s?1:-1,D=i.d,L=s.d;if(!D||!D[0]||!L||!L[0])return new T(!i.s||!s.s||(D?L&&D[0]==L[0]:!L)?NaN:D&&0==D[0]||!L?0*C:C/0);for(l?(_=1,h=i.e-s.e):(l=x,_=E,h=g(i.e/_)-g(s.e/_)),q=L.length,P=D.length,b=(y=new T(C)).d=[],d=0;L[d]==(D[d]||0);d++);if(L[d]>(D[d]||0)&&h--,null==o?(N=o=T.precision,a=T.rounding):N=u?o+(i.e-s.e)+1:o,N<0)b.push(1),p=!0;else{if(N=N/_+2|0,d=0,1==q){for(f=0,L=L[0],N++;(d<P||f)&&N--;d++)O=f*l+(D[d]||0),b[d]=O/L|0,f=O%L|0;p=f||d<P}else{for((f=l/(L[0]+1)|0)>1&&(L=e(L,f,l),D=e(D,f,l),q=L.length,P=D.length),I=q,k=(w=D.slice(0,q)).length;k<q;)w[k++]=0;(A=L.slice()).unshift(0),S=L[0],L[1]>=l/2&&++S;do f=0,(c=t(L,w,q,k))<0?(R=w[0],q!=k&&(R=R*l+(w[1]||0)),(f=R/S|0)>1?(f>=l&&(f=l-1),m=(v=e(L,f,l)).length,k=w.length,1==(c=t(v,w,m,k))&&(f--,n(v,q<m?A:L,m,l))):(0==f&&(c=f=1),v=L.slice()),(m=v.length)<k&&v.unshift(0),n(w,v,k,l),-1==c&&(k=w.length,(c=t(L,w,q,k))<1&&(f++,n(w,q<k?A:L,k,l))),k=w.length):0===c&&(f++,w=[0]),b[d++]=f,c&&w[0]?w[k++]=D[I]||0:(w=[D[I]],k=1);while((I++<P||void 0!==w[0])&&N--);p=void 0!==w[0]}b[0]||b.shift()}if(1==_)y.e=h,r=p;else{for(d=1,f=b[0];f>=10;f/=10)d++;y.e=d+h*_-1,j(y,u?o+y.e+1:o,a,p)}return y}}();function j(e,t,n,r){var i,s,o,a,u,l,c,d,f,_=e.constructor;e:if(null!=t){if(!(d=e.d))return e;for(i=1,a=d[0];a>=10;a/=10)i++;if((s=t-i)<0)s+=E,o=t,u=(c=d[f=0])/m(10,i-o-1)%10|0;else if((f=Math.ceil((s+1)/E))>=(a=d.length))if(r){for(;a++<=f;)d.push(0);c=u=0,i=1,s%=E,o=s-E+1}else break e;else{for(i=1,c=a=d[f];a>=10;a/=10)i++;s%=E,u=(o=s-E+i)<0?0:c/m(10,i-o-1)%10|0}if(r=r||t<0||void 0!==d[f+1]||(o<0?c:c%m(10,i-o-1)),l=n<4?(u||r)&&(0==n||n==(e.s<0?3:2)):u>5||5==u&&(4==n||r||6==n&&(s>0?o>0?c/m(10,i-o):0:d[f-1])%10&1||n==(e.s<0?8:7)),t<1||!d[0])return d.length=0,l?(t-=e.e+1,d[0]=m(10,(E-t%E)%E),e.e=-t||0):d[0]=e.e=0,e;if(0==s?(d.length=f,a=1,f--):(d.length=f+1,a=m(10,E-s),d[f]=o>0?(c/m(10,i-o)%m(10,o)|0)*a:0),l)for(;;)if(0==f){for(s=1,o=d[0];o>=10;o/=10)s++;for(o=d[0]+=a,a=1;o>=10;o/=10)a++;s!=a&&(e.e++,d[0]==x&&(d[0]=1));break}else{if(d[f]+=a,d[f]!=x)break;d[f--]=0,a=1}for(s=d.length;0===d[--s];)d.pop()}return h&&(e.e>_.maxE?(e.d=null,e.e=NaN):e.e<_.minE&&(e.e=0,e.d=[0])),e}function D(e,t,n){if(!e.isFinite())return W(e);var r,i=e.e,s=P(e.d),o=s.length;return t?(n&&(r=n-o)>0?s=s.charAt(0)+"."+s.slice(1)+F(r):o>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(e.e<0?"e":"e+")+e.e):i<0?(s="0."+F(-i-1)+s,n&&(r=n-o)>0&&(s+=F(r))):i>=o?(s+=F(i+1-o),n&&(r=n-i-1)>0&&(s=s+"."+F(r))):((r=i+1)<o&&(s=s.slice(0,r)+"."+s.slice(r)),n&&(r=n-o)>0&&(i+1===o&&(s+="."),s+=F(r))),s}function L(e,t){var n=e[0];for(t*=E;n>=10;n/=10)t++;return t}function M(e,t,n){if(t>N)throw h=!0,n&&(e.precision=n),Error(_);return j(new e(u),t,1,!0)}function z(e,t,n){if(t>O)throw Error(_);return j(new e(l),t,n,!0)}function $(e){var t=e.length-1,n=t*E+1;if(t=e[t]){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function F(e){for(var t="";e--;)t+="0";return t}function K(e,t,n,r){var i,s=new e(1),o=Math.ceil(r/E+4);for(h=!1;;){if(n%2&&et((s=s.times(t)).d,o)&&(i=!0),0===(n=g(n/2))){n=s.d.length-1,i&&0===s.d[n]&&++s.d[n];break}et((t=t.times(t)).d,o)}return h=!0,s}function B(e){return 1&e.d[e.d.length-1]}function G(e,t,n){for(var r,i,s=new e(t[0]),o=0;++o<t.length;){if(!(i=new e(t[o])).s){s=i;break}((r=s.cmp(i))===n||0===r&&s.s===n)&&(s=i)}return s}function U(e,t){var n,r,i,s,o,a,u,l=0,c=0,d=0,f=e.constructor,_=f.rounding,p=f.precision;if(!e.d||!e.d[0]||e.e>17)return new f(e.d?!e.d[0]?1:e.s<0?0:1/0:e.s?e.s<0?0:e:0/0);for(null==t?(h=!1,u=p):u=t,a=new f(.03125);e.e>-2;)e=e.times(a),d+=5;for(u+=r=Math.log(m(2,d))/Math.LN10*2+5|0,n=s=o=new f(1),f.precision=u;;){if(s=j(s.times(e),u,1),n=n.times(++c),P((a=o.plus(C(s,n,u,1))).d).slice(0,u)===P(o.d).slice(0,u)){for(i=d;i--;)o=j(o.times(o),u,1);if(null!=t)return f.precision=p,o;if(!(l<3&&q(o.d,u-r,_,l)))return j(o,f.precision=p,_,h=!0);f.precision=u+=10,n=s=a=new f(1),c=0,l++}o=a}}function V(e,t){var n,r,i,s,o,a,u,l,c,d,f,_=1,p=10,v=e,g=v.d,m=v.constructor,y=m.rounding,b=m.precision;if(v.s<0||!g||!g[0]||!v.e&&1==g[0]&&1==g.length)return new m(g&&!g[0]?-1/0:1!=v.s?NaN:g?0:v);if(null==t?(h=!1,c=b):c=t,m.precision=c+=p,r=(n=P(g)).charAt(0),!(15e14>Math.abs(s=v.e)))return l=M(m,c+2,b).times(s+""),v=V(new m(r+"."+n.slice(1)),c-p).plus(l),m.precision=b,null==t?j(v,b,y,h=!0):v;for(;r<7&&1!=r||1==r&&n.charAt(1)>3;)r=(n=P((v=v.times(e)).d)).charAt(0),_++;for(s=v.e,r>1?(v=new m("0."+n),s++):v=new m(r+"."+n.slice(1)),d=v,u=o=v=C(v.minus(1),v.plus(1),c,1),f=j(v.times(v),c,1),i=3;;){if(o=j(o.times(f),c,1),P((l=u.plus(C(o,new m(i),c,1))).d).slice(0,c)===P(u.d).slice(0,c)){if(u=u.times(2),0!==s&&(u=u.plus(M(m,c+2,b).times(s+""))),u=C(u,new m(_),c,1),null!=t)return m.precision=b,u;if(!q(u.d,c-p,y,a))return j(u,m.precision=b,y,h=!0);m.precision=c+=p,l=o=v=C(d.minus(1),d.plus(1),c,1),f=j(v.times(v),c,1),i=a=1}u=l,i+=2}}function W(e){return String(e.s*e.s/0)}function Z(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;48===t.charCodeAt(r);r++);for(i=t.length;48===t.charCodeAt(i-1);--i);if(t=t.slice(r,i)){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%E,n<0&&(r+=E),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=E;r<i;)e.d.push(+t.slice(r,r+=E));r=E-(t=t.slice(r)).length}else r-=i;for(;r--;)t+="0";e.d.push(+t),h&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function H(e,t){var n,r,i,s,o,a,u,l,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),k.test(t))return Z(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(b.test(t))n=16,t=t.toLowerCase();else if(y.test(t))n=2;else if(w.test(t))n=8;else throw Error(f+t);for((s=t.search(/p/i))>0?(u=+t.slice(s+1),t=t.substring(2,s)):t=t.slice(2),o=(s=t.indexOf("."))>=0,r=e.constructor,o&&(s=(a=(t=t.replace(".","")).length)-s,i=K(r,new r(n),s,2*s)),s=c=(l=A(t,n,x)).length-1;0===l[s];--s)l.pop();return s<0?new r(0*e.s):(e.e=L(l,c),e.d=l,h=!1,o&&(e=C(e,i,4*a)),u&&(e=e.times(54>Math.abs(u)?m(2,u):eB.pow(2,u))),h=!0,e)}function Y(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:Q(e,2,t,t);n=(n=1.4*Math.sqrt(r))>16?16:0|n,t=Q(e,2,t=t.times(1/J(5,n)),t);for(var i,s=new e(5),o=new e(16),a=new e(20);n--;)i=t.times(t),t=t.times(s.plus(i.times(o.times(i).minus(a))));return t}function Q(e,t,n,r,i){var s,o,a,u,l=e.precision,c=Math.ceil(l/E);for(h=!1,u=n.times(n),a=new e(r);;){if(o=C(a.times(u),new e(t++*t++),l,1),a=i?r.plus(o):r.minus(o),r=C(o.times(u),new e(t++*t++),l,1),void 0!==(o=a.plus(r)).d[c]){for(s=c;o.d[s]===a.d[s]&&s--;);if(-1==s)break}s=a,a=r,r=o,o=s}return h=!0,o.d.length=c+1,o}function J(e,t){for(var n=e;--t;)n*=e;return n}function X(e,t){var n,r=t.s<0,s=z(e,e.precision,1),o=s.times(.5);if((t=t.abs()).lte(o))return i=r?4:1,t;if((n=t.divToInt(s)).isZero())i=r?3:2;else{if((t=t.minus(n.times(s))).lte(o))return i=B(n)?r?2:3:r?4:1,t;i=B(n)?r?1:4:r?3:2}return t.minus(s).abs()}function ee(e,t,n,i){var s,u,l,c,h,d,f,_,p,v=e.constructor,g=void 0!==n;if(g?(S(n,1,o),void 0===i?i=v.rounding:S(i,0,8)):(n=v.precision,i=v.rounding),e.isFinite()){for(l=(f=D(e)).indexOf("."),g?(s=2,16==t?n=4*n-3:8==t&&(n=3*n-2)):s=t,l>=0&&(f=f.replace(".",""),(p=new v(1)).e=f.length-l,p.d=A(D(p),10,s),p.e=p.d.length),u=h=(_=A(f,10,s)).length;0==_[--h];)_.pop();if(_[0]){if(l<0?u--:((e=new v(e)).d=_,e.e=u,_=(e=C(e,p,n,i,0,s)).d,u=e.e,d=r),l=_[n],c=s/2,d=d||void 0!==_[n+1],d=i<4?(void 0!==l||d)&&(0===i||i===(e.s<0?3:2)):l>c||l===c&&(4===i||d||6===i&&1&_[n-1]||i===(e.s<0?8:7)),_.length=n,d)for(;++_[--n]>s-1;)_[n]=0,n||(++u,_.unshift(1));for(h=_.length;!_[h-1];--h);for(l=0,f="";l<h;l++)f+=a.charAt(_[l]);if(g){if(h>1)if(16==t||8==t){for(l=16==t?4:3,--h;h%l;h++)f+="0";for(h=(_=A(f,s,t)).length;!_[h-1];--h);for(l=1,f="1.";l<h;l++)f+=a.charAt(_[l])}else f=f.charAt(0)+"."+f.slice(1);f=f+(u<0?"p":"p+")+u}else if(u<0){for(;++u;)f="0"+f;f="0."+f}else if(++u>h)for(u-=h;u--;)f+="0";else u<h&&(f=f.slice(0,u)+"."+f.slice(u))}else f=g?"0p+0":"0";f=(16==t?"0x":2==t?"0b":8==t?"0o":"")+f}else f=W(e);return e.s<0?"-"+f:f}function et(e,t){if(e.length>t)return e.length=t,!0}function en(e){return new this(e).abs()}function er(e){return new this(e).acos()}function ei(e){return new this(e).acosh()}function es(e,t){return new this(e).plus(t)}function eo(e){return new this(e).asin()}function ea(e){return new this(e).asinh()}function eu(e){return new this(e).atan()}function el(e){return new this(e).atanh()}function ec(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,s=r+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(n=t.s<0?z(this,r,i):new this(0)).s=e.s:!e.d||t.isZero()?(n=z(this,s,1).times(.5)).s=e.s:t.s<0?(this.precision=s,this.rounding=1,n=this.atan(C(e,t,s,1)),t=z(this,s,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(C(e,t,s,1)):(n=z(this,s,1).times(t.s>0?.25:.75)).s=e.s:n=new this(NaN),n}function eh(e){return new this(e).cbrt()}function ed(e){return j(e=new this(e),e.e+1,2)}function ef(e,t,n){return new this(e).clamp(t,n)}function e_(e){if(!e||"object"!=typeof e)throw Error(d+"Object expected");var t,n,r,i=!0===e.defaults,a=["precision",1,o,"rounding",0,8,"toExpNeg",-s,0,"toExpPos",0,s,"maxE",0,s,"minE",-s,0,"modulo",0,9];for(t=0;t<a.length;t+=3)if(n=a[t],i&&(this[n]=c[n]),void 0!==(r=e[n]))if(g(r)===r&&r>=a[t+1]&&r<=a[t+2])this[n]=r;else throw Error(f+n+": "+r);if(n="crypto",i&&(this[n]=c[n]),void 0!==(r=e[n]))if(!0===r||!1===r||0===r||1===r)if(r)if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(p);else this[n]=!1;else throw Error(f+n+": "+r);return this}function ep(e){return new this(e).cos()}function ev(e){return new this(e).cosh()}function eg(e){var t,n,r;function i(e){var t,n,r,s=this;if(!(s instanceof i))return new i(e);if(s.constructor=i,ek(e)){s.s=e.s,h?!e.d||e.e>i.maxE?(s.e=NaN,s.d=null):e.e<i.minE?(s.e=0,s.d=[0]):(s.e=e.e,s.d=e.d.slice()):(s.e=e.e,s.d=e.d?e.d.slice():e.d);return}if("number"==(r=typeof e)){if(0===e){s.s=1/e<0?-1:1,s.e=0,s.d=[0];return}if(e<0?(e=-e,s.s=-1):s.s=1,e===~~e&&e<1e7){for(t=0,n=e;n>=10;n/=10)t++;h?t>i.maxE?(s.e=NaN,s.d=null):t<i.minE?(s.e=0,s.d=[0]):(s.e=t,s.d=[e]):(s.e=t,s.d=[e]);return}if(0*e!=0){e||(s.s=NaN),s.e=NaN,s.d=null;return}return Z(s,e.toString())}if("string"===r)return 45===(n=e.charCodeAt(0))?(e=e.slice(1),s.s=-1):(43===n&&(e=e.slice(1)),s.s=1),k.test(e)?Z(s,e):H(s,e);if("bigint"===r)return e<0?(e=-e,s.s=-1):s.s=1,Z(s,e.toString());throw Error(f+e)}if(i.prototype=I,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=e_,i.clone=eg,i.isDecimal=ek,i.abs=en,i.acos=er,i.acosh=ei,i.add=es,i.asin=eo,i.asinh=ea,i.atan=eu,i.atanh=el,i.atan2=ec,i.cbrt=eh,i.ceil=ed,i.clamp=ef,i.cos=ep,i.cosh=ev,i.div=em,i.exp=ey,i.floor=eb,i.hypot=ew,i.ln=ex,i.log=eE,i.log10=eN,i.log2=eR,i.max=eO,i.min=eI,i.mod=eP,i.mul=eS,i.pow=eq,i.random=eA,i.round=eT,i.sign=eC,i.sin=ej,i.sinh=eD,i.sqrt=eL,i.sub=eM,i.sum=ez,i.tan=e$,i.tanh=eF,i.trunc=eK,void 0===e&&(e={}),e&&!0!==e.defaults)for(t=0,r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"];t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return i.config(e),i}function em(e,t){return new this(e).div(t)}function ey(e){return new this(e).exp()}function eb(e){return j(e=new this(e),e.e+1,3)}function ew(){var e,t,n=new this(0);for(e=0,h=!1;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return h=!0,new this(1/0);n=t}return h=!0,n.sqrt()}function ek(e){return e instanceof eB||e&&e.toStringTag===v||!1}function ex(e){return new this(e).ln()}function eE(e,t){return new this(e).log(t)}function eR(e){return new this(e).log(2)}function eN(e){return new this(e).log(10)}function eO(){return G(this,arguments,-1)}function eI(){return G(this,arguments,1)}function eP(e,t){return new this(e).mod(t)}function eS(e,t){return new this(e).mul(t)}function eq(e,t){return new this(e).pow(t)}function eA(e){var t,n,r,i,s=0,a=new this(1),u=[];if(void 0===e?e=this.precision:S(e,1,o),r=Math.ceil(e/E),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));s<r;)(i=t[s])>=429e7?t[s]=crypto.getRandomValues(new Uint32Array(1))[0]:u[s++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);s<r;)(i=t[s]+(t[s+1]<<8)+(t[s+2]<<16)+((127&t[s+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,s):(u.push(i%1e7),s+=4);s=r/4}else throw Error(p);else for(;s<r;)u[s++]=1e7*Math.random()|0;for(r=u[--s],e%=E,r&&e&&(i=m(10,E-e),u[s]=(r/i|0)*i);0===u[s];s--)u.pop();if(s<0)n=0,u=[0];else{for(n=-1;0===u[0];n-=E)u.shift();for(r=1,i=u[0];i>=10;i/=10)r++;r<E&&(n-=E-r)}return a.e=n,a.d=u,a}function eT(e){return j(e=new this(e),e.e+1,this.rounding)}function eC(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function ej(e){return new this(e).sin()}function eD(e){return new this(e).sinh()}function eL(e){return new this(e).sqrt()}function eM(e,t){return new this(e).sub(t)}function ez(){var e=0,t=arguments,n=new this(t[0]);for(h=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return h=!0,j(n,this.precision,this.rounding)}function e$(e){return new this(e).tan()}function eF(e){return new this(e).tanh()}function eK(e){return j(e=new this(e),e.e+1,1)}I[Symbol.for("nodejs.util.inspect.custom")]=I.toString,I[Symbol.toStringTag]="Decimal";var eB=I.constructor=eg(c);u=new eB(u),l=new eB(l);let eG=eB},2168:function(e){e.exports=JSON.parse("{\"blacklist_client.lua\":\"local blacklist = ARGV[num_static_argv + 1]\\n\\nif redis.call('zscore', client_last_seen_key, blacklist) then\\n  redis.call('zadd', client_last_seen_key, 0, blacklist)\\nend\\n\\n\\nreturn {}\\n\",\"check.lua\":\"local weight = tonumber(ARGV[num_static_argv + 1])\\n\\nlocal capacity = process_tick(now, false)['capacity']\\nlocal nextRequest = tonumber(redis.call('hget', settings_key, 'nextRequest'))\\n\\nreturn conditions_check(capacity, weight) and nextRequest - now <= 0\\n\",\"conditions_check.lua\":\"local conditions_check = function (capacity, weight)\\n  return capacity == nil or weight <= capacity\\nend\\n\",\"current_reservoir.lua\":\"return process_tick(now, false)['reservoir']\\n\",\"done.lua\":\"process_tick(now, false)\\n\\nreturn tonumber(redis.call('hget', settings_key, 'done'))\\n\",\"free.lua\":\"local index = ARGV[num_static_argv + 1]\\n\\nredis.call('zadd', job_expirations_key, 0, index)\\n\\nreturn process_tick(now, false)['running']\\n\",\"get_time.lua\":\"redis.replicate_commands()\\n\\nlocal get_time = function ()\\n  local time = redis.call('time')\\n\\n  return tonumber(time[1]..string.sub(time[2], 1, 3))\\nend\\n\",\"group_check.lua\":\"return not (redis.call('exists', settings_key) == 1)\\n\",\"heartbeat.lua\":\"process_tick(now, true)\\n\",\"increment_reservoir.lua\":\"local incr = tonumber(ARGV[num_static_argv + 1])\\n\\nredis.call('hincrby', settings_key, 'reservoir', incr)\\n\\nlocal reservoir = process_tick(now, true)['reservoir']\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn reservoir\\n\",\"init.lua\":\"local clear = tonumber(ARGV[num_static_argv + 1])\\nlocal limiter_version = ARGV[num_static_argv + 2]\\nlocal num_local_argv = num_static_argv + 2\\n\\nif clear == 1 then\\n  redis.call('del', unpack(KEYS))\\nend\\n\\nif redis.call('exists', settings_key) == 0 then\\n  -- Create\\n  local args = {'hmset', settings_key}\\n\\n  for i = num_local_argv + 1, #ARGV do\\n    table.insert(args, ARGV[i])\\n  end\\n\\n  redis.call(unpack(args))\\n  redis.call('hmset', settings_key,\\n    'nextRequest', now,\\n    'lastReservoirRefresh', now,\\n    'lastReservoirIncrease', now,\\n    'running', 0,\\n    'done', 0,\\n    'unblockTime', 0,\\n    'capacityPriorityCounter', 0\\n  )\\n\\nelse\\n  -- Apply migrations\\n  local settings = redis.call('hmget', settings_key,\\n    'id',\\n    'version'\\n  )\\n  local id = settings[1]\\n  local current_version = settings[2]\\n\\n  if current_version ~= limiter_version then\\n    local version_digits = {}\\n    for k, v in string.gmatch(current_version, \\\"([^.]+)\\\") do\\n      table.insert(version_digits, tonumber(k))\\n    end\\n\\n    -- 2.10.0\\n    if version_digits[2] < 10 then\\n      redis.call('hsetnx', settings_key, 'reservoirRefreshInterval', '')\\n      redis.call('hsetnx', settings_key, 'reservoirRefreshAmount', '')\\n      redis.call('hsetnx', settings_key, 'lastReservoirRefresh', '')\\n      redis.call('hsetnx', settings_key, 'done', 0)\\n      redis.call('hset', settings_key, 'version', '2.10.0')\\n    end\\n\\n    -- 2.11.1\\n    if version_digits[2] < 11 or (version_digits[2] == 11 and version_digits[3] < 1) then\\n      if redis.call('hstrlen', settings_key, 'lastReservoirRefresh') == 0 then\\n        redis.call('hmset', settings_key,\\n          'lastReservoirRefresh', now,\\n          'version', '2.11.1'\\n        )\\n      end\\n    end\\n\\n    -- 2.14.0\\n    if version_digits[2] < 14 then\\n      local old_running_key = 'b_'..id..'_running'\\n      local old_executing_key = 'b_'..id..'_executing'\\n\\n      if redis.call('exists', old_running_key) == 1 then\\n        redis.call('rename', old_running_key, job_weights_key)\\n      end\\n      if redis.call('exists', old_executing_key) == 1 then\\n        redis.call('rename', old_executing_key, job_expirations_key)\\n      end\\n      redis.call('hset', settings_key, 'version', '2.14.0')\\n    end\\n\\n    -- 2.15.2\\n    if version_digits[2] < 15 or (version_digits[2] == 15 and version_digits[3] < 2) then\\n      redis.call('hsetnx', settings_key, 'capacityPriorityCounter', 0)\\n      redis.call('hset', settings_key, 'version', '2.15.2')\\n    end\\n\\n    -- 2.17.0\\n    if version_digits[2] < 17 then\\n      redis.call('hsetnx', settings_key, 'clientTimeout', 10000)\\n      redis.call('hset', settings_key, 'version', '2.17.0')\\n    end\\n\\n    -- 2.18.0\\n    if version_digits[2] < 18 then\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseInterval', '')\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseAmount', '')\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseMaximum', '')\\n      redis.call('hsetnx', settings_key, 'lastReservoirIncrease', now)\\n      redis.call('hset', settings_key, 'version', '2.18.0')\\n    end\\n\\n  end\\n\\n  process_tick(now, false)\\nend\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn {}\\n\",\"process_tick.lua\":\"local process_tick = function (now, always_publish)\\n\\n  local compute_capacity = function (maxConcurrent, running, reservoir)\\n    if maxConcurrent ~= nil and reservoir ~= nil then\\n      return math.min((maxConcurrent - running), reservoir)\\n    elseif maxConcurrent ~= nil then\\n      return maxConcurrent - running\\n    elseif reservoir ~= nil then\\n      return reservoir\\n    else\\n      return nil\\n    end\\n  end\\n\\n  local settings = redis.call('hmget', settings_key,\\n    'id',\\n    'maxConcurrent',\\n    'running',\\n    'reservoir',\\n    'reservoirRefreshInterval',\\n    'reservoirRefreshAmount',\\n    'lastReservoirRefresh',\\n    'reservoirIncreaseInterval',\\n    'reservoirIncreaseAmount',\\n    'reservoirIncreaseMaximum',\\n    'lastReservoirIncrease',\\n    'capacityPriorityCounter',\\n    'clientTimeout'\\n  )\\n  local id = settings[1]\\n  local maxConcurrent = tonumber(settings[2])\\n  local running = tonumber(settings[3])\\n  local reservoir = tonumber(settings[4])\\n  local reservoirRefreshInterval = tonumber(settings[5])\\n  local reservoirRefreshAmount = tonumber(settings[6])\\n  local lastReservoirRefresh = tonumber(settings[7])\\n  local reservoirIncreaseInterval = tonumber(settings[8])\\n  local reservoirIncreaseAmount = tonumber(settings[9])\\n  local reservoirIncreaseMaximum = tonumber(settings[10])\\n  local lastReservoirIncrease = tonumber(settings[11])\\n  local capacityPriorityCounter = tonumber(settings[12])\\n  local clientTimeout = tonumber(settings[13])\\n\\n  local initial_capacity = compute_capacity(maxConcurrent, running, reservoir)\\n\\n  --\\n  -- Process 'running' changes\\n  --\\n  local expired = redis.call('zrangebyscore', job_expirations_key, '-inf', '('..now)\\n\\n  if #expired > 0 then\\n    redis.call('zremrangebyscore', job_expirations_key, '-inf', '('..now)\\n\\n    local flush_batch = function (batch, acc)\\n      local weights = redis.call('hmget', job_weights_key, unpack(batch))\\n                      redis.call('hdel',  job_weights_key, unpack(batch))\\n      local clients = redis.call('hmget', job_clients_key, unpack(batch))\\n                      redis.call('hdel',  job_clients_key, unpack(batch))\\n\\n      -- Calculate sum of removed weights\\n      for i = 1, #weights do\\n        acc['total'] = acc['total'] + (tonumber(weights[i]) or 0)\\n      end\\n\\n      -- Calculate sum of removed weights by client\\n      local client_weights = {}\\n      for i = 1, #clients do\\n        local removed = tonumber(weights[i]) or 0\\n        if removed > 0 then\\n          acc['client_weights'][clients[i]] = (acc['client_weights'][clients[i]] or 0) + removed\\n        end\\n      end\\n    end\\n\\n    local acc = {\\n      ['total'] = 0,\\n      ['client_weights'] = {}\\n    }\\n    local batch_size = 1000\\n\\n    -- Compute changes to Zsets and apply changes to Hashes\\n    for i = 1, #expired, batch_size do\\n      local batch = {}\\n      for j = i, math.min(i + batch_size - 1, #expired) do\\n        table.insert(batch, expired[j])\\n      end\\n\\n      flush_batch(batch, acc)\\n    end\\n\\n    -- Apply changes to Zsets\\n    if acc['total'] > 0 then\\n      redis.call('hincrby', settings_key, 'done', acc['total'])\\n      running = tonumber(redis.call('hincrby', settings_key, 'running', -acc['total']))\\n    end\\n\\n    for client, weight in pairs(acc['client_weights']) do\\n      redis.call('zincrby', client_running_key, -weight, client)\\n    end\\n  end\\n\\n  --\\n  -- Process 'reservoir' changes\\n  --\\n  local reservoirRefreshActive = reservoirRefreshInterval ~= nil and reservoirRefreshAmount ~= nil\\n  if reservoirRefreshActive and now >= lastReservoirRefresh + reservoirRefreshInterval then\\n    reservoir = reservoirRefreshAmount\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'lastReservoirRefresh', now\\n    )\\n  end\\n\\n  local reservoirIncreaseActive = reservoirIncreaseInterval ~= nil and reservoirIncreaseAmount ~= nil\\n  if reservoirIncreaseActive and now >= lastReservoirIncrease + reservoirIncreaseInterval then\\n    local num_intervals = math.floor((now - lastReservoirIncrease) / reservoirIncreaseInterval)\\n    local incr = reservoirIncreaseAmount * num_intervals\\n    if reservoirIncreaseMaximum ~= nil then\\n      incr = math.min(incr, reservoirIncreaseMaximum - (reservoir or 0))\\n    end\\n    if incr > 0 then\\n      reservoir = (reservoir or 0) + incr\\n    end\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'lastReservoirIncrease', lastReservoirIncrease + (num_intervals * reservoirIncreaseInterval)\\n    )\\n  end\\n\\n  --\\n  -- Clear unresponsive clients\\n  --\\n  local unresponsive = redis.call('zrangebyscore', client_last_seen_key, '-inf', (now - clientTimeout))\\n  local unresponsive_lookup = {}\\n  local terminated_clients = {}\\n  for i = 1, #unresponsive do\\n    unresponsive_lookup[unresponsive[i]] = true\\n    if tonumber(redis.call('zscore', client_running_key, unresponsive[i])) == 0 then\\n      table.insert(terminated_clients, unresponsive[i])\\n    end\\n  end\\n  if #terminated_clients > 0 then\\n    redis.call('zrem', client_running_key,         unpack(terminated_clients))\\n    redis.call('hdel', client_num_queued_key,      unpack(terminated_clients))\\n    redis.call('zrem', client_last_registered_key, unpack(terminated_clients))\\n    redis.call('zrem', client_last_seen_key,       unpack(terminated_clients))\\n  end\\n\\n  --\\n  -- Broadcast capacity changes\\n  --\\n  local final_capacity = compute_capacity(maxConcurrent, running, reservoir)\\n\\n  if always_publish or (initial_capacity ~= nil and final_capacity == nil) then\\n    -- always_publish or was not unlimited, now unlimited\\n    redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))\\n\\n  elseif initial_capacity ~= nil and final_capacity ~= nil and final_capacity > initial_capacity then\\n    -- capacity was increased\\n    -- send the capacity message to the limiter having the lowest number of running jobs\\n    -- the tiebreaker is the limiter having not registered a job in the longest time\\n\\n    local lowest_concurrency_value = nil\\n    local lowest_concurrency_clients = {}\\n    local lowest_concurrency_last_registered = {}\\n    local client_concurrencies = redis.call('zrange', client_running_key, 0, -1, 'withscores')\\n\\n    for i = 1, #client_concurrencies, 2 do\\n      local client = client_concurrencies[i]\\n      local concurrency = tonumber(client_concurrencies[i+1])\\n\\n      if (\\n        lowest_concurrency_value == nil or lowest_concurrency_value == concurrency\\n      ) and (\\n        not unresponsive_lookup[client]\\n      ) and (\\n        tonumber(redis.call('hget', client_num_queued_key, client)) > 0\\n      ) then\\n        lowest_concurrency_value = concurrency\\n        table.insert(lowest_concurrency_clients, client)\\n        local last_registered = tonumber(redis.call('zscore', client_last_registered_key, client))\\n        table.insert(lowest_concurrency_last_registered, last_registered)\\n      end\\n    end\\n\\n    if #lowest_concurrency_clients > 0 then\\n      local position = 1\\n      local earliest = lowest_concurrency_last_registered[1]\\n\\n      for i,v in ipairs(lowest_concurrency_last_registered) do\\n        if v < earliest then\\n          position = i\\n          earliest = v\\n        end\\n      end\\n\\n      local next_client = lowest_concurrency_clients[position]\\n      redis.call('publish', 'b_'..id,\\n        'capacity-priority:'..(final_capacity or '')..\\n        ':'..next_client..\\n        ':'..capacityPriorityCounter\\n      )\\n      redis.call('hincrby', settings_key, 'capacityPriorityCounter', '1')\\n    else\\n      redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))\\n    end\\n  end\\n\\n  return {\\n    ['capacity'] = final_capacity,\\n    ['running'] = running,\\n    ['reservoir'] = reservoir\\n  }\\nend\\n\",\"queued.lua\":\"local clientTimeout = tonumber(redis.call('hget', settings_key, 'clientTimeout'))\\nlocal valid_clients = redis.call('zrangebyscore', client_last_seen_key, (now - clientTimeout), 'inf')\\nlocal client_queued = redis.call('hmget', client_num_queued_key, unpack(valid_clients))\\n\\nlocal sum = 0\\nfor i = 1, #client_queued do\\n  sum = sum + tonumber(client_queued[i])\\nend\\n\\nreturn sum\\n\",\"refresh_expiration.lua\":\"local refresh_expiration = function (now, nextRequest, groupTimeout)\\n\\n  if groupTimeout ~= nil then\\n    local ttl = (nextRequest + groupTimeout) - now\\n\\n    for i = 1, #KEYS do\\n      redis.call('pexpire', KEYS[i], ttl)\\n    end\\n  end\\n\\nend\\n\",\"refs.lua\":\"local settings_key = KEYS[1]\\nlocal job_weights_key = KEYS[2]\\nlocal job_expirations_key = KEYS[3]\\nlocal job_clients_key = KEYS[4]\\nlocal client_running_key = KEYS[5]\\nlocal client_num_queued_key = KEYS[6]\\nlocal client_last_registered_key = KEYS[7]\\nlocal client_last_seen_key = KEYS[8]\\n\\nlocal now = tonumber(ARGV[1])\\nlocal client = ARGV[2]\\n\\nlocal num_static_argv = 2\\n\",\"register.lua\":\"local index = ARGV[num_static_argv + 1]\\nlocal weight = tonumber(ARGV[num_static_argv + 2])\\nlocal expiration = tonumber(ARGV[num_static_argv + 3])\\n\\nlocal state = process_tick(now, false)\\nlocal capacity = state['capacity']\\nlocal reservoir = state['reservoir']\\n\\nlocal settings = redis.call('hmget', settings_key,\\n  'nextRequest',\\n  'minTime',\\n  'groupTimeout'\\n)\\nlocal nextRequest = tonumber(settings[1])\\nlocal minTime = tonumber(settings[2])\\nlocal groupTimeout = tonumber(settings[3])\\n\\nif conditions_check(capacity, weight) then\\n\\n  redis.call('hincrby', settings_key, 'running', weight)\\n  redis.call('hset', job_weights_key, index, weight)\\n  if expiration ~= nil then\\n    redis.call('zadd', job_expirations_key, now + expiration, index)\\n  end\\n  redis.call('hset', job_clients_key, index, client)\\n  redis.call('zincrby', client_running_key, weight, client)\\n  redis.call('hincrby', client_num_queued_key, client, -1)\\n  redis.call('zadd', client_last_registered_key, now, client)\\n\\n  local wait = math.max(nextRequest - now, 0)\\n  local newNextRequest = now + wait + minTime\\n\\n  if reservoir == nil then\\n    redis.call('hset', settings_key,\\n      'nextRequest', newNextRequest\\n    )\\n  else\\n    reservoir = reservoir - weight\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'nextRequest', newNextRequest\\n    )\\n  end\\n\\n  refresh_expiration(now, newNextRequest, groupTimeout)\\n\\n  return {true, wait, reservoir}\\n\\nelse\\n  return {false}\\nend\\n\",\"register_client.lua\":\"local queued = tonumber(ARGV[num_static_argv + 1])\\n\\n-- Could have been re-registered concurrently\\nif not redis.call('zscore', client_last_seen_key, client) then\\n  redis.call('zadd', client_running_key, 0, client)\\n  redis.call('hset', client_num_queued_key, client, queued)\\n  redis.call('zadd', client_last_registered_key, 0, client)\\nend\\n\\nredis.call('zadd', client_last_seen_key, now, client)\\n\\nreturn {}\\n\",\"running.lua\":\"return process_tick(now, false)['running']\\n\",\"submit.lua\":\"local queueLength = tonumber(ARGV[num_static_argv + 1])\\nlocal weight = tonumber(ARGV[num_static_argv + 2])\\n\\nlocal capacity = process_tick(now, false)['capacity']\\n\\nlocal settings = redis.call('hmget', settings_key,\\n  'id',\\n  'maxConcurrent',\\n  'highWater',\\n  'nextRequest',\\n  'strategy',\\n  'unblockTime',\\n  'penalty',\\n  'minTime',\\n  'groupTimeout'\\n)\\nlocal id = settings[1]\\nlocal maxConcurrent = tonumber(settings[2])\\nlocal highWater = tonumber(settings[3])\\nlocal nextRequest = tonumber(settings[4])\\nlocal strategy = tonumber(settings[5])\\nlocal unblockTime = tonumber(settings[6])\\nlocal penalty = tonumber(settings[7])\\nlocal minTime = tonumber(settings[8])\\nlocal groupTimeout = tonumber(settings[9])\\n\\nif maxConcurrent ~= nil and weight > maxConcurrent then\\n  return redis.error_reply('OVERWEIGHT:'..weight..':'..maxConcurrent)\\nend\\n\\nlocal reachedHWM = (highWater ~= nil and queueLength == highWater\\n  and not (\\n    conditions_check(capacity, weight)\\n    and nextRequest - now <= 0\\n  )\\n)\\n\\nlocal blocked = strategy == 3 and (reachedHWM or unblockTime >= now)\\n\\nif blocked then\\n  local computedPenalty = penalty\\n  if computedPenalty == nil then\\n    if minTime == 0 then\\n      computedPenalty = 5000\\n    else\\n      computedPenalty = 15 * minTime\\n    end\\n  end\\n\\n  local newNextRequest = now + computedPenalty + minTime\\n\\n  redis.call('hmset', settings_key,\\n    'unblockTime', now + computedPenalty,\\n    'nextRequest', newNextRequest\\n  )\\n\\n  local clients_queued_reset = redis.call('hkeys', client_num_queued_key)\\n  local queued_reset = {}\\n  for i = 1, #clients_queued_reset do\\n    table.insert(queued_reset, clients_queued_reset[i])\\n    table.insert(queued_reset, 0)\\n  end\\n  redis.call('hmset', client_num_queued_key, unpack(queued_reset))\\n\\n  redis.call('publish', 'b_'..id, 'blocked:')\\n\\n  refresh_expiration(now, newNextRequest, groupTimeout)\\nend\\n\\nif not blocked and not reachedHWM then\\n  redis.call('hincrby', client_num_queued_key, client, 1)\\nend\\n\\nreturn {reachedHWM, blocked, strategy}\\n\",\"update_settings.lua\":\"local args = {'hmset', settings_key}\\n\\nfor i = num_static_argv + 1, #ARGV do\\n  table.insert(args, ARGV[i])\\nend\\n\\nredis.call(unpack(args))\\n\\nprocess_tick(now, true)\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn {}\\n\",\"validate_client.lua\":\"if not redis.call('zscore', client_last_seen_key, client) then\\n  return redis.error_reply('UNKNOWN_CLIENT')\\nend\\n\\nredis.call('zadd', client_last_seen_key, now, client)\\n\",\"validate_keys.lua\":\"if not (redis.call('exists', settings_key) == 1) then\\n  return redis.error_reply('SETTINGS_KEY_NOT_FOUND')\\nend\\n\"}")},4006:function(e){e.exports={r:"2.19.5"}}};
//# sourceMappingURL=141.js.map